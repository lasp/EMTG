<!DOCTYPE html>

<html lang="en" data-content_root="../">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Mission &#8212; EMTG python  documentation</title>
    <link rel="stylesheet" type="text/css" href="../_static/pygments.css?v=61cd365c" />
    <link rel="stylesheet" type="text/css" href="../_static/alabaster.css?v=12dfc556" />
    <script src="../_static/documentation_options.js?v=7f41d439"></script>
    <script src="../_static/doctools.js?v=9a2dae69"></script>
    <script src="../_static/sphinx_highlight.js?v=dc90522c"></script>
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
   
  <link rel="stylesheet" href="../_static/custom.css" type="text/css" />
  

  
  

  </head><body>
  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          

          <div class="body" role="main">
            
  <h1>Source code for Mission</h1><div class="highlight"><pre>
<span></span><span class="c1"># Copyright (c) 2024 The Regents of the University of Colorado.</span>
<span class="c1"># All Other Rights Reserved.</span>

<span class="kn">import</span> <span class="nn">Journey</span>
<span class="kn">import</span> <span class="nn">MissionEvent</span>
<span class="kn">import</span> <span class="nn">ThrottleTable</span>
<span class="kn">import</span> <span class="nn">os</span>
<span class="kn">import</span> <span class="nn">math</span>
<span class="kn">import</span> <span class="nn">kepler</span>

<span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>

<div class="viewcode-block" id="Mission">
<a class="viewcode-back" href="../PyEMTG/Mission.html#Mission.Mission">[docs]</a>
<span class="k">class</span> <span class="nc">Mission</span><span class="p">(</span><span class="nb">object</span><span class="p">):</span>
    <span class="c1">#class to hold mission information</span>

    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">input_file_name</span><span class="p">):</span>
        <span class="c1">#default values, set as garbage so that if a .emtg file is not fully populated for some reason then bad cases will be thrown out by any filter</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">mission_name</span> <span class="o">=</span> <span class="s1">&#39;bob&#39;</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Mission name (string)&quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">total_deterministic_deltav</span> <span class="o">=</span> <span class="mf">1.0e+20</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Total deterministic Delta v, km/s&quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">total_statistical_deltav</span> <span class="o">=</span> <span class="mf">1.0e+20</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">total_flight_time_years</span> <span class="o">=</span> <span class="mf">1.0e+20</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">first_thrust_event</span> <span class="o">=</span> <span class="mi">1</span>      
        <span class="bp">self</span><span class="o">.</span><span class="n">spacecraft_dry_mass</span> <span class="o">=</span> <span class="mf">1.0e-20</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">final_mass_including_propellant_margin</span> <span class="o">=</span> <span class="mf">1.0e-20</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">total_electric_propellant_including_margin</span> <span class="o">=</span> <span class="mf">1.0e+20</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">chemical_fuel_with_margin</span> <span class="o">=</span> <span class="mf">1.0e+20</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">chemical_fuel_used</span> <span class="o">=</span> <span class="mf">1.0e+20</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">chemical_oxidizer_with_margin</span> <span class="o">=</span> <span class="mf">1.0e+20</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">chemical_oxidizer_used</span> <span class="o">=</span> <span class="mf">1.0e+20</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">total_electric_propellant_used</span> <span class="o">=</span> <span class="mf">1.0e+20</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">spacecraft_dry_mass_margin</span> <span class="o">=</span> <span class="o">-</span><span class="mf">1.0e+20</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">spacecraft_mass_data</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">DecisionVector</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">Xdescriptions</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">Xlowerbounds</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">Xupperbounds</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">user_data</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">worst_constraint</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">worst_violation</span> <span class="o">=</span> <span class="mf">0.0</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">objective_value</span> <span class="o">=</span> <span class="mf">1.0e+20</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">objective_value_first_nlp_solve</span> <span class="o">=</span> <span class="mf">1.0e+20</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">first_nlp_solve_feasible</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">number_of_solution_attempts</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">solution_attempt_index_that_produced_best_feasible_solution</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">timeToCompletionOfBestSolutionAttempt</span> <span class="o">=</span> <span class="o">-</span><span class="mf">1.0</span>

        <span class="c1">#now read the file</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">parse_mission_file</span><span class="p">(</span><span class="n">input_file_name</span><span class="p">)</span>

<div class="viewcode-block" id="Mission.parse_mission_file">
<a class="viewcode-back" href="../PyEMTG/Mission.html#Mission.Mission.parse_mission_file">[docs]</a>
    <span class="k">def</span> <span class="nf">parse_mission_file</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">input_file_name</span><span class="p">):</span>
        <span class="c1">#Step 1: open the file</span>
        <span class="k">if</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">isfile</span><span class="p">(</span><span class="n">input_file_name</span><span class="p">):</span>
            <span class="n">inputfile</span> <span class="o">=</span> <span class="nb">open</span><span class="p">(</span><span class="n">input_file_name</span><span class="p">,</span> <span class="s2">&quot;r&quot;</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">success</span> <span class="o">=</span> <span class="mi">1</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Unable to open &quot;</span> <span class="o">+</span> <span class="n">input_file_name</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">success</span> <span class="o">=</span> <span class="mi">0</span>
            <span class="k">return</span>

        <span class="c1">#Step 2: parse the file</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">ActiveJourney</span> <span class="o">=</span> <span class="o">-</span><span class="mi">1</span>
        <span class="n">LastJourney</span> <span class="o">=</span> <span class="o">-</span><span class="mi">1</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">ChosenJourneys</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">Journeys</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">mu</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="n">linenumber</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="n">grabbingBoundaryConstraintOutput</span> <span class="o">=</span> <span class="kc">False</span>
        <span class="n">spacecraft_mass_data_mode</span> <span class="o">=</span> <span class="kc">False</span>
        <span class="k">for</span> <span class="n">line</span> <span class="ow">in</span> <span class="n">inputfile</span><span class="p">:</span>
            <span class="n">linenumber</span> <span class="o">+=</span> <span class="mi">1</span>
            <span class="c1">#split the line by colons</span>
            <span class="n">lineStripped</span> <span class="o">=</span> <span class="n">line</span><span class="o">.</span><span class="n">rstrip</span><span class="p">(</span><span class="s2">&quot; </span><span class="se">\r\n</span><span class="s2">&quot;</span><span class="p">)</span>
            <span class="n">linecell</span> <span class="o">=</span> <span class="n">lineStripped</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;:&#39;</span><span class="p">)</span>

            <span class="k">if</span> <span class="n">linecell</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">==</span> <span class="s2">&quot;Mission&quot;</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">mission_name</span> <span class="o">=</span> <span class="n">linecell</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">strip</span><span class="p">(</span><span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">)</span>

            <span class="k">elif</span> <span class="n">linecell</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">==</span> <span class="s2">&quot;Decision Vector&quot;</span><span class="p">:</span>
                <span class="n">DecisionCell</span> <span class="o">=</span> <span class="p">[]</span>
                <span class="k">if</span> <span class="s1">&#39;,&#39;</span> <span class="ow">in</span> <span class="n">linecell</span><span class="p">[</span><span class="mi">1</span><span class="p">]:</span>
                    <span class="n">DecisionCell</span> <span class="o">=</span> <span class="n">linecell</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;,&#39;</span><span class="p">)</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">DecisionCell</span> <span class="o">=</span> <span class="n">linecell</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39; &#39;</span><span class="p">)</span>
                <span class="k">if</span> <span class="s2">&quot;&quot;</span> <span class="ow">in</span> <span class="n">DecisionCell</span><span class="p">:</span>
                    <span class="n">DecisionCell</span><span class="o">.</span><span class="n">remove</span><span class="p">(</span><span class="s1">&#39;&#39;</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">DecisionVector</span> <span class="o">=</span> <span class="p">[]</span>
                <span class="k">for</span> <span class="n">entry</span> <span class="ow">in</span> <span class="n">DecisionCell</span><span class="p">:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">DecisionVector</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="nb">float</span><span class="p">(</span><span class="n">entry</span><span class="p">))</span>

            <span class="k">elif</span> <span class="s2">&quot;Xdescriptions&quot;</span> <span class="ow">in</span> <span class="n">linecell</span><span class="p">[</span><span class="mi">0</span><span class="p">]:</span>
                <span class="n">linecellcomma</span> <span class="o">=</span> <span class="n">line</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;,&#39;</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">Xdescriptions</span> <span class="o">=</span> <span class="p">[]</span>
                <span class="k">for</span> <span class="n">entry</span> <span class="ow">in</span> <span class="n">linecellcomma</span><span class="p">[</span><span class="mi">1</span><span class="p">:]:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">Xdescriptions</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">entry</span><span class="o">.</span><span class="n">rstrip</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\r\n</span><span class="s2">&quot;</span><span class="p">))</span>

            <span class="k">elif</span> <span class="n">line</span><span class="p">[</span><span class="mi">0</span><span class="p">:</span><span class="mi">12</span><span class="p">]</span> <span class="o">==</span> <span class="s1">&#39;Xupperbounds&#39;</span><span class="p">:</span>
                <span class="k">if</span> <span class="s1">&#39;,&#39;</span> <span class="ow">in</span> <span class="n">line</span><span class="p">:</span>
                    <span class="n">boundcell</span> <span class="o">=</span> <span class="n">line</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;,&#39;</span><span class="p">)[</span><span class="mi">1</span><span class="p">:]</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">boundcell</span> <span class="o">=</span> <span class="n">line</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39; &#39;</span><span class="p">)[</span><span class="mi">1</span><span class="p">:]</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">Xupperbounds</span> <span class="o">=</span> <span class="p">[]</span>
                <span class="k">for</span> <span class="n">entry</span> <span class="ow">in</span> <span class="n">boundcell</span><span class="p">:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">Xupperbounds</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="nb">float</span><span class="p">(</span><span class="n">entry</span><span class="p">))</span>

            <span class="k">elif</span> <span class="n">line</span><span class="p">[</span><span class="mi">0</span><span class="p">:</span><span class="mi">12</span><span class="p">]</span> <span class="o">==</span> <span class="s1">&#39;Xlowerbounds&#39;</span><span class="p">:</span>
                <span class="k">if</span> <span class="s1">&#39;,&#39;</span> <span class="ow">in</span> <span class="n">line</span><span class="p">:</span>
                    <span class="n">boundcell</span> <span class="o">=</span> <span class="n">line</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;,&#39;</span><span class="p">)[</span><span class="mi">1</span><span class="p">:]</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">boundcell</span> <span class="o">=</span> <span class="n">line</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39; &#39;</span><span class="p">)[</span><span class="mi">1</span><span class="p">:]</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">Xlowerbounds</span> <span class="o">=</span> <span class="p">[]</span>
                <span class="k">for</span> <span class="n">entry</span> <span class="ow">in</span> <span class="n">boundcell</span><span class="p">:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">Xlowerbounds</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="nb">float</span><span class="p">(</span><span class="n">entry</span><span class="p">))</span>   
                    
            <span class="k">elif</span> <span class="s2">&quot;Constraint_Vector&quot;</span> <span class="ow">in</span> <span class="n">linecell</span><span class="p">[</span><span class="mi">0</span><span class="p">]:</span>
                <span class="n">DecisionCell</span> <span class="o">=</span> <span class="p">[]</span>
                <span class="k">if</span> <span class="s1">&#39;,&#39;</span> <span class="ow">in</span> <span class="n">linecell</span><span class="p">[</span><span class="mi">0</span><span class="p">]:</span>
                    <span class="n">DecisionCell</span> <span class="o">=</span> <span class="n">line</span><span class="o">.</span><span class="n">rstrip</span><span class="p">(</span><span class="s2">&quot;/r/n &quot;</span><span class="p">)</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;,&#39;</span><span class="p">)[</span><span class="mi">1</span><span class="p">:]</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">DecisionCell</span> <span class="o">=</span> <span class="n">line</span><span class="o">.</span><span class="n">rstrip</span><span class="p">(</span><span class="s2">&quot;/r/n &quot;</span><span class="p">)</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39; &#39;</span><span class="p">)[</span><span class="mi">1</span><span class="p">:]</span>
                <span class="k">if</span> <span class="s2">&quot;&quot;</span> <span class="ow">in</span> <span class="n">DecisionCell</span><span class="p">:</span>
                    <span class="n">DecisionCell</span><span class="o">.</span><span class="n">remove</span><span class="p">(</span><span class="s1">&#39;&#39;</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">ConstraintVector</span> <span class="o">=</span> <span class="p">[]</span>
                <span class="k">for</span> <span class="n">entry</span> <span class="ow">in</span> <span class="n">DecisionCell</span><span class="p">:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">ConstraintVector</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="nb">float</span><span class="p">(</span><span class="n">entry</span><span class="p">))</span>
                    
            <span class="k">elif</span> <span class="s2">&quot;Fdescriptions&quot;</span> <span class="ow">in</span> <span class="n">linecell</span><span class="p">[</span><span class="mi">0</span><span class="p">]:</span>
                <span class="n">linecellcomma</span> <span class="o">=</span> <span class="n">line</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;,&#39;</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">Fdescriptions</span> <span class="o">=</span> <span class="p">[]</span>
                <span class="k">for</span> <span class="n">entry</span> <span class="ow">in</span> <span class="n">linecellcomma</span><span class="p">[</span><span class="mi">1</span><span class="p">:]:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">Fdescriptions</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">entry</span><span class="o">.</span><span class="n">rstrip</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\r\n</span><span class="s2">&quot;</span><span class="p">))</span>                 

            <span class="k">elif</span> <span class="n">line</span><span class="p">[</span><span class="mi">0</span><span class="p">:</span><span class="mi">12</span><span class="p">]</span> <span class="o">==</span> <span class="s1">&#39;Fupperbounds&#39;</span><span class="p">:</span>
                <span class="k">if</span> <span class="s1">&#39;,&#39;</span> <span class="ow">in</span> <span class="n">line</span><span class="p">:</span>
                    <span class="n">boundcell</span> <span class="o">=</span> <span class="n">line</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;,&#39;</span><span class="p">)[</span><span class="mi">1</span><span class="p">:]</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">boundcell</span> <span class="o">=</span> <span class="n">line</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39; &#39;</span><span class="p">)[</span><span class="mi">1</span><span class="p">:]</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">Fupperbounds</span> <span class="o">=</span> <span class="p">[]</span>
                <span class="k">for</span> <span class="n">entry</span> <span class="ow">in</span> <span class="n">boundcell</span><span class="p">:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">Fupperbounds</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="nb">float</span><span class="p">(</span><span class="n">entry</span><span class="p">))</span>                

            <span class="k">elif</span> <span class="n">line</span><span class="p">[</span><span class="mi">0</span><span class="p">:</span><span class="mi">12</span><span class="p">]</span> <span class="o">==</span> <span class="s1">&#39;Flowerbounds&#39;</span><span class="p">:</span>
                <span class="k">if</span> <span class="s1">&#39;,&#39;</span> <span class="ow">in</span> <span class="n">line</span><span class="p">:</span>
                    <span class="n">boundcell</span> <span class="o">=</span> <span class="n">line</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;,&#39;</span><span class="p">)[</span><span class="mi">1</span><span class="p">:]</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">boundcell</span> <span class="o">=</span> <span class="n">line</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39; &#39;</span><span class="p">)[</span><span class="mi">1</span><span class="p">:]</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">Flowerbounds</span> <span class="o">=</span> <span class="p">[]</span>
                <span class="k">for</span> <span class="n">entry</span> <span class="ow">in</span> <span class="n">boundcell</span><span class="p">:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">Flowerbounds</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="nb">float</span><span class="p">(</span><span class="n">entry</span><span class="p">))</span>      

            <span class="k">elif</span> <span class="n">linecell</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">==</span> <span class="s2">&quot;Journey&quot;</span><span class="p">:</span>
                <span class="n">LastJourney</span> <span class="o">+=</span> <span class="mi">1</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">ActiveJourney</span> <span class="o">=</span> <span class="n">LastJourney</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">Journeys</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">Journey</span><span class="o">.</span><span class="n">Journey</span><span class="p">(</span><span class="bp">self</span><span class="p">))</span>
            
            <span class="k">elif</span> <span class="n">linecell</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">==</span> <span class="s2">&quot;user_data&quot;</span><span class="p">:</span>
                <span class="n">full_notes</span> <span class="o">=</span> <span class="n">line</span><span class="o">.</span><span class="n">lstrip</span><span class="p">(</span><span class="s2">&quot;user_data:&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">lstrip</span><span class="p">(</span><span class="s2">&quot; &quot;</span><span class="p">)</span><span class="o">.</span><span class="n">rstrip</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\r\n</span><span class="s2"> &quot;</span><span class="p">)</span>
                                        
                <span class="bp">self</span><span class="o">.</span><span class="n">user_data</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">()</span>
                
                <span class="k">if</span> <span class="n">full_notes</span> <span class="o">!=</span> <span class="s1">&#39;&#39;</span><span class="p">:</span>
                    <span class="k">if</span> <span class="s2">&quot;:&quot;</span> <span class="ow">in</span> <span class="n">full_notes</span><span class="p">:</span>
                        <span class="n">full_notes</span> <span class="o">=</span> <span class="n">full_notes</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;:&quot;</span><span class="p">)</span>
                        <span class="k">for</span> <span class="n">note</span> <span class="ow">in</span> <span class="n">full_notes</span><span class="p">:</span>
                            <span class="n">var</span> <span class="o">=</span> <span class="n">note</span><span class="o">.</span><span class="n">lstrip</span><span class="p">(</span><span class="s1">&#39;(&quot;&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;,&quot;</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">rstrip</span><span class="p">(</span><span class="s1">&#39;&quot;&#39;</span><span class="p">)</span>
                            <span class="n">val</span> <span class="o">=</span> <span class="nb">eval</span><span class="p">(</span><span class="n">note</span><span class="o">.</span><span class="n">lstrip</span><span class="p">(</span><span class="s2">&quot;(&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">lstrip</span><span class="p">(</span><span class="n">var</span> <span class="o">+</span> <span class="s1">&#39;&quot;&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">lstrip</span><span class="p">(</span><span class="s2">&quot;, &quot;</span><span class="p">)</span><span class="o">.</span><span class="n">rstrip</span><span class="p">(</span><span class="s2">&quot;) &quot;</span><span class="p">))</span>
                            <span class="bp">self</span><span class="o">.</span><span class="n">user_data</span><span class="o">.</span><span class="n">update</span><span class="p">({</span><span class="n">var</span><span class="p">:</span><span class="n">val</span><span class="p">})</span>
                    <span class="k">else</span><span class="p">:</span>
                        <span class="n">var</span> <span class="o">=</span> <span class="n">full_notes</span><span class="o">.</span><span class="n">lstrip</span><span class="p">(</span><span class="s1">&#39;(&quot;&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;,&quot;</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">rstrip</span><span class="p">(</span><span class="s1">&#39;&quot;&#39;</span><span class="p">)</span>
                        <span class="n">val</span> <span class="o">=</span> <span class="nb">eval</span><span class="p">(</span><span class="n">full_notes</span><span class="o">.</span><span class="n">lstrip</span><span class="p">(</span><span class="s2">&quot;(&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">lstrip</span><span class="p">(</span><span class="n">var</span> <span class="o">+</span> <span class="s1">&#39;&quot;&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">lstrip</span><span class="p">(</span><span class="s2">&quot;, &quot;</span><span class="p">)</span><span class="o">.</span><span class="n">rstrip</span><span class="p">(</span><span class="s2">&quot;) &quot;</span><span class="p">))</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">user_data</span><span class="o">.</span><span class="n">update</span><span class="p">({</span><span class="n">var</span><span class="p">:</span><span class="n">val</span><span class="p">})</span>

            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">ActiveJourney</span> <span class="o">&gt;=</span> <span class="mi">0</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">Journeys</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">ActiveJourney</span><span class="p">]</span><span class="o">.</span><span class="n">journey_number</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">ActiveJourney</span>
                
                <span class="k">if</span> <span class="n">linecell</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">==</span> <span class="s2">&quot;Journey name&quot;</span><span class="p">:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">Journeys</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">ActiveJourney</span><span class="p">]</span><span class="o">.</span><span class="n">journey_name</span> <span class="o">=</span> <span class="n">linecell</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span>
                <span class="k">elif</span> <span class="n">linecell</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">==</span> <span class="s2">&quot;Central Body&quot;</span><span class="p">:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">Journeys</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">ActiveJourney</span><span class="p">]</span><span class="o">.</span><span class="n">central_body</span> <span class="o">=</span> <span class="n">linecell</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span>
                <span class="k">elif</span> <span class="n">linecell</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">==</span> <span class="s2">&quot;Thruster duty cycle&quot;</span><span class="p">:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">Journeys</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">ActiveJourney</span><span class="p">]</span><span class="o">.</span><span class="n">thruster_duty_cycle</span> <span class="o">=</span> <span class="nb">eval</span><span class="p">(</span><span class="n">linecell</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>
                <span class="k">elif</span> <span class="n">linecell</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">==</span> <span class="s2">&quot;Radius (km)&quot;</span><span class="p">:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">Journeys</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">ActiveJourney</span><span class="p">]</span><span class="o">.</span><span class="n">central_body_radius</span> <span class="o">=</span> <span class="nb">eval</span><span class="p">(</span><span class="n">linecell</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>
                <span class="k">elif</span> <span class="n">linecell</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">==</span> <span class="s2">&quot;mu (km^3/s^2)&quot;</span><span class="p">:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">Journeys</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">ActiveJourney</span><span class="p">]</span><span class="o">.</span><span class="n">mu</span> <span class="o">=</span> <span class="nb">eval</span><span class="p">(</span><span class="n">linecell</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>
                <span class="k">elif</span> <span class="n">linecell</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">==</span> <span class="s2">&quot;Characteristic length unit (km)&quot;</span><span class="p">:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">Journeys</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">ActiveJourney</span><span class="p">]</span><span class="o">.</span><span class="n">LU</span> <span class="o">=</span> <span class="nb">eval</span><span class="p">(</span><span class="n">linecell</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">Journeys</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">ActiveJourney</span><span class="p">]</span><span class="o">.</span><span class="n">TU</span> <span class="o">=</span> <span class="n">math</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">Journeys</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">ActiveJourney</span><span class="p">]</span><span class="o">.</span><span class="n">LU</span><span class="o">**</span><span class="mi">3</span> <span class="o">/</span> <span class="bp">self</span><span class="o">.</span><span class="n">Journeys</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">ActiveJourney</span><span class="p">]</span><span class="o">.</span><span class="n">mu</span><span class="p">)</span>
                <span class="k">elif</span> <span class="n">linecell</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">==</span> <span class="s2">&quot;Frame&quot;</span><span class="p">:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">Journeys</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">ActiveJourney</span><span class="p">]</span><span class="o">.</span><span class="n">state_frame</span> <span class="o">=</span> <span class="n">linecell</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span>
                <span class="k">elif</span> <span class="n">linecell</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">==</span> <span class="s1">&#39;alpha0&#39;</span><span class="p">:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">Journeys</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">ActiveJourney</span><span class="p">]</span><span class="o">.</span><span class="n">alpha0</span> <span class="o">=</span> <span class="nb">eval</span><span class="p">(</span><span class="n">linecell</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>
                <span class="k">elif</span> <span class="n">linecell</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">==</span> <span class="s1">&#39;delta0&#39;</span><span class="p">:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">Journeys</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">ActiveJourney</span><span class="p">]</span><span class="o">.</span><span class="n">delta0</span> <span class="o">=</span> <span class="nb">eval</span><span class="p">(</span><span class="n">linecell</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>
                <span class="k">elif</span> <span class="n">linecell</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">==</span> <span class="s2">&quot;Boundary&quot;</span><span class="p">:</span>
                    <span class="n">boundary_elements</span> <span class="o">=</span> <span class="n">linecell</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39; &#39;</span><span class="p">)</span>
                    <span class="n">boundary_state</span> <span class="o">=</span> <span class="p">[</span><span class="nb">float</span><span class="p">(</span><span class="n">boundary_elements</span><span class="p">[</span><span class="mi">2</span><span class="p">]),</span> <span class="nb">float</span><span class="p">(</span><span class="n">boundary_elements</span><span class="p">[</span><span class="mi">3</span><span class="p">]),</span> <span class="nb">float</span><span class="p">(</span><span class="n">boundary_elements</span><span class="p">[</span><span class="mi">4</span><span class="p">]),</span> <span class="nb">float</span><span class="p">(</span><span class="n">boundary_elements</span><span class="p">[</span><span class="mi">5</span><span class="p">]),</span> <span class="nb">float</span><span class="p">(</span><span class="n">boundary_elements</span><span class="p">[</span><span class="mi">6</span><span class="p">]),</span> <span class="nb">float</span><span class="p">(</span><span class="n">boundary_elements</span><span class="p">[</span><span class="mi">7</span><span class="p">])]</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">Journeys</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">ActiveJourney</span><span class="p">]</span><span class="o">.</span><span class="n">boundary_states</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">boundary_state</span><span class="p">)</span>
                <span class="k">elif</span> <span class="n">linecell</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">==</span> <span class="s2">&quot;Flyby&quot;</span><span class="p">:</span>
                    <span class="n">flyby_elements</span> <span class="o">=</span> <span class="n">linecell</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39; &#39;</span><span class="p">)</span>
                    <span class="n">flyby_state</span> <span class="o">=</span> <span class="p">[</span><span class="nb">float</span><span class="p">(</span><span class="n">flyby_elements</span><span class="p">[</span><span class="mi">3</span><span class="p">]),</span> <span class="nb">float</span><span class="p">(</span><span class="n">flyby_elements</span><span class="p">[</span><span class="mi">4</span><span class="p">]),</span> <span class="nb">float</span><span class="p">(</span><span class="n">flyby_elements</span><span class="p">[</span><span class="mi">5</span><span class="p">]),</span> <span class="nb">float</span><span class="p">(</span><span class="n">flyby_elements</span><span class="p">[</span><span class="mi">6</span><span class="p">]),</span> <span class="nb">float</span><span class="p">(</span><span class="n">flyby_elements</span><span class="p">[</span><span class="mi">7</span><span class="p">]),</span> <span class="nb">float</span><span class="p">(</span><span class="n">flyby_elements</span><span class="p">[</span><span class="mi">8</span><span class="p">])]</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">Journeys</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">ActiveJourney</span><span class="p">]</span><span class="o">.</span><span class="n">flyby_periapse_states</span> <span class="o">=</span> <span class="p">[]</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">Journeys</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">ActiveJourney</span><span class="p">]</span><span class="o">.</span><span class="n">flyby_periapse_states</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">flyby_state</span><span class="p">)</span>
                <span class="k">elif</span> <span class="n">linecell</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">==</span> <span class="s2">&quot;End journey&quot;</span><span class="p">:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">ActiveJourney</span> <span class="o">=</span> <span class="o">-</span><span class="mi">1</span>
                <span class="k">elif</span> <span class="n">linecell</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">==</span> <span class="s2">&quot;Journey entry/landing velocity with respect to atmosphere (km/s)&quot;</span><span class="p">:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">journey_entryinterface_velocity_with_respect_to_rotating_atmosphere</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">linecell</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>
                <span class="k">elif</span> <span class="n">linecell</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">==</span> <span class="s2">&quot;Journey initial mass increment&quot;</span><span class="p">:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">Journeys</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">ActiveJourney</span><span class="p">]</span><span class="o">.</span><span class="n">journey_mass_increment</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">linecell</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39; &#39;</span><span class="p">)[</span><span class="mi">1</span><span class="p">])</span>
                <span class="k">elif</span> <span class="n">linecell</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">==</span> <span class="s2">&quot;Journey final mass increment&quot;</span><span class="p">:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">Journeys</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">ActiveJourney</span><span class="p">]</span><span class="o">.</span><span class="n">journey_mass_increment</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">linecell</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39; &#39;</span><span class="p">)[</span><span class="mi">1</span><span class="p">])</span>
                <span class="k">elif</span> <span class="n">linecell</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">==</span> <span class="s2">&quot;Journey flight time (days)&quot;</span><span class="p">:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">Journeys</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">ActiveJourney</span><span class="p">]</span><span class="o">.</span><span class="n">journey_flight_time_days</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">linecell</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39; &#39;</span><span class="p">)[</span><span class="mi">1</span><span class="p">])</span>

                <span class="k">elif</span> <span class="s2">&quot;Journey post-arrival delta-v&quot;</span> <span class="ow">in</span> <span class="n">linecell</span><span class="p">[</span><span class="mi">0</span><span class="p">]:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">Journeys</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">ActiveJourney</span><span class="p">]</span><span class="o">.</span><span class="n">journey_post_arrival_deltav</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">linecell</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39; &#39;</span><span class="p">)[</span><span class="mi">1</span><span class="p">])</span>
                <span class="k">elif</span> <span class="s2">&quot;Journey post-arrival propellant consumed&quot;</span> <span class="ow">in</span> <span class="n">linecell</span><span class="p">[</span><span class="mi">0</span><span class="p">]:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">Journeys</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">ActiveJourney</span><span class="p">]</span><span class="o">.</span><span class="n">journey_post_arrival_propellant_used</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">linecell</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39; &#39;</span><span class="p">)[</span><span class="mi">1</span><span class="p">])</span>

                <span class="k">elif</span> <span class="n">linecell</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">==</span> <span class="s2">&quot;Journey entry/landing interface point (BCI frame)&quot;</span><span class="p">:</span>
                    <span class="n">nextline</span> <span class="o">=</span> <span class="nb">next</span><span class="p">(</span><span class="n">inputfile</span><span class="p">)</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39; &#39;</span><span class="p">)</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">Journeys</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">ActiveJourney</span><span class="p">]</span><span class="o">.</span><span class="n">journey_entry_landing_interface_point</span> <span class="o">=</span> <span class="p">[]</span>
                    <span class="k">for</span> <span class="n">entry</span> <span class="ow">in</span> <span class="n">nextline</span><span class="p">:</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">Journeys</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">ActiveJourney</span><span class="p">]</span><span class="o">.</span><span class="n">journey_entry_landing_interface_point</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="nb">float</span><span class="p">(</span><span class="n">entry</span><span class="o">.</span><span class="n">strip</span><span class="p">(</span><span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">)))</span>
                <span class="k">elif</span> <span class="n">linecell</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">==</span> <span class="s2">&quot;Journey entry/landing interface latitude (BCF spherical cow, degrees)&quot;</span><span class="p">:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">Journeys</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">ActiveJourney</span><span class="p">]</span><span class="o">.</span><span class="n">entry_latitude</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">linecell</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39; &#39;</span><span class="p">)[</span><span class="mi">1</span><span class="p">])</span>
                <span class="k">elif</span> <span class="n">linecell</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">==</span> <span class="s2">&quot;Journey entry/landing interface longitude (BCF spherical cow, degrees)&quot;</span><span class="p">:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">Journeys</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">ActiveJourney</span><span class="p">]</span><span class="o">.</span><span class="n">entry_longitude</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">linecell</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39; &#39;</span><span class="p">)[</span><span class="mi">1</span><span class="p">])</span>
                <span class="k">elif</span> <span class="n">linecell</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">==</span> <span class="s2">&quot;Journey entry/landing sun angle (degrees)&quot;</span><span class="p">:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">Journeys</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">ActiveJourney</span><span class="p">]</span><span class="o">.</span><span class="n">entry_sun_angle</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">linecell</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39; &#39;</span><span class="p">)[</span><span class="mi">1</span><span class="p">])</span>
                <span class="k">elif</span> <span class="n">linecell</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">==</span> <span class="s2">&quot;Spacecraft-sun-Earth angle at arrival&quot;</span><span class="p">:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">Journeys</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">ActiveJourney</span><span class="p">]</span><span class="o">.</span><span class="n">journey_arrival_spacecraft_sun_Earth_angle</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">linecell</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39; &#39;</span><span class="p">)[</span><span class="mi">1</span><span class="p">])</span>
                <span class="k">elif</span> <span class="n">linecell</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">==</span> <span class="s2">&quot;Journey electric propellant used&quot;</span><span class="p">:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">Journeys</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">ActiveJourney</span><span class="p">]</span><span class="o">.</span><span class="n">journey_electric_propellant_used</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">linecell</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39; &#39;</span><span class="p">)[</span><span class="mi">1</span><span class="p">])</span>
                <span class="k">elif</span> <span class="n">linecell</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">==</span> <span class="s2">&quot;Journey chemical propellant used&quot;</span><span class="p">:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">Journeys</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">ActiveJourney</span><span class="p">]</span><span class="o">.</span><span class="n">journey_chemical_propellant_used</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">linecell</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39; &#39;</span><span class="p">)[</span><span class="mi">1</span><span class="p">])</span>
                <span class="k">elif</span> <span class="n">linecell</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">==</span> <span class="s2">&quot;BEGIN_BOUNDARY_CONSTRAINT_BLOCK&quot;</span><span class="p">:</span>
                    <span class="n">grabbingBoundaryConstraintOutput</span> <span class="o">=</span> <span class="kc">True</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">Journeys</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">ActiveJourney</span><span class="p">]</span><span class="o">.</span><span class="n">BoundaryConstraintOutputs</span> <span class="o">=</span> <span class="p">[]</span>
                <span class="k">elif</span> <span class="n">linecell</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">==</span> <span class="s2">&quot;END_BOUNDARY_CONSTRAINT_BLOCK&quot;</span><span class="p">:</span>
                    <span class="n">grabbingBoundaryConstraintOutput</span> <span class="o">=</span> <span class="kc">False</span>
                <span class="k">elif</span> <span class="n">grabbingBoundaryConstraintOutput</span> <span class="o">==</span> <span class="kc">True</span><span class="p">:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">Journeys</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">ActiveJourney</span><span class="p">]</span><span class="o">.</span><span class="n">BoundaryConstraintOutputs</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">lineStripped</span><span class="p">)</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="c1">#parse event lines</span>
                    <span class="n">inputcell</span> <span class="o">=</span> <span class="n">line</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;|&#39;</span><span class="p">)</span>
                    <span class="k">if</span> <span class="n">inputcell</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">strip</span><span class="p">(</span><span class="s1">&#39; &#39;</span><span class="p">)</span><span class="o">.</span><span class="n">isdigit</span><span class="p">():</span>
                        <span class="n">tempEvent</span> <span class="o">=</span> <span class="n">MissionEvent</span><span class="o">.</span><span class="n">MissionEvent</span><span class="p">(</span> <span class="bp">self</span><span class="o">.</span><span class="n">Journeys</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">ActiveJourney</span><span class="p">],</span> <span class="n">inputcell</span><span class="p">)</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">Journeys</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">ActiveJourney</span><span class="p">]</span><span class="o">.</span><span class="n">missionevents</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">tempEvent</span><span class="p">)</span>
                        <span class="k">del</span> <span class="n">tempEvent</span>
                    <span class="k">del</span> <span class="n">inputcell</span>

            <span class="k">elif</span> <span class="n">linecell</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">==</span> <span class="s2">&quot;Total deterministic deltav (km/s)&quot;</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">total_deterministic_deltav</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">linecell</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>

            <span class="k">elif</span> <span class="n">linecell</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">==</span> <span class="s2">&quot;Total statistical deltav (km/s)&quot;</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">total_statistical_deltav</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">linecell</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>

            <span class="k">elif</span> <span class="n">linecell</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">==</span> <span class="s2">&quot;Flight time (y)&quot;</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">total_flight_time_years</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">linecell</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>

                <span class="n">spacecraft_mass_data_mode</span> <span class="o">=</span> <span class="kc">True</span>
                
            <span class="k">elif</span> <span class="n">linecell</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">==</span> <span class="s2">&quot;First thrusting in control step&quot;</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">first_thrust_event</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">linecell</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>        

            <span class="k">elif</span> <span class="s2">&quot;Worst constraint is&quot;</span> <span class="ow">in</span> <span class="n">linecell</span><span class="p">[</span><span class="mi">0</span><span class="p">]:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">worst_constraint</span> <span class="o">=</span> <span class="n">line</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;is &#39;</span><span class="p">)[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">lstrip</span><span class="p">(</span><span class="s1">&#39; &#39;</span><span class="p">)</span><span class="o">.</span><span class="n">strip</span><span class="p">(</span><span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">)</span>

            <span class="k">elif</span> <span class="s2">&quot;with violation&quot;</span> <span class="ow">in</span> <span class="n">linecell</span><span class="p">[</span><span class="mi">0</span><span class="p">]:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">worst_violation</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">line</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;violation &quot;</span><span class="p">)[</span><span class="mi">1</span><span class="p">])</span>
                
            
            <span class="k">if</span> <span class="n">spacecraft_mass_data_mode</span><span class="p">:</span>
                <span class="c1">#start a loop</span>
                <span class="n">incumbent_stage_name</span> <span class="o">=</span> <span class="s1">&#39;&#39;</span>

                <span class="k">class</span> <span class="nc">stage_mass_data</span><span class="p">:</span>
                    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">final_mass_including_propellant_margin</span> <span class="o">=</span> <span class="mf">1.0e+20</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">chemical_fuel_with_margin</span> <span class="o">=</span> <span class="mf">1.0e+20</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">chemical_oxidizer_with_margin</span> <span class="o">=</span> <span class="mf">1.0e+20</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">chemical_fuel_used</span> <span class="o">=</span> <span class="mf">1.0e+20</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">chemical_oxidizer_used</span> <span class="o">=</span> <span class="mf">1.0e+20</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">total_electric_propellant_including_margin</span> <span class="o">=</span> <span class="mf">1.0e+20</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">total_electric_propellant_used</span> <span class="o">=</span> <span class="mf">1.0e+20</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">spacecraft_dry_mass_margin</span> <span class="o">=</span> <span class="mf">1.0e+20</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">spacecraft_dry_mass</span> <span class="o">=</span> <span class="mf">1.0e+20</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">total_pressurant</span> <span class="o">=</span> <span class="mf">1.0e+20</span>

                <span class="k">while</span> <span class="ow">not</span> <span class="n">linecell</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s1">&#39;Objective function is&#39;</span><span class="p">):</span>
                    <span class="n">linecell</span> <span class="o">=</span> <span class="nb">next</span><span class="p">(</span><span class="n">inputfile</span><span class="p">)</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;:&#39;</span><span class="p">)</span>

                    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">linecell</span><span class="p">)</span> <span class="o">&lt;</span> <span class="mi">3</span><span class="p">:</span>
                        <span class="k">continue</span>

                    <span class="n">stage_name</span> <span class="o">=</span> <span class="n">linecell</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>

                    <span class="k">if</span> <span class="n">stage_name</span> <span class="o">!=</span> <span class="n">incumbent_stage_name</span><span class="p">:</span>
                        <span class="n">incumbent_stage_name</span> <span class="o">=</span> <span class="n">stage_name</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">spacecraft_mass_data</span><span class="p">[</span><span class="n">stage_name</span><span class="p">]</span> <span class="o">=</span> <span class="n">stage_mass_data</span><span class="p">()</span>

                    <span class="k">if</span> <span class="n">linecell</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">lstrip</span><span class="p">(</span><span class="s2">&quot; &quot;</span><span class="p">)</span> <span class="o">==</span> <span class="s2">&quot;Dry mass (kg)&quot;</span><span class="p">:</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">spacecraft_mass_data</span><span class="p">[</span><span class="n">stage_name</span><span class="p">]</span><span class="o">.</span><span class="n">spacecraft_dry_mass</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">linecell</span><span class="p">[</span><span class="mi">2</span><span class="p">])</span>

                    <span class="k">elif</span> <span class="n">linecell</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">lstrip</span><span class="p">(</span><span class="s2">&quot; &quot;</span><span class="p">)</span> <span class="o">==</span> <span class="s2">&quot;Final mass including propellant margin (kg)&quot;</span><span class="p">:</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">spacecraft_mass_data</span><span class="p">[</span><span class="n">stage_name</span><span class="p">]</span><span class="o">.</span><span class="n">final_mass_including_propellant_margin</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">linecell</span><span class="p">[</span><span class="mi">2</span><span class="p">])</span>

                    <span class="k">elif</span> <span class="n">linecell</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">lstrip</span><span class="p">(</span><span class="s2">&quot; &quot;</span><span class="p">)</span> <span class="o">==</span> <span class="s2">&quot;Total chemical fuel (kg)&quot;</span><span class="p">:</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">spacecraft_mass_data</span><span class="p">[</span><span class="n">stage_name</span><span class="p">]</span><span class="o">.</span><span class="n">chemical_fuel_with_margin</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">linecell</span><span class="p">[</span><span class="mi">2</span><span class="p">])</span>

                    <span class="k">elif</span> <span class="n">linecell</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">lstrip</span><span class="p">(</span><span class="s2">&quot; &quot;</span><span class="p">)</span> <span class="o">==</span> <span class="s2">&quot;Total chemical oxidizer (kg)&quot;</span><span class="p">:</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">spacecraft_mass_data</span><span class="p">[</span><span class="n">stage_name</span><span class="p">]</span><span class="o">.</span><span class="n">chemical_oxidizer_with_margin</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">linecell</span><span class="p">[</span><span class="mi">2</span><span class="p">])</span>

                    <span class="k">elif</span> <span class="n">linecell</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">lstrip</span><span class="p">(</span><span class="s2">&quot; &quot;</span><span class="p">)</span> <span class="o">==</span> <span class="s2">&quot;Chemical fuel used (kg)&quot;</span><span class="p">:</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">spacecraft_mass_data</span><span class="p">[</span><span class="n">stage_name</span><span class="p">]</span><span class="o">.</span><span class="n">chemical_fuel_used</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">linecell</span><span class="p">[</span><span class="mi">2</span><span class="p">])</span>

                    <span class="k">elif</span> <span class="n">linecell</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">lstrip</span><span class="p">(</span><span class="s2">&quot; &quot;</span><span class="p">)</span> <span class="o">==</span> <span class="s2">&quot;Chemical oxidizer used (kg)&quot;</span><span class="p">:</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">spacecraft_mass_data</span><span class="p">[</span><span class="n">stage_name</span><span class="p">]</span><span class="o">.</span><span class="n">chemical_oxidizer_used</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">linecell</span><span class="p">[</span><span class="mi">2</span><span class="p">])</span>

                    <span class="k">elif</span> <span class="n">linecell</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">lstrip</span><span class="p">(</span><span class="s2">&quot; &quot;</span><span class="p">)</span> <span class="o">==</span> <span class="s2">&quot;Total electric propellant (kg)&quot;</span><span class="p">:</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">spacecraft_mass_data</span><span class="p">[</span><span class="n">stage_name</span><span class="p">]</span><span class="o">.</span><span class="n">total_electric_propellant_including_margin</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">linecell</span><span class="p">[</span><span class="mi">2</span><span class="p">])</span>

                    <span class="k">elif</span> <span class="n">linecell</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">lstrip</span><span class="p">(</span><span class="s2">&quot; &quot;</span><span class="p">)</span> <span class="o">==</span> <span class="s2">&quot;Electric propellant used (kg)&quot;</span><span class="p">:</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">spacecraft_mass_data</span><span class="p">[</span><span class="n">stage_name</span><span class="p">]</span><span class="o">.</span><span class="n">total_electric_propellant_used</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">linecell</span><span class="p">[</span><span class="mi">2</span><span class="p">])</span>

                    <span class="k">elif</span> <span class="n">linecell</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">lstrip</span><span class="p">(</span><span class="s2">&quot; &quot;</span><span class="p">)</span> <span class="o">==</span> <span class="s2">&quot;Dry mass margin&quot;</span><span class="p">:</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">spacecraft_mass_data</span><span class="p">[</span><span class="n">stage_name</span><span class="p">]</span><span class="o">.</span><span class="n">spacecraft_dry_mass_margin</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">linecell</span><span class="p">[</span><span class="mi">2</span><span class="p">])</span>

                    <span class="k">elif</span> <span class="n">linecell</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">lstrip</span><span class="p">(</span><span class="s2">&quot; &quot;</span><span class="p">)</span> <span class="o">==</span> <span class="s2">&quot;Dry mass (kg)&quot;</span><span class="p">:</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">spacecraft_mass_data</span><span class="p">[</span><span class="n">stage_name</span><span class="p">]</span><span class="o">.</span><span class="n">spacecraft_dry_mass</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">linecell</span><span class="p">[</span><span class="mi">2</span><span class="p">])</span>

                    <span class="k">elif</span> <span class="n">linecell</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">lstrip</span><span class="p">(</span><span class="s2">&quot; &quot;</span><span class="p">)</span> <span class="o">==</span> <span class="s1">&#39;Total pressurant (kg)&#39;</span><span class="p">:</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">spacecraft_mass_data</span><span class="p">[</span><span class="n">stage_name</span><span class="p">]</span><span class="o">.</span><span class="n">total_pressurant</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">linecell</span><span class="p">[</span><span class="mi">2</span><span class="p">])</span>
                <span class="c1">#out of the loop, so set mass mode to false</span>
                <span class="n">spacecraft_mass_data_mode</span> <span class="o">=</span> <span class="kc">False</span>

                <span class="c1">#now populate the global data fields</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">spacecraft_dry_mass</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">spacecraft_mass_data</span><span class="p">[</span><span class="s1">&#39;Spacecraft&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">spacecraft_dry_mass</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">final_mass_including_propellant_margin</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">spacecraft_mass_data</span><span class="p">[</span><span class="s1">&#39;Spacecraft&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">final_mass_including_propellant_margin</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">chemical_fuel_with_margin</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">spacecraft_mass_data</span><span class="p">[</span><span class="s1">&#39;Spacecraft&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">chemical_fuel_with_margin</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">chemical_oxidizer_with_margin</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">spacecraft_mass_data</span><span class="p">[</span><span class="s1">&#39;Spacecraft&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">chemical_oxidizer_with_margin</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">chemical_fuel_used</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">spacecraft_mass_data</span><span class="p">[</span><span class="s1">&#39;Spacecraft&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">chemical_fuel_used</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">chemical_oxidizer_used</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">spacecraft_mass_data</span><span class="p">[</span><span class="s1">&#39;Spacecraft&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">chemical_oxidizer_used</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">total_electric_propellant_including_margin</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">spacecraft_mass_data</span><span class="p">[</span><span class="s1">&#39;Spacecraft&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">total_electric_propellant_including_margin</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">total_electric_propellant_used</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">spacecraft_mass_data</span><span class="p">[</span><span class="s1">&#39;Spacecraft&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">total_electric_propellant_used</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">spacecraft_dry_mass_margin</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">spacecraft_mass_data</span><span class="p">[</span><span class="s1">&#39;Spacecraft&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">spacecraft_dry_mass_margin</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">total_pressurant</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">spacecraft_mass_data</span><span class="p">[</span><span class="s1">&#39;Spacecraft&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">total_pressurant</span>
                
            <span class="k">elif</span> <span class="n">line</span><span class="p">[</span><span class="mi">0</span><span class="p">:</span><span class="mi">4</span><span class="p">]</span> <span class="o">==</span> <span class="s1">&#39;J = &#39;</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">objective_value</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">line</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s1">&#39;J = &#39;</span><span class="p">,</span><span class="s1">&#39;&#39;</span><span class="p">))</span>
            <span class="k">elif</span> <span class="s2">&quot;Was first NLP solve feasible&quot;</span> <span class="ow">in</span> <span class="n">linecell</span><span class="p">[</span><span class="mi">0</span><span class="p">]:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">first_nlp_solve_feasible</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">linecell</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>
            <span class="k">elif</span> <span class="s2">&quot;Objective function value from first NLP solve&quot;</span> <span class="ow">in</span> <span class="n">linecell</span><span class="p">[</span><span class="mi">0</span><span class="p">]:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">objective_value_first_nlp_solve</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">linecell</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>
            <span class="k">elif</span> <span class="s2">&quot;Number of solution attempts&quot;</span> <span class="ow">in</span> <span class="n">linecell</span><span class="p">[</span><span class="mi">0</span><span class="p">]:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">number_of_solution_attempts</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">linecell</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>
            <span class="k">elif</span> <span class="s2">&quot;Solution attempt that produced a feasible solution&quot;</span> <span class="ow">in</span> <span class="n">linecell</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="ow">and</span> <span class="s2">&quot;Time&quot;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">linecell</span><span class="p">[</span><span class="mi">0</span><span class="p">]:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">solution_attempt_index_that_produced_best_feasible_solution</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">linecell</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>
            <span class="k">elif</span> <span class="s2">&quot;Time to completion of solution attempt that produced a feasible solution&quot;</span> <span class="ow">in</span> <span class="n">linecell</span><span class="p">[</span><span class="mi">0</span><span class="p">]:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">timeToCompletionOfBestSolutionAttempt</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">linecell</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>
        
        <span class="n">inputfile</span><span class="o">.</span><span class="n">close</span><span class="p">()</span></div>


<div class="viewcode-block" id="Mission.Generate1Dto2DInitialGuess">
<a class="viewcode-back" href="../PyEMTG/Mission.html#Mission.Mission.Generate1Dto2DInitialGuess">[docs]</a>
    <span class="k">def</span> <span class="nf">Generate1Dto2DInitialGuess</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">throttle_table_file</span><span class="p">,</span><span class="n">command_var</span><span class="p">):</span>
        <span class="n">DecVec</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="n">decvec_idx</span> <span class="o">=</span> <span class="mi">0</span>
            
        <span class="n">thruster_throttle_table</span> <span class="o">=</span> <span class="n">ThrottleTable</span><span class="o">.</span><span class="n">ThrottleTable</span><span class="p">(</span><span class="n">throttle_table_file</span><span class="p">)</span>
    
        <span class="k">if</span> <span class="n">command_var</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
            <span class="n">max_mdot</span> <span class="o">=</span> <span class="n">thruster_throttle_table</span><span class="o">.</span><span class="n">max_mdot</span>
        <span class="k">elif</span> <span class="n">command_var</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
            <span class="n">max_voltage</span> <span class="o">=</span> <span class="n">thruster_throttle_table</span><span class="o">.</span><span class="n">max_voltage</span>           
    
        <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">Journeys</span><span class="p">:</span>
            <span class="k">for</span> <span class="n">e</span> <span class="ow">in</span> <span class="n">j</span><span class="o">.</span><span class="n">missionevents</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">e</span><span class="o">.</span><span class="n">EventType</span> <span class="ow">in</span> <span class="p">[</span><span class="s1">&#39;SFthrust&#39;</span><span class="p">,</span> <span class="s1">&#39;SSFthrust&#39;</span><span class="p">,</span> <span class="s1">&#39;FBLTSthrust&#39;</span><span class="p">,</span> <span class="s1">&#39;FBLTthrust&#39;</span><span class="p">,</span> <span class="s1">&#39;PSBIthrust&#39;</span><span class="p">,</span> <span class="s1">&#39;end_spiral&#39;</span><span class="p">,</span><span class="s1">&#39;PSFBthrust&#39;</span><span class="p">]:</span>
                    <span class="n">Rmat</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([[</span><span class="mf">1.0</span><span class="p">,</span><span class="mf">0.0</span><span class="p">,</span><span class="mf">0.0</span><span class="p">],[</span><span class="mf">0.0</span><span class="p">,</span><span class="mf">0.91748206</span><span class="p">,</span><span class="o">-</span><span class="mf">0.397777156</span><span class="p">],[</span><span class="mf">0.0</span><span class="p">,</span><span class="mf">0.39777716</span><span class="p">,</span><span class="mf">0.9174820621</span><span class="p">]])</span>
                
                    <span class="k">for</span> <span class="n">i_control</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="mi">3</span><span class="p">):</span>
                        <span class="n">DecVec</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">DecisionVector</span><span class="p">[</span><span class="n">decvec_idx</span><span class="p">])</span>
                        <span class="n">decvec_idx</span> <span class="o">+=</span> <span class="mi">1</span>
                
                    <span class="k">if</span> <span class="n">e</span><span class="o">.</span><span class="n">Number_of_Active_Engines</span><span class="p">:</span>
                        <span class="n">ThrottleLevel</span> <span class="o">=</span> <span class="n">thruster_throttle_table</span><span class="o">.</span><span class="n">find_nearest_throttle_setting_2D</span><span class="p">(</span><span class="n">e</span><span class="o">.</span><span class="n">MassFlowRate</span> <span class="o">/</span> <span class="n">e</span><span class="o">.</span><span class="n">Number_of_Active_Engines</span> <span class="o">*</span> <span class="mf">1e6</span> <span class="o">/</span> <span class="n">e</span><span class="o">.</span><span class="n">DVmagorThrottle</span><span class="p">,</span> <span class="n">e</span><span class="o">.</span><span class="n">AvailableThrust</span> <span class="o">/</span> <span class="n">e</span><span class="o">.</span><span class="n">Number_of_Active_Engines</span> <span class="o">*</span> <span class="mf">1e3</span><span class="p">)</span>
                                                                                    
                        <span class="k">if</span> <span class="n">command_var</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
                            <span class="n">DecVec</span><span class="o">.</span><span class="n">append</span><span class="p">((</span><span class="n">thruster_throttle_table</span><span class="o">.</span><span class="n">get_mdot</span><span class="p">(</span><span class="n">ThrottleLevel</span><span class="p">)</span> <span class="o">+</span> <span class="mf">.05</span><span class="p">)</span><span class="o">/</span><span class="p">(</span><span class="n">max_mdot</span><span class="o">*</span><span class="mf">1.1</span><span class="p">))</span>
                        <span class="k">if</span> <span class="n">command_var</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
                            <span class="n">DecVec</span><span class="o">.</span><span class="n">append</span><span class="p">((</span><span class="n">thruster_throttle_table</span><span class="o">.</span><span class="n">get_voltage</span><span class="p">(</span><span class="n">ThrottleLevel</span><span class="p">)</span> <span class="o">+</span> <span class="mi">5</span><span class="p">)</span><span class="o">/</span><span class="p">(</span><span class="n">max_voltage</span><span class="o">*</span><span class="mf">1.1</span><span class="p">))</span>
                    <span class="k">else</span><span class="p">:</span>
                        <span class="n">DecVec</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="mf">0.0</span><span class="p">)</span>
            
                <span class="k">elif</span> <span class="n">e</span><span class="o">.</span><span class="n">EventType</span> <span class="ow">in</span> <span class="p">[</span><span class="s1">&#39;coast&#39;</span><span class="p">,</span> <span class="s1">&#39;nav-coast&#39;</span><span class="p">]:</span>

                    <span class="k">for</span> <span class="n">i_control</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="mi">3</span><span class="p">):</span>
                        <span class="n">DecVec</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">DecisionVector</span><span class="p">[</span><span class="n">decvec_idx</span><span class="p">])</span>
                        <span class="n">decvec_idx</span> <span class="o">+=</span> <span class="mi">1</span>
                        
                    <span class="n">DecVec</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="mf">0.0</span><span class="p">)</span>
                        
                <span class="k">elif</span> <span class="n">e</span><span class="o">.</span><span class="n">EventType</span> <span class="o">==</span> <span class="s1">&#39;launch&#39;</span> <span class="ow">or</span> <span class="n">e</span><span class="o">.</span><span class="n">EventType</span> <span class="o">==</span> <span class="s1">&#39;launch&#39;</span> <span class="ow">or</span> <span class="n">e</span><span class="o">.</span><span class="n">EventType</span> <span class="o">==</span> <span class="s1">&#39;pwr_flyby&#39;</span> <span class="ow">or</span> <span class="n">e</span><span class="o">.</span><span class="n">EventType</span> <span class="o">==</span> <span class="s1">&#39;upwr_flyby&#39;</span> <span class="ow">or</span> <span class="n">e</span><span class="o">.</span><span class="n">EventType</span> <span class="o">==</span> <span class="s1">&#39;departure&#39;</span><span class="p">:</span>
                    
                    <span class="c1"># add header</span>
                    <span class="k">while</span> <span class="s2">&quot;u_&quot;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">Xdescriptions</span><span class="p">[</span><span class="n">decvec_idx</span><span class="p">]:</span>
                        <span class="n">DecVec</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">DecisionVector</span><span class="p">[</span><span class="n">decvec_idx</span><span class="p">])</span>
                        <span class="n">decvec_idx</span> <span class="o">+=</span> <span class="mi">1</span>                        
    
        <span class="k">return</span> <span class="n">DecVec</span></div>


<div class="viewcode-block" id="Mission.Generate2Dto1DInitialGuess">
<a class="viewcode-back" href="../PyEMTG/Mission.html#Mission.Mission.Generate2Dto1DInitialGuess">[docs]</a>
    <span class="k">def</span> <span class="nf">Generate2Dto1DInitialGuess</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>

        <span class="n">DecVec</span> <span class="o">=</span> <span class="p">[]</span>
        
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">DecisionVector</span><span class="p">)):</span>
            <span class="k">if</span> <span class="s1">&#39;mdot&#39;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">Xdescriptions</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="ow">and</span> <span class="s1">&#39;voltage&#39;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">Xdescriptions</span><span class="p">[</span><span class="n">i</span><span class="p">]:</span>
                <span class="n">DecVec</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">DecisionVector</span><span class="p">[</span><span class="n">i</span><span class="p">])</span>
                
        <span class="k">return</span> <span class="n">DecVec</span></div>


<div class="viewcode-block" id="Mission.PlotMission">
<a class="viewcode-back" href="../PyEMTG/Mission.html#Mission.Mission.PlotMission">[docs]</a>
    <span class="k">def</span> <span class="nf">PlotMission</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">PlotOptions</span><span class="p">,</span> <span class="n">ShowFigure</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">CustomLabels</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="kn">import</span> <span class="nn">matplotlib</span>
        <span class="kn">import</span> <span class="nn">matplotlib.pyplot</span>
        <span class="n">matplotlib</span><span class="o">.</span><span class="n">use</span><span class="p">(</span><span class="s1">&#39;wxagg&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">MissionFigure</span> <span class="o">=</span> <span class="n">matplotlib</span><span class="o">.</span><span class="n">pyplot</span><span class="o">.</span><span class="n">figure</span><span class="p">()</span>
        <span class="n">matplotlib</span><span class="o">.</span><span class="n">rcParams</span><span class="o">.</span><span class="n">update</span><span class="p">({</span><span class="s1">&#39;font.size&#39;</span><span class="p">:</span> <span class="n">PlotOptions</span><span class="o">.</span><span class="n">FontSize</span><span class="p">})</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">MissionFigure</span><span class="o">.</span><span class="n">subplots_adjust</span><span class="p">(</span><span class="n">left</span><span class="o">=</span><span class="mf">0.01</span><span class="p">,</span> <span class="n">right</span><span class="o">=</span><span class="mf">0.99</span><span class="p">,</span> <span class="n">bottom</span><span class="o">=</span><span class="mf">0.01</span><span class="p">,</span> <span class="n">top</span><span class="o">=</span><span class="mf">0.99</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">MissionAxes</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">MissionFigure</span><span class="o">.</span><span class="n">add_axes</span><span class="p">([</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">],</span> <span class="n">projection</span><span class="o">=</span><span class="s1">&#39;3d&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">MissionAxes</span><span class="o">.</span><span class="n">xaxis</span><span class="o">.</span><span class="n">pane</span><span class="o">.</span><span class="n">fill</span> <span class="o">=</span> <span class="kc">False</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">MissionAxes</span><span class="o">.</span><span class="n">yaxis</span><span class="o">.</span><span class="n">pane</span><span class="o">.</span><span class="n">fill</span> <span class="o">=</span> <span class="kc">False</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">MissionAxes</span><span class="o">.</span><span class="n">zaxis</span><span class="o">.</span><span class="n">pane</span><span class="o">.</span><span class="n">fill</span> <span class="o">=</span> <span class="kc">False</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">MissionAxes</span><span class="o">.</span><span class="n">xaxis</span><span class="o">.</span><span class="n">_axinfo</span><span class="p">[</span><span class="s1">&#39;tick&#39;</span><span class="p">][</span><span class="s1">&#39;inward_factor&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">MissionAxes</span><span class="o">.</span><span class="n">xaxis</span><span class="o">.</span><span class="n">_axinfo</span><span class="p">[</span><span class="s1">&#39;tick&#39;</span><span class="p">][</span><span class="s1">&#39;outward_factor&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="mf">0.2</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">MissionAxes</span><span class="o">.</span><span class="n">yaxis</span><span class="o">.</span><span class="n">_axinfo</span><span class="p">[</span><span class="s1">&#39;tick&#39;</span><span class="p">][</span><span class="s1">&#39;inward_factor&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">MissionAxes</span><span class="o">.</span><span class="n">yaxis</span><span class="o">.</span><span class="n">_axinfo</span><span class="p">[</span><span class="s1">&#39;tick&#39;</span><span class="p">][</span><span class="s1">&#39;outward_factor&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="mf">0.2</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">MissionAxes</span><span class="o">.</span><span class="n">zaxis</span><span class="o">.</span><span class="n">_axinfo</span><span class="p">[</span><span class="s1">&#39;tick&#39;</span><span class="p">][</span><span class="s1">&#39;inward_factor&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">MissionAxes</span><span class="o">.</span><span class="n">zaxis</span><span class="o">.</span><span class="n">_axinfo</span><span class="p">[</span><span class="s1">&#39;tick&#39;</span><span class="p">][</span><span class="s1">&#39;outward_factor&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="mf">0.2</span>
        <span class="c1">#self.MissionAxes.set_aspect(&#39;equal&#39;) # commented out becausee not supported by matplotlib as of Feb 2019</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">MissionAxes</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s1">&#39;</span><span class="se">\n</span><span class="s1">x (km)&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">MissionAxes</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s1">&#39;</span><span class="se">\n</span><span class="s1">y (km)&#39;</span><span class="p">)</span>
        <span class="c1"># self.MissionAxes.set_zlabel(&#39;\nz (km)&#39;)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">MissionAxes</span><span class="o">.</span><span class="n">w_zaxis</span><span class="o">.</span><span class="n">line</span><span class="o">.</span><span class="n">set_lw</span><span class="p">(</span><span class="mf">0.</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">MissionAxes</span><span class="o">.</span><span class="n">set_zticks</span><span class="p">([])</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">MissionAxes</span><span class="o">.</span><span class="n">autoscale_view</span><span class="p">(</span><span class="n">tight</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">scalex</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">scaley</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">scalez</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">MissionAxes</span><span class="o">.</span><span class="n">view_init</span><span class="p">(</span><span class="n">elev</span><span class="o">=</span><span class="mi">90</span><span class="p">,</span> <span class="n">azim</span><span class="o">=-</span><span class="mi">90</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">MissionAxes</span><span class="o">.</span><span class="n">grid</span><span class="p">(</span><span class="n">b</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
        

        <span class="c1">#reset the event label counter</span>
        <span class="n">PlotOptions</span><span class="o">.</span><span class="n">EventCounter</span> <span class="o">=</span> <span class="mi">1</span>

        <span class="c1">#load DEfile if we have to</span>
        <span class="n">mySpiceHandler</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">if</span> <span class="n">PlotOptions</span><span class="o">.</span><span class="n">PlotCentralBody</span> <span class="o">!=</span> <span class="s1">&#39;Journey central body&#39;</span><span class="p">:</span>
            <span class="kn">from</span> <span class="nn">sys</span> <span class="kn">import</span> <span class="n">path</span>
            <span class="kn">from</span> <span class="nn">os.path</span> <span class="kn">import</span> <span class="n">dirname</span><span class="p">,</span> <span class="n">join</span>
            <span class="kn">from</span> <span class="nn">pathlib</span> <span class="kn">import</span> <span class="n">Path</span>

            <span class="n">PyEMTG_path</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="n">Path</span><span class="p">()</span><span class="o">.</span><span class="n">absolute</span><span class="p">())</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s1">&#39;</span><span class="se">\\</span><span class="s1">&#39;</span><span class="p">,</span><span class="s1">&#39;/&#39;</span><span class="p">)</span>
            <span class="n">path</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">PyEMTG_path</span> <span class="o">+</span> <span class="s1">&#39;/SpiceyPy_Utilities&#39;</span><span class="p">)</span>
            <span class="kn">import</span> <span class="nn">SpiceyPy_Utilities</span>
            <span class="n">mySpiceHandler</span> <span class="o">=</span> <span class="n">SpiceyPy_Utilities</span><span class="o">.</span><span class="n">SpiceHandler</span><span class="p">(</span><span class="n">PlotOptions</span><span class="o">.</span><span class="n">SPICEpath</span><span class="p">)</span>
            <span class="n">mySpiceHandler</span><span class="o">.</span><span class="n">loadSpiceFiles</span><span class="p">()</span>

        <span class="c1">#plot journey boundary orbits</span>
        <span class="k">if</span> <span class="n">PlotOptions</span><span class="o">.</span><span class="n">ShowBoundaryOrbits</span><span class="p">:</span>
            <span class="k">for</span> <span class="n">ActiveJourney</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">ChosenJourneys</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">ActiveJourney</span> <span class="o">=</span> <span class="n">ActiveJourney</span>
                <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">ActiveJourney</span> <span class="o">&lt;=</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">Journeys</span><span class="p">)</span> <span class="o">-</span> <span class="mi">1</span><span class="p">:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">Journeys</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">ActiveJourney</span><span class="p">]</span><span class="o">.</span><span class="n">PlotJourneyBoundaryOrbits</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">MissionAxes</span><span class="p">,</span> <span class="n">PlotOptions</span><span class="p">)</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="k">for</span> <span class="n">CurrentJourney</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">Journeys</span><span class="p">:</span>
                        <span class="n">CurrentJourney</span><span class="o">.</span><span class="n">PlotJourneyBoundaryOrbits</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">MissionAxes</span><span class="p">,</span> <span class="n">PlotOptions</span><span class="p">)</span>

        <span class="c1">#plot journey central body orbits</span>
        <span class="k">if</span> <span class="n">PlotOptions</span><span class="o">.</span><span class="n">ShowCentralBodyOrbits</span><span class="p">:</span>
            <span class="k">for</span> <span class="n">ActiveJourney</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">ChosenJourneys</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">ActiveJourney</span> <span class="o">=</span> <span class="n">ActiveJourney</span>
                <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">ActiveJourney</span> <span class="o">&lt;=</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">Journeys</span><span class="p">)</span> <span class="o">-</span> <span class="mi">1</span><span class="p">:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">Journeys</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">ActiveJourney</span><span class="p">]</span><span class="o">.</span><span class="n">PlotJourneyCentralBodyOrbits</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">MissionAxes</span><span class="p">,</span> <span class="n">PlotOptions</span><span class="p">)</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="k">for</span> <span class="n">CurrentJourney</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">Journeys</span><span class="p">:</span>
                        <span class="n">CurrentJourney</span><span class="o">.</span><span class="n">PlotJourneyCentralBodyOrbits</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">MissionAxes</span><span class="p">,</span> <span class="n">PlotOptions</span><span class="p">)</span>

        <span class="c1">#plot the trajectory</span>
        <span class="k">for</span> <span class="n">ActiveJourney</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">ChosenJourneys</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">ActiveJourney</span> <span class="o">=</span> <span class="n">ActiveJourney</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">ActiveJourney</span> <span class="o">&lt;=</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">Journeys</span><span class="p">)</span> <span class="o">-</span> <span class="mi">1</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">Journeys</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">ActiveJourney</span><span class="p">]</span><span class="o">.</span><span class="n">PlotJourney</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">MissionAxes</span><span class="p">,</span> <span class="n">PlotOptions</span><span class="p">,</span> <span class="n">CustomLabels</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">for</span> <span class="n">CurrentJourney</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">Journeys</span><span class="p">:</span>
                    <span class="n">CurrentJourney</span><span class="o">.</span><span class="n">PlotJourney</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">MissionAxes</span><span class="p">,</span> <span class="n">PlotOptions</span><span class="p">,</span> <span class="n">CustomLabels</span><span class="p">)</span>

        <span class="c1">#unload DEfile if we have to</span>
        <span class="k">if</span> <span class="n">PlotOptions</span><span class="o">.</span><span class="n">PlotCentralBody</span> <span class="o">!=</span> <span class="s1">&#39;Journey central body&#39;</span><span class="p">:</span>
            <span class="n">mySpiceHandler</span><span class="o">.</span><span class="n">unloadSpiceFiles</span><span class="p">()</span>

        <span class="c1">#plot the central body</span>
        <span class="n">u</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">2</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="p">,</span> <span class="mi">100</span><span class="p">)</span>
        <span class="n">v</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="p">,</span> <span class="mi">100</span><span class="p">)</span>

        <span class="n">central_body_radius</span> <span class="o">=</span> <span class="mf">1.0</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">ActiveJourney</span> <span class="o">&lt;=</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">Journeys</span><span class="p">)</span> <span class="o">-</span> <span class="mi">1</span><span class="p">:</span>
            <span class="n">central_body_radius</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">Journeys</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">ActiveJourney</span><span class="p">]</span><span class="o">.</span><span class="n">central_body_radius</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">central_body_radius</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">Journeys</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">central_body_radius</span>
        <span class="n">x</span> <span class="o">=</span> <span class="n">central_body_radius</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">outer</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">cos</span><span class="p">(</span><span class="n">u</span><span class="p">),</span> <span class="n">np</span><span class="o">.</span><span class="n">sin</span><span class="p">(</span><span class="n">v</span><span class="p">))</span>
        <span class="n">y</span> <span class="o">=</span> <span class="n">central_body_radius</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">outer</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">sin</span><span class="p">(</span><span class="n">u</span><span class="p">),</span> <span class="n">np</span><span class="o">.</span><span class="n">sin</span><span class="p">(</span><span class="n">v</span><span class="p">))</span>
        <span class="n">z</span> <span class="o">=</span> <span class="n">central_body_radius</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">outer</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">ones</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">size</span><span class="p">(</span><span class="n">u</span><span class="p">)),</span> <span class="n">np</span><span class="o">.</span><span class="n">cos</span><span class="p">(</span><span class="n">v</span><span class="p">))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">MissionAxes</span><span class="o">.</span><span class="n">plot_surface</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">z</span><span class="p">,</span>  <span class="n">rstride</span><span class="o">=</span><span class="mi">10</span><span class="p">,</span> <span class="n">cstride</span><span class="o">=</span><span class="mi">10</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;DarkOrange&#39;</span><span class="p">,</span> <span class="n">linewidth</span><span class="o">=</span><span class="mf">0.5</span><span class="p">,</span> <span class="n">edgecolors</span><span class="o">=</span><span class="s1">&#39;k&#39;</span><span class="p">)</span>

        <span class="n">X</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">MissionAxes</span><span class="o">.</span><span class="n">get_xlim</span><span class="p">()</span>
        <span class="n">Y</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">MissionAxes</span><span class="o">.</span><span class="n">get_ylim</span><span class="p">()</span>
        <span class="n">Z</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">MissionAxes</span><span class="o">.</span><span class="n">get_zlim</span><span class="p">()</span>
        
        <span class="n">Xrange</span> <span class="o">=</span> <span class="n">X</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">-</span> <span class="n">X</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
        <span class="n">Yrange</span> <span class="o">=</span> <span class="n">Y</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">-</span> <span class="n">Y</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
        <span class="n">Zrange</span> <span class="o">=</span> <span class="n">Z</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">-</span> <span class="n">Z</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
        
        <span class="c1"># Create cubic bounding box to simulate equal aspect ratio</span>
        <span class="n">max_range</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">Xrange</span><span class="p">,</span> <span class="n">Yrange</span><span class="p">,</span> <span class="n">Zrange</span><span class="p">])</span><span class="o">.</span><span class="n">max</span><span class="p">()</span>
        <span class="n">Xb</span> <span class="o">=</span> <span class="mf">0.5</span><span class="o">*</span><span class="n">max_range</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">mgrid</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">:</span><span class="mi">2</span><span class="p">:</span><span class="mi">2</span><span class="p">,</span><span class="o">-</span><span class="mi">1</span><span class="p">:</span><span class="mi">2</span><span class="p">:</span><span class="mi">2</span><span class="p">,</span><span class="o">-</span><span class="mi">1</span><span class="p">:</span><span class="mi">2</span><span class="p">:</span><span class="mi">2</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">flatten</span><span class="p">()</span> <span class="o">+</span> <span class="mf">0.5</span><span class="o">*</span><span class="p">(</span><span class="n">Xrange</span><span class="p">)</span>
        <span class="n">Yb</span> <span class="o">=</span> <span class="mf">0.5</span><span class="o">*</span><span class="n">max_range</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">mgrid</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">:</span><span class="mi">2</span><span class="p">:</span><span class="mi">2</span><span class="p">,</span><span class="o">-</span><span class="mi">1</span><span class="p">:</span><span class="mi">2</span><span class="p">:</span><span class="mi">2</span><span class="p">,</span><span class="o">-</span><span class="mi">1</span><span class="p">:</span><span class="mi">2</span><span class="p">:</span><span class="mi">2</span><span class="p">][</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">flatten</span><span class="p">()</span> <span class="o">+</span> <span class="mf">0.5</span><span class="o">*</span><span class="p">(</span><span class="n">Yrange</span><span class="p">)</span>
        <span class="n">Zb</span> <span class="o">=</span> <span class="mf">0.5</span><span class="o">*</span><span class="n">max_range</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">mgrid</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">:</span><span class="mi">2</span><span class="p">:</span><span class="mi">2</span><span class="p">,</span><span class="o">-</span><span class="mi">1</span><span class="p">:</span><span class="mi">2</span><span class="p">:</span><span class="mi">2</span><span class="p">,</span><span class="o">-</span><span class="mi">1</span><span class="p">:</span><span class="mi">2</span><span class="p">:</span><span class="mi">2</span><span class="p">][</span><span class="mi">2</span><span class="p">]</span><span class="o">.</span><span class="n">flatten</span><span class="p">()</span> <span class="o">+</span> <span class="mf">0.5</span><span class="o">*</span><span class="p">(</span><span class="n">Zrange</span><span class="p">)</span>
        <span class="c1"># Comment or uncomment following both lines to test the fake bounding box:</span>
        <span class="k">for</span> <span class="n">xb</span><span class="p">,</span> <span class="n">yb</span><span class="p">,</span> <span class="n">zb</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="n">Xb</span><span class="p">,</span> <span class="n">Yb</span><span class="p">,</span> <span class="n">Zb</span><span class="p">):</span>
           <span class="bp">self</span><span class="o">.</span><span class="n">MissionAxes</span><span class="o">.</span><span class="n">plot</span><span class="p">([</span><span class="n">xb</span><span class="p">],</span> <span class="p">[</span><span class="n">yb</span><span class="p">],</span> <span class="p">[</span><span class="n">zb</span><span class="p">],</span> <span class="s1">&#39;w&#39;</span><span class="p">)</span>
        
        <span class="k">if</span> <span class="n">PlotOptions</span><span class="o">.</span><span class="n">LabelEvents</span> <span class="ow">or</span> <span class="n">CustomLabels</span> <span class="o">!=</span> <span class="kc">None</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">MissionFigure</span><span class="o">.</span><span class="n">canvas</span><span class="o">.</span><span class="n">mpl_connect</span><span class="p">(</span><span class="s1">&#39;button_release_event&#39;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">UpdateLabelPositionsEvent</span><span class="p">)</span>
            
        <span class="k">if</span> <span class="n">PlotOptions</span><span class="o">.</span><span class="n">ShowPlotAxes</span> <span class="o">==</span> <span class="kc">False</span><span class="p">:</span>
            <span class="n">matplotlib</span><span class="o">.</span><span class="n">pyplot</span><span class="o">.</span><span class="n">axis</span><span class="p">(</span><span class="s1">&#39;off&#39;</span><span class="p">)</span>
            <span class="n">matplotlib</span><span class="o">.</span><span class="n">pyplot</span><span class="o">.</span><span class="n">margins</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>
            <span class="n">matplotlib</span><span class="o">.</span><span class="n">pyplot</span><span class="o">.</span><span class="n">gca</span><span class="p">()</span><span class="o">.</span><span class="n">xaxis</span><span class="o">.</span><span class="n">set_major_locator</span><span class="p">(</span><span class="n">matplotlib</span><span class="o">.</span><span class="n">pyplot</span><span class="o">.</span><span class="n">NullLocator</span><span class="p">())</span>
            <span class="n">matplotlib</span><span class="o">.</span><span class="n">pyplot</span><span class="o">.</span><span class="n">gca</span><span class="p">()</span><span class="o">.</span><span class="n">yaxis</span><span class="o">.</span><span class="n">set_major_locator</span><span class="p">(</span><span class="n">matplotlib</span><span class="o">.</span><span class="n">pyplot</span><span class="o">.</span><span class="n">NullLocator</span><span class="p">())</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">MissionAxes</span><span class="o">.</span><span class="n">autoscale_view</span><span class="p">(</span><span class="n">tight</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">scalex</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">scaley</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">scalez</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">MissionAxes</span><span class="o">.</span><span class="n">autoscale</span><span class="p">(</span><span class="n">enable</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span><span class="n">axis</span><span class="o">=</span><span class="s1">&#39;both&#39;</span><span class="p">)</span>  <span class="c1">#you will need this line to change the Z-axis</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">MissionAxes</span><span class="o">.</span><span class="n">set_xbound</span><span class="p">(</span><span class="o">-</span><span class="n">max_range</span><span class="p">,</span> <span class="n">max_range</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">MissionAxes</span><span class="o">.</span><span class="n">set_ybound</span><span class="p">(</span><span class="o">-</span><span class="n">max_range</span><span class="p">,</span> <span class="n">max_range</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">MissionAxes</span><span class="o">.</span><span class="n">set_zbound</span><span class="p">(</span><span class="o">-</span><span class="n">max_range</span><span class="p">,</span> <span class="n">max_range</span><span class="p">)</span>
        
        <span class="k">if</span> <span class="n">ShowFigure</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">MissionFigure</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>

        <span class="c1">#these lines have to be run AFTER MissionFigure.show() is called</span>
        <span class="k">if</span> <span class="p">(</span><span class="n">PlotOptions</span><span class="o">.</span><span class="n">LabelEvents</span> <span class="ow">or</span> <span class="n">CustomLabels</span> <span class="o">!=</span> <span class="kc">None</span><span class="p">)</span> <span class="ow">and</span> <span class="n">ShowFigure</span> <span class="o">==</span> <span class="kc">True</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">UpdateLabelPositions</span><span class="p">()</span>

        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">MissionFigure</span></div>


<div class="viewcode-block" id="Mission.UpdateLabelPositionsEvent">
<a class="viewcode-back" href="../PyEMTG/Mission.html#Mission.Mission.UpdateLabelPositionsEvent">[docs]</a>
    <span class="k">def</span> <span class="nf">UpdateLabelPositionsEvent</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">e</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">UpdateLabelPositions</span><span class="p">()</span></div>


<div class="viewcode-block" id="Mission.UpdateLabelPositions">
<a class="viewcode-back" href="../PyEMTG/Mission.html#Mission.Mission.UpdateLabelPositions">[docs]</a>
    <span class="k">def</span> <span class="nf">UpdateLabelPositions</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>    
        <span class="k">for</span> <span class="n">ActiveJourney</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">ChosenJourneys</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">ActiveJourney</span> <span class="o">=</span> <span class="n">ActiveJourney</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">ActiveJourney</span> <span class="o">&lt;=</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">Journeys</span><span class="p">)</span> <span class="o">-</span> <span class="mi">1</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">Journeys</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">ActiveJourney</span><span class="p">]</span><span class="o">.</span><span class="n">UpdateLabelPosition</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">MissionFigure</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">MissionAxes</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">for</span> <span class="n">CurrentJourney</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">Journeys</span><span class="p">:</span>
                    <span class="n">CurrentJourney</span><span class="o">.</span><span class="n">UpdateLabelPosition</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">MissionFigure</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">MissionAxes</span><span class="p">)</span></div>


<div class="viewcode-block" id="Mission.GenerateDataPlot">
<a class="viewcode-back" href="../PyEMTG/Mission.html#Mission.Mission.GenerateDataPlot">[docs]</a>
    <span class="k">def</span> <span class="nf">GenerateDataPlot</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">PlotOptions</span><span class="p">):</span>
        <span class="kn">import</span> <span class="nn">matplotlib.pyplot</span>
        <span class="k">if</span> <span class="n">PlotOptions</span><span class="o">.</span><span class="n">PlotR</span> <span class="ow">or</span> <span class="n">PlotOptions</span><span class="o">.</span><span class="n">PlotV</span> <span class="ow">or</span> <span class="n">PlotOptions</span><span class="o">.</span><span class="n">PlotThrust</span> <span class="ow">or</span> <span class="n">PlotOptions</span><span class="o">.</span><span class="n">PlotIsp</span> <span class="ow">or</span> <span class="n">PlotOptions</span><span class="o">.</span><span class="n">PlotMdot</span> <span class="ow">or</span> <span class="n">PlotOptions</span><span class="o">.</span><span class="n">PlotEfficiency</span> <span class="ow">or</span> <span class="n">PlotOptions</span><span class="o">.</span><span class="n">PlotThrottle</span> <span class="ow">or</span> <span class="n">PlotOptions</span><span class="o">.</span><span class="n">PlotPower</span> <span class="ow">or</span> <span class="n">PlotOptions</span><span class="o">.</span><span class="n">PlotGamma</span> <span class="ow">or</span> <span class="n">PlotOptions</span><span class="o">.</span><span class="n">PlotDelta</span> <span class="ow">or</span> <span class="n">PlotOptions</span><span class="o">.</span><span class="n">PlotArray_Thrust_Angle</span> <span class="ow">or</span> <span class="n">PlotOptions</span><span class="o">.</span><span class="n">PlotMass</span> <span class="ow">or</span> <span class="n">PlotOptions</span><span class="o">.</span><span class="n">PlotNumberOfEngines</span> <span class="ow">or</span> <span class="n">PlotOptions</span><span class="o">.</span><span class="n">PlotActivePower</span> <span class="ow">or</span> <span class="n">PlotOptions</span><span class="o">.</span><span class="n">PlotWasteHeat</span> <span class="ow">or</span> <span class="n">PlotOptions</span><span class="o">.</span><span class="n">PlotEarthDistance</span> <span class="ow">or</span> <span class="n">PlotOptions</span><span class="o">.</span><span class="n">PlotSunSpacecraftEarthAngle</span> <span class="ow">or</span> <span class="n">PlotOptions</span><span class="o">.</span><span class="n">PlotSpacecraftViewingAngle</span> <span class="ow">or</span> <span class="n">PlotOptions</span><span class="o">.</span><span class="n">PlotThrottleLevel</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">DataFigure</span> <span class="o">=</span> <span class="n">matplotlib</span><span class="o">.</span><span class="n">pyplot</span><span class="o">.</span><span class="n">figure</span><span class="p">()</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">DataAxesLeft</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">DataFigure</span><span class="o">.</span><span class="n">add_axes</span><span class="p">([</span><span class="mf">0.1</span><span class="p">,</span> <span class="mf">0.1</span><span class="p">,</span> <span class="mf">0.8</span><span class="p">,</span> <span class="mf">0.8</span><span class="p">])</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">DataAxesRight</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">DataAxesLeft</span><span class="o">.</span><span class="n">twinx</span><span class="p">()</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">MouseAxes</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">DataAxesLeft</span><span class="o">.</span><span class="n">figure</span><span class="o">.</span><span class="n">add_axes</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">DataAxesLeft</span><span class="o">.</span><span class="n">get_position</span><span class="p">(</span><span class="kc">True</span><span class="p">),</span> <span class="n">sharex</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">DataAxesLeft</span><span class="p">,</span> <span class="n">sharey</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">DataAxesLeft</span><span class="p">,</span> <span class="n">frameon</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">MouseAxes</span><span class="o">.</span><span class="n">xaxis</span><span class="o">.</span><span class="n">set_visible</span><span class="p">(</span><span class="kc">False</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">MouseAxes</span><span class="o">.</span><span class="n">yaxis</span><span class="o">.</span><span class="n">set_visible</span><span class="p">(</span><span class="kc">False</span><span class="p">)</span>
            <span class="n">matplotlib</span><span class="o">.</span><span class="n">rcParams</span><span class="o">.</span><span class="n">update</span><span class="p">({</span><span class="s1">&#39;font.size&#39;</span><span class="p">:</span> <span class="n">PlotOptions</span><span class="o">.</span><span class="n">FontSize</span><span class="p">})</span>
            <span class="n">matplotlib</span><span class="o">.</span><span class="n">rcParams</span><span class="o">.</span><span class="n">update</span><span class="p">({</span><span class="s1">&#39;font.family&#39;</span><span class="p">:</span> <span class="s1">&#39;Times New Roman&#39;</span><span class="p">})</span>
            
            <span class="n">font</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;family&#39;</span><span class="p">:</span> <span class="s1">&#39;Times New Roman&#39;</span><span class="p">,</span>
                    <span class="s1">&#39;color&#39;</span><span class="p">:</span>  <span class="s1">&#39;black&#39;</span><span class="p">,</span>
                    <span class="s1">&#39;weight&#39;</span><span class="p">:</span> <span class="s1">&#39;normal&#39;</span><span class="p">,</span>
                    <span class="s1">&#39;size&#39;</span><span class="p">:</span> <span class="n">PlotOptions</span><span class="o">.</span><span class="n">FontSize</span><span class="p">}</span>
            
            <span class="n">needLegend</span> <span class="o">=</span> <span class="kc">True</span>
            <span class="k">for</span> <span class="n">ActiveJourney</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">ChosenJourneys</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">ActiveJourney</span> <span class="o">=</span> <span class="n">ActiveJourney</span>
                <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">ActiveJourney</span> <span class="o">&lt;=</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">Journeys</span><span class="p">)</span> <span class="o">-</span> <span class="mi">1</span><span class="p">:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">Journeys</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">ActiveJourney</span><span class="p">]</span><span class="o">.</span><span class="n">GenerateJourneyDataPlot</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">DataAxesLeft</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">DataAxesRight</span><span class="p">,</span> <span class="n">PlotOptions</span><span class="p">,</span> <span class="n">needLegend</span><span class="p">)</span>
                    <span class="n">needLegend</span> <span class="o">=</span> <span class="kc">False</span>

                <span class="k">else</span><span class="p">:</span>
                    <span class="k">for</span> <span class="n">journey</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">Journeys</span><span class="p">:</span>
                        <span class="n">journey</span><span class="o">.</span><span class="n">GenerateJourneyDataPlot</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">DataAxesLeft</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">DataAxesRight</span><span class="p">,</span> <span class="n">PlotOptions</span><span class="p">,</span> <span class="n">needLegend</span><span class="p">)</span>
                        <span class="n">needLegend</span> <span class="o">=</span> <span class="kc">False</span>
            
            <span class="n">needLegend</span> <span class="o">=</span> <span class="kc">True</span>
            <span class="k">if</span> <span class="n">PlotOptions</span><span class="o">.</span><span class="n">PlotCriticalEvents</span><span class="p">:</span>
                <span class="c1">#determine the Y limits of the plot</span>
                <span class="n">YboundsLeft</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">DataAxesLeft</span><span class="o">.</span><span class="n">get_ylim</span><span class="p">()</span>
                <span class="n">YboundsRight</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">DataAxesRight</span><span class="o">.</span><span class="n">get_ylim</span><span class="p">()</span>
                <span class="n">Ybounds</span> <span class="o">=</span> <span class="p">(</span><span class="nb">min</span><span class="p">(</span><span class="n">YboundsLeft</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">YboundsRight</span><span class="p">[</span><span class="mi">0</span><span class="p">]),</span> <span class="nb">max</span><span class="p">(</span><span class="n">YboundsLeft</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">YboundsRight</span><span class="p">[</span><span class="mi">1</span><span class="p">]))</span>
                
                <span class="k">for</span> <span class="n">ActiveJourney</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">ChosenJourneys</span><span class="p">:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">ActiveJourney</span> <span class="o">=</span> <span class="n">ActiveJourney</span>
                    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">ActiveJourney</span> <span class="o">&lt;=</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">Journeys</span><span class="p">)</span> <span class="o">-</span> <span class="mi">1</span><span class="p">:</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">Journeys</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">ActiveJourney</span><span class="p">]</span><span class="o">.</span><span class="n">PlotPhaseBoundariesOnDataPlot</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">DataAxesLeft</span><span class="p">,</span> <span class="n">PlotOptions</span><span class="p">,</span> <span class="n">needLegend</span><span class="p">,</span> <span class="n">Ybounds</span><span class="p">)</span>
                        <span class="n">needLegend</span> <span class="o">=</span> <span class="kc">False</span>
                    <span class="k">else</span><span class="p">:</span>
                        <span class="k">for</span> <span class="n">journey</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">Journeys</span><span class="p">:</span>
                            <span class="n">journey</span><span class="o">.</span><span class="n">PlotPhaseBoundariesOnDataPlot</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">DataAxesLeft</span><span class="p">,</span> <span class="n">PlotOptions</span><span class="p">,</span> <span class="n">needLegend</span><span class="p">,</span> <span class="n">Ybounds</span><span class="p">)</span>
                            <span class="n">needLegend</span> <span class="o">=</span> <span class="kc">False</span>

                     
            <span class="bp">self</span><span class="o">.</span><span class="n">DataAxesLeft</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s1">&#39;Epoch&#39;</span><span class="p">,</span> <span class="n">fontdict</span><span class="o">=</span><span class="n">font</span><span class="p">)</span>
            <span class="k">def</span> <span class="nf">format_date</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">pos</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
                <span class="kn">import</span> <span class="nn">pylab</span>
                <span class="k">return</span> <span class="n">pylab</span><span class="o">.</span><span class="n">num2date</span><span class="p">(</span><span class="n">x</span><span class="p">)</span><span class="o">.</span><span class="n">strftime</span><span class="p">(</span><span class="s1">&#39;%m-</span><span class="si">%d</span><span class="s1">-%Y&#39;</span><span class="p">)</span>

            
            <span class="bp">self</span><span class="o">.</span><span class="n">DataFigure</span><span class="o">.</span><span class="n">autofmt_xdate</span><span class="p">()</span>

            <span class="n">h1</span> <span class="o">=</span> <span class="p">[]</span>
            <span class="n">h2</span> <span class="o">=</span> <span class="p">[]</span>
            <span class="n">l1</span> <span class="o">=</span> <span class="p">[]</span>
            <span class="n">l2</span> <span class="o">=</span> <span class="p">[]</span>
            
            
            <span class="k">if</span> <span class="n">PlotOptions</span><span class="o">.</span><span class="n">PlotGamma</span> <span class="ow">or</span> <span class="n">PlotOptions</span><span class="o">.</span><span class="n">PlotDelta</span> <span class="ow">or</span> <span class="n">PlotOptions</span><span class="o">.</span><span class="n">PlotVelocityThrustAngle</span> <span class="ow">or</span> <span class="n">PlotOptions</span><span class="o">.</span><span class="n">PlotArray_Thrust_Angle</span> <span class="ow">or</span> <span class="n">PlotOptions</span><span class="o">.</span><span class="n">PlotSunSpacecraftEarthAngle</span> <span class="ow">or</span> <span class="n">PlotOptions</span><span class="o">.</span><span class="n">PlotCB_thrust_angle</span> <span class="ow">or</span> <span class="n">PlotOptions</span><span class="o">.</span><span class="n">PlotSunBoresightAngle</span><span class="p">:</span>
                <span class="n">h2</span><span class="p">,</span> <span class="n">l2</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">DataAxesRight</span><span class="o">.</span><span class="n">get_legend_handles_labels</span><span class="p">()</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">DataAxesRight</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s1">&#39;Angle Metric&#39;</span><span class="p">,</span> <span class="n">fontdict</span><span class="o">=</span><span class="n">font</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">DataAxesRight</span><span class="o">.</span><span class="n">xaxis</span><span class="o">.</span><span class="n">set_major_formatter</span><span class="p">(</span><span class="n">matplotlib</span><span class="o">.</span><span class="n">ticker</span><span class="o">.</span><span class="n">FuncFormatter</span><span class="p">(</span><span class="n">format_date</span><span class="p">))</span>
                <span class="k">try</span><span class="p">:</span>
                    <span class="k">for</span> <span class="n">label</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">DataAxesRight</span><span class="o">.</span><span class="n">get_xticklabels</span><span class="p">():</span>
                        <span class="n">label</span><span class="o">.</span><span class="n">set_rotation</span><span class="p">(</span><span class="mi">30</span><span class="p">)</span>
                <span class="k">except</span><span class="p">:</span>
                    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Failed to rotate x tick labels.&quot;</span><span class="p">)</span>
                <span class="c1">#self.DataAxesRight.grid(b=True, ls=&#39;-&#39;)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">yticks</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">DataAxesRight</span><span class="o">.</span><span class="n">yaxis</span><span class="o">.</span><span class="n">get_major_ticks</span><span class="p">()</span>
                <span class="k">for</span> <span class="n">tick</span> <span class="ow">in</span> <span class="n">yticks</span><span class="p">:</span>
                    <span class="n">tick</span><span class="o">.</span><span class="n">set_visible</span><span class="p">(</span><span class="kc">False</span><span class="p">)</span>

            <span class="k">if</span> <span class="n">PlotOptions</span><span class="o">.</span><span class="n">PlotR</span> <span class="ow">or</span> <span class="n">PlotOptions</span><span class="o">.</span><span class="n">PlotV</span> <span class="ow">or</span> <span class="n">PlotOptions</span><span class="o">.</span><span class="n">PlotThrust</span> <span class="ow">or</span> <span class="n">PlotOptions</span><span class="o">.</span><span class="n">PlotIsp</span> <span class="ow">or</span> <span class="n">PlotOptions</span><span class="o">.</span><span class="n">PlotMdot</span> <span class="ow">or</span> <span class="n">PlotOptions</span><span class="o">.</span><span class="n">PlotEfficiency</span> <span class="ow">or</span> <span class="n">PlotOptions</span><span class="o">.</span><span class="n">PlotThrottle</span> <span class="ow">or</span> <span class="n">PlotOptions</span><span class="o">.</span><span class="n">PlotPower</span> <span class="ow">or</span> <span class="n">PlotOptions</span><span class="o">.</span><span class="n">PlotMass</span> <span class="ow">or</span> <span class="n">PlotOptions</span><span class="o">.</span><span class="n">PlotNumberOfEngines</span> <span class="ow">or</span> <span class="n">PlotOptions</span><span class="o">.</span><span class="n">PlotActivePower</span> <span class="ow">or</span> <span class="n">PlotOptions</span><span class="o">.</span><span class="n">PlotWasteHeat</span> <span class="ow">or</span> <span class="n">PlotOptions</span><span class="o">.</span><span class="n">PlotEarthDistance</span> <span class="ow">or</span> <span class="n">PlotOptions</span><span class="o">.</span><span class="n">PlotSpacecraftViewingAngle</span> <span class="ow">or</span> <span class="n">PlotOptions</span><span class="o">.</span><span class="n">PlotThrottleLevel</span><span class="p">:</span>
                <span class="n">h1</span><span class="p">,</span> <span class="n">l1</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">DataAxesLeft</span><span class="o">.</span><span class="n">get_legend_handles_labels</span><span class="p">()</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">DataAxesLeft</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s1">&#39;Scalar Metric&#39;</span><span class="p">,</span> <span class="n">fontdict</span><span class="o">=</span><span class="n">font</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">DataAxesLeft</span><span class="o">.</span><span class="n">xaxis</span><span class="o">.</span><span class="n">set_major_formatter</span><span class="p">(</span><span class="n">matplotlib</span><span class="o">.</span><span class="n">ticker</span><span class="o">.</span><span class="n">FuncFormatter</span><span class="p">(</span><span class="n">format_date</span><span class="p">))</span>
                <span class="k">try</span><span class="p">:</span>
                    <span class="k">for</span> <span class="n">label</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">DataAxesLeft</span><span class="o">.</span><span class="n">get_xticklabels</span><span class="p">():</span>
                        <span class="n">label</span><span class="o">.</span><span class="n">set_rotation</span><span class="p">(</span><span class="mi">30</span><span class="p">)</span>
                <span class="k">except</span><span class="p">:</span>
                    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Failed to rotate x tick labels.&quot;</span><span class="p">)</span>
                <span class="c1">#self.DataAxesLeft.grid(b=True, ls=&#39;-&#39;)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">yticks</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">DataAxesLeft</span><span class="o">.</span><span class="n">yaxis</span><span class="o">.</span><span class="n">get_major_ticks</span><span class="p">()</span>
                <span class="k">for</span> <span class="n">tick</span> <span class="ow">in</span> <span class="n">yticks</span><span class="p">:</span>
                    <span class="n">tick</span><span class="o">.</span><span class="n">set_visible</span><span class="p">(</span><span class="kc">False</span><span class="p">)</span>

            <span class="n">leg</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">DataAxesLeft</span><span class="o">.</span><span class="n">legend</span><span class="p">(</span><span class="n">h1</span><span class="o">+</span><span class="n">h2</span><span class="p">,</span> <span class="n">l1</span><span class="o">+</span><span class="n">l2</span><span class="p">,</span> <span class="n">loc</span><span class="o">=</span><span class="s1">&#39;upper center&#39;</span><span class="p">,</span> <span class="n">fancybox</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="n">PlotOptions</span><span class="o">.</span><span class="n">FontSize</span><span class="p">)</span>    
            <span class="c1">#leg = self.DataAxesRight.legend(h1+h2, l1+l2, loc=&#39;upper left&#39;, fancybox=True)</span>
            <span class="n">leg</span><span class="o">.</span><span class="n">get_frame</span><span class="p">()</span><span class="o">.</span><span class="n">set_alpha</span><span class="p">(</span><span class="mf">0.5</span><span class="p">)</span>
            <span class="n">leg</span><span class="o">.</span><span class="n">set_draggable</span><span class="p">(</span><span class="kc">True</span><span class="p">,</span> <span class="n">use_blit</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">DataFigure</span><span class="o">.</span><span class="n">show</span><span class="p">()</span></div>


<div class="viewcode-block" id="Mission.WriteDataReport">
<a class="viewcode-back" href="../PyEMTG/Mission.html#Mission.Mission.WriteDataReport">[docs]</a>
    <span class="k">def</span> <span class="nf">WriteDataReport</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">PlotOptions</span><span class="p">,</span> <span class="n">reportfilename</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">PlotOptions</span><span class="o">.</span><span class="n">PlotR</span> <span class="ow">or</span> <span class="n">PlotOptions</span><span class="o">.</span><span class="n">PlotV</span> <span class="ow">or</span> <span class="n">PlotOptions</span><span class="o">.</span><span class="n">PlotThrust</span> <span class="ow">or</span> <span class="n">PlotOptions</span><span class="o">.</span><span class="n">PlotIsp</span> <span class="ow">or</span> <span class="n">PlotOptions</span><span class="o">.</span><span class="n">PlotMdot</span> <span class="ow">or</span> <span class="n">PlotOptions</span><span class="o">.</span><span class="n">PlotEfficiency</span> <span class="ow">or</span> <span class="n">PlotOptions</span><span class="o">.</span><span class="n">PlotThrottle</span> <span class="ow">or</span> <span class="n">PlotOptions</span><span class="o">.</span><span class="n">PlotPower</span> <span class="ow">or</span> <span class="n">PlotOptions</span><span class="o">.</span><span class="n">PlotGamma</span> <span class="ow">or</span> <span class="n">PlotOptions</span><span class="o">.</span><span class="n">PlotDelta</span> <span class="ow">or</span> <span class="n">PlotOptions</span><span class="o">.</span><span class="n">PlotVelocityThrustAngle</span> <span class="ow">or</span> <span class="n">PlotOptions</span><span class="o">.</span><span class="n">PlotArray_Thrust_Angle</span> <span class="ow">or</span> <span class="n">PlotOptions</span><span class="o">.</span><span class="n">PlotMass</span> <span class="ow">or</span> <span class="n">PlotOptions</span><span class="o">.</span><span class="n">PlotNumberOfEngines</span> <span class="ow">or</span> <span class="n">PlotOptions</span><span class="o">.</span><span class="n">PlotActivePower</span> <span class="ow">or</span> <span class="n">PlotOptions</span><span class="o">.</span><span class="n">PlotWasteHeat</span> <span class="ow">or</span> <span class="n">PlotOptions</span><span class="o">.</span><span class="n">PlotEarthDistance</span> <span class="ow">or</span> <span class="n">PlotOptions</span><span class="o">.</span><span class="n">PlotSunSpacecraftEarthAngle</span> <span class="ow">or</span> <span class="n">PlotOptions</span><span class="o">.</span><span class="n">PlotSpacecraftViewingAngle</span> <span class="ow">or</span> <span class="n">PlotOptions</span><span class="o">.</span><span class="n">PlotThrottleLevel</span><span class="p">:</span>
            
            <span class="n">reportfile</span> <span class="o">=</span> <span class="nb">open</span><span class="p">(</span><span class="n">reportfilename</span><span class="p">,</span> <span class="s1">&#39;w&#39;</span><span class="p">)</span>
            <span class="n">reportfile</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s1">&#39;#EMTG systems report file</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">)</span>
            <span class="n">reportfile</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">)</span>

            
            <span class="k">for</span> <span class="n">ActiveJourney</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">ChosenJourneys</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">ActiveJourney</span> <span class="o">=</span> <span class="n">ActiveJourney</span>
                <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">ActiveJourney</span> <span class="o">&lt;=</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">Journeys</span><span class="p">)</span> <span class="o">-</span> <span class="mi">1</span><span class="p">:</span>
                    <span class="n">reportfile</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s1">&#39;Journey &#39;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">ActiveJourney</span><span class="p">)</span> <span class="o">+</span> <span class="s1">&#39;: &#39;</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">Journeys</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">ActiveJourney</span><span class="p">]</span><span class="o">.</span><span class="n">journey_name</span> <span class="o">+</span> <span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">)</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">Journeys</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">ActiveJourney</span><span class="p">]</span><span class="o">.</span><span class="n">WriteDateReport</span><span class="p">(</span><span class="n">PlotOptions</span><span class="p">,</span> <span class="n">reportfile</span><span class="p">)</span>

                <span class="k">else</span><span class="p">:</span>
                    <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">Journeys</span><span class="p">)):</span>
                        <span class="n">reportfile</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s1">&#39;Journey &#39;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">j</span><span class="p">)</span> <span class="o">+</span> <span class="s1">&#39;: &#39;</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">Journeys</span><span class="p">[</span><span class="n">j</span><span class="p">]</span><span class="o">.</span><span class="n">journey_name</span> <span class="o">+</span> <span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">)</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">Journeys</span><span class="p">[</span><span class="n">j</span><span class="p">]</span><span class="o">.</span><span class="n">WriteDateReport</span><span class="p">(</span><span class="n">PlotOptions</span><span class="p">,</span> <span class="n">reportfile</span><span class="p">)</span>
                        <span class="n">reportfile</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">)</span></div>


<div class="viewcode-block" id="Mission.BubbleSearch">
<a class="viewcode-back" href="../PyEMTG/Mission.html#Mission.Mission.BubbleSearch">[docs]</a>
    <span class="k">def</span> <span class="nf">BubbleSearch</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">BubbleOptions</span><span class="p">,</span> <span class="n">outputfilename</span><span class="p">,</span> <span class="n">OutputWindow</span> <span class="o">=</span> <span class="p">[]):</span>
        <span class="kn">import</span> <span class="nn">astropy</span>
        <span class="kn">import</span> <span class="nn">SmallBodyList</span>
        
        <span class="k">try</span><span class="p">:</span>
            <span class="kn">import</span> <span class="nn">spiceypy</span> <span class="k">as</span> <span class="nn">spice</span>
        <span class="k">except</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;spiceypy not available&quot;</span><span class="p">)</span>
        
        <span class="k">if</span> <span class="n">BubbleOptions</span><span class="o">.</span><span class="n">ifSpice</span><span class="p">:</span>
            <span class="n">loaded_SPICE_files</span> <span class="o">=</span> <span class="p">[]</span>
            <span class="n">BubbleOptions</span><span class="o">.</span><span class="n">SPICE_IDs</span> <span class="o">=</span> <span class="p">[]</span>
            <span class="k">for</span> <span class="n">IDfile</span> <span class="ow">in</span> <span class="n">BubbleOptions</span><span class="o">.</span><span class="n">SPICEID_file</span><span class="p">:</span>
                <span class="n">file</span> <span class="o">=</span> <span class="nb">open</span><span class="p">(</span><span class="n">IDfile</span><span class="p">,</span><span class="s1">&#39;r&#39;</span><span class="p">)</span>
                <span class="k">for</span> <span class="n">line</span> <span class="ow">in</span> <span class="n">file</span><span class="p">:</span>
                    <span class="n">BubbleOptions</span><span class="o">.</span><span class="n">SPICE_IDs</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="nb">int</span><span class="p">(</span><span class="n">line</span><span class="p">))</span>
                <span class="n">file</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>

            <span class="k">for</span> <span class="n">file</span> <span class="ow">in</span> <span class="n">BubbleOptions</span><span class="o">.</span><span class="n">spiceFiles</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">file</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">loaded_SPICE_files</span><span class="p">:</span>
                    <span class="n">loaded_SPICE_files</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">file</span><span class="p">)</span>
                    <span class="n">spice</span><span class="o">.</span><span class="n">furnsh</span><span class="p">(</span><span class="n">file</span><span class="p">)</span>


        <span class="n">bubblefile</span> <span class="o">=</span> <span class="nb">open</span><span class="p">(</span><span class="n">outputfilename</span><span class="p">,</span> <span class="n">mode</span> <span class="o">=</span> <span class="s1">&#39;w&#39;</span><span class="p">)</span>
        <span class="n">bubblefile</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s1">&#39;#Bubble file for &#39;</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">mission_name</span> <span class="o">+</span> <span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">)</span>
        <span class="n">bubblefile</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s1">&#39;#</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">)</span>
        <span class="n">bubblefile</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s1">&#39;#</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">)</span>
        <span class="n">SmallBodyDatabase</span> <span class="o">=</span> <span class="n">SmallBodyList</span><span class="o">.</span><span class="n">SmallBodyList</span><span class="p">(</span><span class="n">BubbleOptions</span><span class="o">.</span><span class="n">smallbodyfile</span><span class="p">,</span> <span class="n">BubbleOptions</span><span class="o">.</span><span class="n">mu</span><span class="p">,</span> <span class="n">BubbleOptions</span><span class="o">.</span><span class="n">LU</span><span class="p">)</span>
        
        
        <span class="k">for</span> <span class="n">ActiveJourney</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">ChosenJourneys</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">ActiveJourney</span> <span class="o">=</span> <span class="n">ActiveJourney</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">ActiveJourney</span> <span class="o">&lt;=</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">Journeys</span><span class="p">)</span> <span class="o">-</span> <span class="mi">1</span><span class="p">:</span>
                <span class="n">bubblefile</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s1">&#39;Journey &#39;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">ActiveJourney</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span> <span class="o">+</span> <span class="s1">&#39;: &#39;</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">Journeys</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">ActiveJourney</span><span class="p">]</span><span class="o">.</span><span class="n">journey_name</span> <span class="o">+</span> <span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">)</span>
                <span class="n">bubblefile</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s1">&#39;Julian Date, Gregorian Date, Body Name, SPICE ID, Body SMA, Tholen spectral type, SMASSII spectral type, Absolute Magnitude, Diameter, Distance (km), Distance (LU), Relative Velocity (km/s), Guesstimated intercept delta-v (km/s)</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">)</span>

                <span class="c1">#the first thing we need to do is identify the major events in the journey so that, for each missionevent, we know which flybys and/or maneuvers bracket it</span>
                <span class="n">major_event_list</span> <span class="o">=</span> <span class="p">[]</span>
                <span class="k">for</span> <span class="n">event</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">Journeys</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">ActiveJourney</span><span class="p">]</span><span class="o">.</span><span class="n">missionevents</span><span class="p">:</span>
                    <span class="k">if</span> <span class="ow">not</span> <span class="n">event</span><span class="o">.</span><span class="n">EventType</span> <span class="ow">in</span> <span class="p">[</span><span class="s1">&#39;coast&#39;</span><span class="p">,</span> <span class="s1">&#39;force-coast&#39;</span><span class="p">,</span><span class="s1">&#39;SFthrust&#39;</span><span class="p">,</span><span class="s1">&#39;PSBIthrust&#39;</span><span class="p">,</span><span class="s1">&#39;FBLTthrust&#39;</span><span class="p">,</span><span class="s1">&#39;PSFBthrust&#39;</span><span class="p">,</span><span class="s1">&#39;nav-coast&#39;</span><span class="p">]:</span>
                        <span class="n">major_event_list</span><span class="o">.</span><span class="n">append</span><span class="p">((</span><span class="n">event</span><span class="o">.</span><span class="n">EventType</span><span class="p">,</span> <span class="n">event</span><span class="o">.</span><span class="n">JulianDate</span><span class="p">))</span>

                <span class="k">for</span> <span class="n">event</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">Journeys</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">ActiveJourney</span><span class="p">]</span><span class="o">.</span><span class="n">missionevents</span><span class="p">:</span>
                    <span class="c1"># print event.JulianDate</span>
                    <span class="k">if</span> <span class="nb">hasattr</span><span class="p">(</span><span class="n">OutputWindow</span><span class="p">,</span><span class="s1">&#39;WriteText&#39;</span><span class="p">):</span>
                        <span class="n">OutputWindow</span><span class="o">.</span><span class="n">WriteText</span><span class="p">(</span><span class="s2">&quot;Searching for targets of opportunity on JD &quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">event</span><span class="o">.</span><span class="n">JulianDate</span><span class="p">)</span> <span class="o">+</span> <span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>
                
                    <span class="n">event_body_list</span> <span class="o">=</span> <span class="n">SmallBodyDatabase</span><span class="o">.</span><span class="n">find_bubble_targets</span><span class="p">(</span><span class="n">event</span><span class="o">.</span><span class="n">SpacecraftState</span><span class="p">,</span> <span class="n">event</span><span class="o">.</span><span class="n">JulianDate</span><span class="p">,</span> <span class="n">BubbleOptions</span><span class="o">.</span><span class="n">RelativePositionFilterMagnitude</span><span class="p">,</span> <span class="n">BubbleOptions</span><span class="o">.</span><span class="n">RelativeVelocityFilterMagnitude</span><span class="p">,</span> <span class="n">BubbleOptions</span><span class="o">.</span><span class="n">MaximumMagnitude</span><span class="p">,</span> <span class="n">BubbleOptions</span><span class="o">.</span><span class="n">ifSpice</span><span class="p">,</span> <span class="n">BubbleOptions</span><span class="o">.</span><span class="n">spiceFiles</span><span class="p">,</span> <span class="n">BubbleOptions</span><span class="o">.</span><span class="n">SPICE_IDs</span><span class="p">)</span>

                    <span class="c1">#determine which events bracket us</span>
                    <span class="n">event_bracket</span> <span class="o">=</span> <span class="p">[</span><span class="mf">0.0</span><span class="p">,</span><span class="mf">0.0</span><span class="p">]</span>
                    <span class="k">for</span> <span class="n">eventIndex</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">major_event_list</span><span class="p">)</span><span class="o">-</span><span class="mi">1</span><span class="p">):</span>
                        <span class="k">if</span> <span class="n">major_event_list</span><span class="p">[</span><span class="n">eventIndex</span><span class="p">][</span><span class="mi">1</span><span class="p">]</span> <span class="o">&lt;=</span> <span class="n">event</span><span class="o">.</span><span class="n">JulianDate</span> <span class="ow">and</span> <span class="n">major_event_list</span><span class="p">[</span><span class="n">eventIndex</span> <span class="o">+</span> <span class="mi">1</span><span class="p">][</span><span class="mi">1</span><span class="p">]</span> <span class="o">&gt;=</span> <span class="n">event</span><span class="o">.</span><span class="n">JulianDate</span><span class="p">:</span>
                            <span class="n">event_bracket</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="n">major_event_list</span><span class="p">[</span><span class="n">eventIndex</span><span class="p">][</span><span class="mi">1</span><span class="p">]</span>
                            <span class="n">event_bracket</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="n">major_event_list</span><span class="p">[</span><span class="n">eventIndex</span> <span class="o">+</span> <span class="mi">1</span><span class="p">][</span><span class="mi">1</span><span class="p">]</span>

                    <span class="k">for</span> <span class="n">body</span> <span class="ow">in</span> <span class="n">event_body_list</span><span class="p">:</span>
                        <span class="k">if</span> <span class="n">body</span><span class="o">.</span><span class="n">Tholen</span> <span class="o">==</span> <span class="s1">&#39;-1&#39;</span><span class="p">:</span>
                            <span class="n">Tholen</span> <span class="o">=</span> <span class="s1">&#39;&#39;</span>
                        <span class="k">else</span><span class="p">:</span>
                            <span class="n">Tholen</span> <span class="o">=</span> <span class="n">body</span><span class="o">.</span><span class="n">Tholen</span>

                        <span class="k">if</span> <span class="n">body</span><span class="o">.</span><span class="n">SMASSII</span> <span class="o">==</span> <span class="s1">&#39;-1&#39;</span><span class="p">:</span>
                            <span class="n">SMASSII</span> <span class="o">=</span> <span class="s1">&#39;&#39;</span>
                        <span class="k">else</span><span class="p">:</span>
                            <span class="n">SMASSII</span> <span class="o">=</span> <span class="n">body</span><span class="o">.</span><span class="n">SMASSII</span>

                        <span class="k">if</span> <span class="n">body</span><span class="o">.</span><span class="n">Diameter</span> <span class="o">==</span> <span class="o">-</span><span class="mi">1</span><span class="p">:</span>
                            <span class="n">Diameter</span> <span class="o">=</span> <span class="s1">&#39;&#39;</span>
                        <span class="k">else</span><span class="p">:</span>
                            <span class="n">Diameter</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="n">body</span><span class="o">.</span><span class="n">Diameter</span><span class="p">)</span>

                        <span class="c1">#compute the Sutter-method guesstimated intercept delta-v relative to the forward and backward bracketing event and take the worst case</span>
                        <span class="k">if</span> <span class="nb">abs</span><span class="p">(</span><span class="n">event</span><span class="o">.</span><span class="n">JulianDate</span> <span class="o">-</span> <span class="n">event_bracket</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span> <span class="o">&gt;</span> <span class="mf">1.0e-10</span><span class="p">:</span>
                            <span class="n">forward_guesstimated_deltav</span> <span class="o">=</span> <span class="n">body</span><span class="o">.</span><span class="n">RelativePositionMagnitude</span> <span class="o">/</span> <span class="p">(</span><span class="n">event</span><span class="o">.</span><span class="n">JulianDate</span> <span class="o">-</span> <span class="n">event_bracket</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span> <span class="o">/</span> <span class="mf">86400.0</span>
                        <span class="k">else</span><span class="p">:</span>
                            <span class="n">forward_guesstimated_deltav</span> <span class="o">=</span> <span class="mf">1.0e+100</span>
                        <span class="k">if</span> <span class="nb">abs</span><span class="p">(</span><span class="n">event_bracket</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">-</span> <span class="n">event</span><span class="o">.</span><span class="n">JulianDate</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mf">1.0e-10</span><span class="p">:</span>
                            <span class="n">backward_guesstimated_deltav</span> <span class="o">=</span> <span class="n">body</span><span class="o">.</span><span class="n">RelativePositionMagnitude</span> <span class="o">/</span> <span class="p">(</span><span class="n">event_bracket</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">-</span> <span class="n">event</span><span class="o">.</span><span class="n">JulianDate</span><span class="p">)</span> <span class="o">/</span> <span class="mf">86400.0</span>
                        <span class="k">else</span><span class="p">:</span>
                            <span class="n">backward_guesstimated_deltav</span> <span class="o">=</span> <span class="mf">1.0e+100</span>

                        <span class="n">bubblefile</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">event</span><span class="o">.</span><span class="n">JulianDate</span><span class="p">)</span> <span class="o">+</span> <span class="s1">&#39;,&#39;</span> <span class="o">+</span> <span class="n">event</span><span class="o">.</span><span class="n">GregorianDate</span> <span class="o">+</span> <span class="s1">&#39;,&#39;</span> <span class="o">+</span> <span class="n">body</span><span class="o">.</span><span class="n">name</span> <span class="o">+</span> <span class="s1">&#39;,&#39;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">body</span><span class="o">.</span><span class="n">SPICEID</span><span class="p">)</span> <span class="o">+</span> <span class="s1">&#39;,&#39;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">body</span><span class="o">.</span><span class="n">SMA</span><span class="p">)</span> <span class="o">+</span> <span class="s1">&#39;,&#39;</span> <span class="o">+</span> <span class="n">Tholen</span> <span class="o">+</span> <span class="s1">&#39;,&#39;</span> <span class="o">+</span> <span class="n">SMASSII</span> <span class="o">+</span> <span class="s1">&#39;,&#39;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">body</span><span class="o">.</span><span class="n">H</span><span class="p">)</span> <span class="o">+</span> <span class="s1">&#39;,&#39;</span> <span class="o">+</span> <span class="n">Diameter</span> <span class="o">+</span> <span class="s1">&#39;,&#39;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">body</span><span class="o">.</span><span class="n">RelativePositionMagnitude</span><span class="p">)</span> <span class="o">+</span> <span class="s1">&#39;,&#39;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">body</span><span class="o">.</span><span class="n">RelativePositionMagnitude</span> <span class="o">/</span> <span class="n">BubbleOptions</span><span class="o">.</span><span class="n">LU</span><span class="p">)</span> <span class="o">+</span> <span class="s1">&#39;,&#39;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">body</span><span class="o">.</span><span class="n">RelativeVelocityMagnitude</span><span class="p">)</span> <span class="o">+</span> <span class="s1">&#39;,&#39;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="nb">max</span><span class="p">(</span><span class="n">forward_guesstimated_deltav</span><span class="p">,</span> <span class="n">backward_guesstimated_deltav</span><span class="p">))</span> <span class="o">+</span> <span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">)</span>
                
                    <span class="k">if</span> <span class="nb">hasattr</span><span class="p">(</span><span class="n">OutputWindow</span><span class="p">,</span><span class="s1">&#39;WriteText&#39;</span><span class="p">):</span>
                        <span class="n">OutputWindow</span><span class="o">.</span><span class="n">WriteText</span><span class="p">(</span><span class="s2">&quot;Found &quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">event_body_list</span><span class="p">))</span> <span class="o">+</span> <span class="s2">&quot; candidates</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>
                    <span class="n">bubblefile</span><span class="o">.</span><span class="n">flush</span><span class="p">()</span>

                <span class="c1">#do we want to keep going after the end of the mission?</span>
                <span class="k">if</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">ActiveJourney</span> <span class="o">==</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">Journeys</span><span class="p">)</span> <span class="o">-</span> <span class="mi">1</span> <span class="ow">and</span> <span class="n">BubbleOptions</span><span class="o">.</span><span class="n">CheckForEncountersAfterMissionEnd</span><span class="p">):</span>
                    <span class="n">bubblefile</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s1">&#39;Post-mission encounters</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">)</span>
                    <span class="n">bubblefile</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s1">&#39;Julian Date, Gregorian Date, Body Name, SPICE ID, Body SMA, Tholen spectral type, SMASSII spectral type, Absolute Magnitude, Diameter, Distance (km), Distance (LU), Relative Velocity (km/s), Guesstimated intercept delta-v (km/s)</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">)</span>

                    <span class="n">PostMissionState</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">Journeys</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">missionevents</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">SpacecraftState</span>
                    <span class="n">PostMissionCOE</span> <span class="o">=</span> <span class="n">kepler</span><span class="o">.</span><span class="n">cart2kep</span><span class="p">(</span><span class="n">PostMissionState</span><span class="p">[</span><span class="mi">0</span><span class="p">:</span><span class="mi">3</span><span class="p">],</span><span class="n">PostMissionState</span><span class="p">[</span><span class="mi">3</span><span class="p">:</span><span class="mi">6</span><span class="p">],</span><span class="n">BubbleOptions</span><span class="o">.</span><span class="n">mu</span><span class="p">)</span>
                    <span class="n">MissionEndEpoch</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">Journeys</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">missionevents</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">JulianDate</span>
                    <span class="n">PostMissionPropagationStep</span> <span class="o">=</span> <span class="n">BubbleOptions</span><span class="o">.</span><span class="n">PostMissionCheckDuration</span> <span class="o">/</span> <span class="n">BubbleOptions</span><span class="o">.</span><span class="n">PostMissionCheckSteps</span>

                    <span class="k">for</span> <span class="n">step</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">BubbleOptions</span><span class="o">.</span><span class="n">PostMissionCheckSteps</span><span class="p">):</span>
                        <span class="n">CurrentEpoch</span> <span class="o">=</span> <span class="n">MissionEndEpoch</span> <span class="o">+</span> <span class="p">(</span><span class="n">step</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span> <span class="o">*</span> <span class="n">PostMissionPropagationStep</span>
                        <span class="c1">#propagate the spacecraft to this epoch</span>
                        <span class="n">r</span><span class="p">,</span> <span class="n">v</span> <span class="o">=</span> <span class="n">kepler</span><span class="o">.</span><span class="n">kepler</span><span class="p">(</span><span class="n">PostMissionCOE</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">PostMissionCOE</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">PostMissionCOE</span><span class="p">[</span><span class="mi">2</span><span class="p">],</span> <span class="n">PostMissionCOE</span><span class="p">[</span><span class="mi">3</span><span class="p">],</span> <span class="n">PostMissionCOE</span><span class="p">[</span><span class="mi">4</span><span class="p">],</span> <span class="n">PostMissionCOE</span><span class="p">[</span><span class="mi">5</span><span class="p">],</span> <span class="n">MissionEndEpoch</span><span class="p">,</span> <span class="n">CurrentEpoch</span><span class="p">,</span> <span class="n">BubbleOptions</span><span class="o">.</span><span class="n">mu</span><span class="p">)</span>
                        <span class="n">state</span> <span class="o">=</span> <span class="p">[</span><span class="n">r</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">r</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">r</span><span class="p">[</span><span class="mi">2</span><span class="p">],</span> <span class="n">v</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">v</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">v</span><span class="p">[</span><span class="mi">2</span><span class="p">]]</span>

                        <span class="c1">#check for bodies</span>
                        <span class="n">OutputWindow</span><span class="o">.</span><span class="n">WriteText</span><span class="p">(</span><span class="s2">&quot;Searching for targets of opportunity on JD &quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">CurrentEpoch</span><span class="p">)</span> <span class="o">+</span> <span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>
                        <span class="n">event_body_list</span> <span class="o">=</span> <span class="n">SmallBodyDatabase</span><span class="o">.</span><span class="n">find_bubble_targets</span><span class="p">(</span><span class="n">state</span><span class="p">,</span> <span class="n">CurrentEpoch</span><span class="p">,</span> <span class="n">BubbleOptions</span><span class="o">.</span><span class="n">RelativePositionFilterMagnitude</span><span class="p">,</span> <span class="n">BubbleOptions</span><span class="o">.</span><span class="n">RelativeVelocityFilterMagnitude</span><span class="p">,</span> <span class="n">BubbleOptions</span><span class="o">.</span><span class="n">MaximumMagnitude</span><span class="p">,</span> <span class="n">BubbleOptions</span><span class="o">.</span><span class="n">ifSpice</span><span class="p">,</span> <span class="n">BubbleOptions</span><span class="o">.</span><span class="n">spiceFiles</span><span class="p">,</span> <span class="n">BubbleOptions</span><span class="o">.</span><span class="n">SPICE_IDs</span><span class="p">)</span>

                        <span class="c1">#write fields</span>
                        <span class="k">for</span> <span class="n">body</span> <span class="ow">in</span> <span class="n">event_body_list</span><span class="p">:</span>
                            <span class="k">if</span> <span class="n">body</span><span class="o">.</span><span class="n">Tholen</span> <span class="o">==</span> <span class="s1">&#39;-1&#39;</span><span class="p">:</span>
                                <span class="n">Tholen</span> <span class="o">=</span> <span class="s1">&#39;&#39;</span>
                            <span class="k">else</span><span class="p">:</span>
                                <span class="n">Tholen</span> <span class="o">=</span> <span class="n">body</span><span class="o">.</span><span class="n">Tholen</span>

                            <span class="k">if</span> <span class="n">body</span><span class="o">.</span><span class="n">SMASSII</span> <span class="o">==</span> <span class="s1">&#39;-1&#39;</span><span class="p">:</span>
                                <span class="n">SMASSII</span> <span class="o">=</span> <span class="s1">&#39;&#39;</span>
                            <span class="k">else</span><span class="p">:</span>
                                <span class="n">SMASSII</span> <span class="o">=</span> <span class="n">body</span><span class="o">.</span><span class="n">SMASSII</span>

                            <span class="k">if</span> <span class="n">body</span><span class="o">.</span><span class="n">Diameter</span> <span class="o">==</span> <span class="o">-</span><span class="mi">1</span><span class="p">:</span>
                                <span class="n">Diameter</span> <span class="o">=</span> <span class="s1">&#39;&#39;</span>
                            <span class="k">else</span><span class="p">:</span>
                                <span class="n">Diameter</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="n">body</span><span class="o">.</span><span class="n">Diameter</span><span class="p">)</span>

                            <span class="c1">#compute the Sutter-method guesstimated intercept delta-v relative to the forward and backward bracketing event and take the worst case</span>
                        
                            <span class="n">forward_guesstimated_deltav</span> <span class="o">=</span> <span class="n">body</span><span class="o">.</span><span class="n">RelativePositionMagnitude</span> <span class="o">/</span> <span class="p">(</span><span class="n">CurrentEpoch</span> <span class="o">-</span> <span class="n">MissionEndEpoch</span> <span class="o">+</span> <span class="mf">1.0</span><span class="p">)</span> <span class="o">/</span> <span class="mf">86400.0</span>

                            <span class="k">try</span><span class="p">:</span>
                                <span class="n">myDate</span> <span class="o">=</span> <span class="n">astropy</span><span class="o">.</span><span class="n">time</span><span class="o">.</span><span class="n">Time</span><span class="p">(</span><span class="n">CurrentEpoch</span><span class="p">,</span> <span class="nb">format</span><span class="o">=</span><span class="s1">&#39;jd&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">datetime</span><span class="o">.</span><span class="n">strftime</span><span class="p">(</span><span class="s1">&#39;%m/</span><span class="si">%d</span><span class="s1">/%Y&#39;</span><span class="p">)</span>
                            <span class="k">except</span> <span class="ne">ValueError</span><span class="p">:</span>
                                <span class="n">myDate</span> <span class="o">=</span> <span class="s1">&#39;idate&#39;</span>

                            <span class="n">bubblefile</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">CurrentEpoch</span><span class="p">)</span> <span class="o">+</span> <span class="s1">&#39;,&#39;</span> <span class="o">+</span> <span class="n">myDate</span> <span class="o">+</span> <span class="s1">&#39;,&#39;</span> <span class="o">+</span> <span class="n">body</span><span class="o">.</span><span class="n">name</span> <span class="o">+</span> <span class="s1">&#39;,&#39;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">body</span><span class="o">.</span><span class="n">SPICEID</span><span class="p">)</span> <span class="o">+</span> <span class="s1">&#39;,&#39;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">body</span><span class="o">.</span><span class="n">SMA</span><span class="p">)</span> <span class="o">+</span> <span class="s1">&#39;,&#39;</span> <span class="o">+</span> <span class="n">Tholen</span> <span class="o">+</span> <span class="s1">&#39;,&#39;</span> <span class="o">+</span> <span class="n">SMASSII</span> <span class="o">+</span> <span class="s1">&#39;,&#39;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">body</span><span class="o">.</span><span class="n">H</span><span class="p">)</span> <span class="o">+</span> <span class="s1">&#39;,&#39;</span> <span class="o">+</span> <span class="n">Diameter</span> <span class="o">+</span> <span class="s1">&#39;,&#39;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">body</span><span class="o">.</span><span class="n">RelativePositionMagnitude</span><span class="p">)</span> <span class="o">+</span> <span class="s1">&#39;,&#39;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">body</span><span class="o">.</span><span class="n">RelativePositionMagnitude</span> <span class="o">/</span> <span class="n">BubbleOptions</span><span class="o">.</span><span class="n">LU</span><span class="p">)</span> <span class="o">+</span> <span class="s1">&#39;,&#39;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">body</span><span class="o">.</span><span class="n">RelativeVelocityMagnitude</span><span class="p">)</span> <span class="o">+</span> <span class="s1">&#39;,&#39;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">forward_guesstimated_deltav</span><span class="p">)</span> <span class="o">+</span> <span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">)</span>
                    
                        <span class="n">OutputWindow</span><span class="o">.</span><span class="n">WriteText</span><span class="p">(</span><span class="s2">&quot;Found &quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">event_body_list</span><span class="p">))</span> <span class="o">+</span> <span class="s2">&quot; candidates</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>
                        <span class="n">bubblefile</span><span class="o">.</span><span class="n">flush</span><span class="p">()</span>

                    <span class="n">bubblefile</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">)</span>
                    

            <span class="k">else</span><span class="p">:</span>
                <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">Journeys</span><span class="p">)):</span>
                    <span class="n">bubblefile</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s1">&#39;Journey &#39;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">j</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span> <span class="o">+</span> <span class="s1">&#39;: &#39;</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">Journeys</span><span class="p">[</span><span class="n">j</span><span class="p">]</span><span class="o">.</span><span class="n">journey_name</span> <span class="o">+</span> <span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">)</span>
                    <span class="n">bubblefile</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s1">&#39;Julian Date, Gregorian Date, Body Name, SPICE ID, Body SMA, Tholen spectral type, SMASSII spectral type, Absolute Magnitude, Diameter, Distance (km), Distance (LU), Relative Velocity (km/s), Guesstimated intercept delta-v (km/s)</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">)</span>

                    <span class="c1">#the first thing we need to do is identify the major events in the journey so that, for each missionevent, we know which flybys and/or maneuvers bracket it</span>
                    <span class="n">major_event_list</span> <span class="o">=</span> <span class="p">[]</span>
                    <span class="k">for</span> <span class="n">event</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">Journeys</span><span class="p">[</span><span class="n">j</span><span class="p">]</span><span class="o">.</span><span class="n">missionevents</span><span class="p">:</span>
                        <span class="k">if</span> <span class="ow">not</span> <span class="n">event</span><span class="o">.</span><span class="n">EventType</span> <span class="ow">in</span> <span class="p">[</span><span class="s1">&#39;coast&#39;</span><span class="p">,</span> <span class="s1">&#39;force-coast&#39;</span><span class="p">,</span><span class="s1">&#39;SFthrust&#39;</span><span class="p">,</span><span class="s1">&#39;PSBIthrust&#39;</span><span class="p">,</span><span class="s1">&#39;FBLTthrust&#39;</span><span class="p">,</span><span class="s1">&#39;PSFBthrust&#39;</span><span class="p">,</span><span class="s1">&#39;nav-coast&#39;</span><span class="p">]:</span>
                            <span class="n">major_event_list</span><span class="o">.</span><span class="n">append</span><span class="p">((</span><span class="n">event</span><span class="o">.</span><span class="n">EventType</span><span class="p">,</span> <span class="n">event</span><span class="o">.</span><span class="n">JulianDate</span><span class="p">))</span>

                    <span class="k">for</span> <span class="n">event</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">Journeys</span><span class="p">[</span><span class="n">j</span><span class="p">]</span><span class="o">.</span><span class="n">missionevents</span><span class="p">:</span>
                        <span class="c1"># print event.JulianDate</span>
                        <span class="k">if</span> <span class="nb">hasattr</span><span class="p">(</span><span class="n">OutputWindow</span><span class="p">,</span><span class="s1">&#39;WriteText&#39;</span><span class="p">):</span>
                            <span class="n">OutputWindow</span><span class="o">.</span><span class="n">WriteText</span><span class="p">(</span><span class="s2">&quot;Searching for targets of opportunity on JD &quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">event</span><span class="o">.</span><span class="n">JulianDate</span><span class="p">)</span> <span class="o">+</span> <span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>
                        <span class="n">event_body_list</span> <span class="o">=</span> <span class="n">SmallBodyDatabase</span><span class="o">.</span><span class="n">find_bubble_targets</span><span class="p">(</span><span class="n">event</span><span class="o">.</span><span class="n">SpacecraftState</span><span class="p">,</span> <span class="n">event</span><span class="o">.</span><span class="n">JulianDate</span><span class="p">,</span> <span class="n">BubbleOptions</span><span class="o">.</span><span class="n">RelativePositionFilterMagnitude</span><span class="p">,</span> <span class="n">BubbleOptions</span><span class="o">.</span><span class="n">RelativeVelocityFilterMagnitude</span><span class="p">,</span> <span class="n">BubbleOptions</span><span class="o">.</span><span class="n">MaximumMagnitude</span><span class="p">,</span> <span class="n">BubbleOptions</span><span class="o">.</span><span class="n">ifSpice</span><span class="p">,</span> <span class="n">BubbleOptions</span><span class="o">.</span><span class="n">spiceFiles</span><span class="p">,</span> <span class="n">BubbleOptions</span><span class="o">.</span><span class="n">SPICE_IDs</span><span class="p">)</span>

                        <span class="c1">#determine which events bracket us</span>
                        <span class="n">event_bracket</span> <span class="o">=</span> <span class="p">[</span><span class="mf">0.0</span><span class="p">,</span><span class="mf">0.0</span><span class="p">]</span>
                        <span class="k">for</span> <span class="n">eventIndex</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">major_event_list</span><span class="p">)</span><span class="o">-</span><span class="mi">1</span><span class="p">):</span>
                            <span class="k">if</span> <span class="n">major_event_list</span><span class="p">[</span><span class="n">eventIndex</span><span class="p">][</span><span class="mi">1</span><span class="p">]</span> <span class="o">&lt;=</span> <span class="n">event</span><span class="o">.</span><span class="n">JulianDate</span> <span class="ow">and</span> <span class="n">major_event_list</span><span class="p">[</span><span class="n">eventIndex</span> <span class="o">+</span> <span class="mi">1</span><span class="p">][</span><span class="mi">1</span><span class="p">]</span> <span class="o">&gt;=</span> <span class="n">event</span><span class="o">.</span><span class="n">JulianDate</span><span class="p">:</span>
                                <span class="n">event_bracket</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="n">major_event_list</span><span class="p">[</span><span class="n">eventIndex</span><span class="p">][</span><span class="mi">1</span><span class="p">]</span>
                                <span class="n">event_bracket</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="n">major_event_list</span><span class="p">[</span><span class="n">eventIndex</span> <span class="o">+</span> <span class="mi">1</span><span class="p">][</span><span class="mi">1</span><span class="p">]</span>
                                <span class="k">break</span>
                        <span class="k">if</span> <span class="nb">hasattr</span><span class="p">(</span><span class="n">OutputWindow</span><span class="p">,</span><span class="s1">&#39;WriteText&#39;</span><span class="p">):</span>
                            <span class="n">OutputWindow</span><span class="o">.</span><span class="n">WriteText</span><span class="p">(</span><span class="s2">&quot;bracketing events are at JD [&quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">event_bracket</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span> <span class="o">+</span> <span class="s1">&#39;, &#39;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">event_bracket</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span> <span class="o">+</span> <span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">)</span>

                        <span class="k">for</span> <span class="n">body</span> <span class="ow">in</span> <span class="n">event_body_list</span><span class="p">:</span>
                            <span class="k">if</span> <span class="n">body</span><span class="o">.</span><span class="n">Tholen</span> <span class="o">==</span> <span class="s1">&#39;-1&#39;</span><span class="p">:</span>
                                <span class="n">Tholen</span> <span class="o">=</span> <span class="s1">&#39;&#39;</span>
                            <span class="k">else</span><span class="p">:</span>
                                <span class="n">Tholen</span> <span class="o">=</span> <span class="n">body</span><span class="o">.</span><span class="n">Tholen</span>

                            <span class="k">if</span> <span class="n">body</span><span class="o">.</span><span class="n">SMASSII</span> <span class="o">==</span> <span class="s1">&#39;-1&#39;</span><span class="p">:</span>
                                <span class="n">SMASSII</span> <span class="o">=</span> <span class="s1">&#39;&#39;</span>
                            <span class="k">else</span><span class="p">:</span>
                                <span class="n">SMASSII</span> <span class="o">=</span> <span class="n">body</span><span class="o">.</span><span class="n">SMASSII</span>

                            <span class="k">if</span> <span class="n">body</span><span class="o">.</span><span class="n">Diameter</span> <span class="o">==</span> <span class="o">-</span><span class="mi">1</span><span class="p">:</span>
                                <span class="n">Diameter</span> <span class="o">=</span> <span class="s1">&#39;&#39;</span>
                            <span class="k">else</span><span class="p">:</span>
                                <span class="n">Diameter</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="n">body</span><span class="o">.</span><span class="n">Diameter</span><span class="p">)</span>

                            <span class="c1">#compute the Sutter-method guesstimated intercept delta-v relative to the forward and backward bracketing event and take the worst case</span>
                        
                            <span class="n">forward_guesstimated_deltav</span> <span class="o">=</span> <span class="n">body</span><span class="o">.</span><span class="n">RelativePositionMagnitude</span> <span class="o">/</span> <span class="p">(</span><span class="n">event</span><span class="o">.</span><span class="n">JulianDate</span> <span class="o">-</span> <span class="n">event_bracket</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">+</span> <span class="mf">1.0</span><span class="p">)</span> <span class="o">/</span> <span class="mf">86400.0</span>
                            <span class="n">backward_guesstimated_deltav</span> <span class="o">=</span> <span class="n">body</span><span class="o">.</span><span class="n">RelativePositionMagnitude</span> <span class="o">/</span> <span class="p">(</span><span class="n">event_bracket</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">-</span> <span class="n">event</span><span class="o">.</span><span class="n">JulianDate</span> <span class="o">+</span> <span class="mf">1.0</span><span class="p">)</span> <span class="o">/</span> <span class="mf">86400.0</span>

                            <span class="n">bubblefile</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">event</span><span class="o">.</span><span class="n">JulianDate</span><span class="p">)</span> <span class="o">+</span> <span class="s1">&#39;,&#39;</span> <span class="o">+</span> <span class="n">event</span><span class="o">.</span><span class="n">GregorianDate</span> <span class="o">+</span> <span class="s1">&#39;,&#39;</span> <span class="o">+</span> <span class="n">body</span><span class="o">.</span><span class="n">name</span> <span class="o">+</span> <span class="s1">&#39;,&#39;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">body</span><span class="o">.</span><span class="n">SPICEID</span><span class="p">)</span> <span class="o">+</span> <span class="s1">&#39;,&#39;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">body</span><span class="o">.</span><span class="n">SMA</span><span class="p">)</span> <span class="o">+</span> <span class="s1">&#39;,&#39;</span> <span class="o">+</span> <span class="n">Tholen</span> <span class="o">+</span> <span class="s1">&#39;,&#39;</span> <span class="o">+</span> <span class="n">SMASSII</span> <span class="o">+</span> <span class="s1">&#39;,&#39;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">body</span><span class="o">.</span><span class="n">H</span><span class="p">)</span> <span class="o">+</span> <span class="s1">&#39;,&#39;</span> <span class="o">+</span> <span class="n">Diameter</span> <span class="o">+</span> <span class="s1">&#39;,&#39;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">body</span><span class="o">.</span><span class="n">RelativePositionMagnitude</span><span class="p">)</span> <span class="o">+</span> <span class="s1">&#39;,&#39;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">body</span><span class="o">.</span><span class="n">RelativePositionMagnitude</span> <span class="o">/</span> <span class="n">BubbleOptions</span><span class="o">.</span><span class="n">LU</span><span class="p">)</span> <span class="o">+</span> <span class="s1">&#39;,&#39;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">body</span><span class="o">.</span><span class="n">RelativeVelocityMagnitude</span><span class="p">)</span> <span class="o">+</span> <span class="s1">&#39;,&#39;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="nb">max</span><span class="p">(</span><span class="n">forward_guesstimated_deltav</span><span class="p">,</span> <span class="n">backward_guesstimated_deltav</span><span class="p">))</span> <span class="o">+</span> <span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">)</span>
                    
                        <span class="k">if</span> <span class="nb">hasattr</span><span class="p">(</span><span class="n">OutputWindow</span><span class="p">,</span><span class="s1">&#39;WriteText&#39;</span><span class="p">):</span>
                            <span class="n">OutputWindow</span><span class="o">.</span><span class="n">WriteText</span><span class="p">(</span><span class="s2">&quot;Found &quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">event_body_list</span><span class="p">))</span> <span class="o">+</span> <span class="s2">&quot; candidates</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>
                        <span class="n">bubblefile</span><span class="o">.</span><span class="n">flush</span><span class="p">()</span>

                    <span class="n">bubblefile</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">)</span>
                    <span class="n">bubblefile</span><span class="o">.</span><span class="n">flush</span><span class="p">()</span>

        <span class="k">if</span> <span class="nb">hasattr</span><span class="p">(</span><span class="n">OutputWindow</span><span class="p">,</span><span class="s1">&#39;WriteText&#39;</span><span class="p">):</span>
            <span class="n">OutputWindow</span><span class="o">.</span><span class="n">WriteText</span><span class="p">(</span><span class="s2">&quot;Bubble search outputted to &quot;</span> <span class="o">+</span> <span class="n">bubblefile</span><span class="o">.</span><span class="n">name</span> <span class="o">+</span> <span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>

            <span class="c1">#do we want to keep going after the end of the mission?</span>
            <span class="k">if</span> <span class="p">(</span><span class="n">BubbleOptions</span><span class="o">.</span><span class="n">CheckForEncountersAfterMissionEnd</span><span class="p">):</span>
                <span class="n">bubblefile</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s1">&#39;Post-mission encounters</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">)</span>
                <span class="n">bubblefile</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s1">&#39;Julian Date, Gregorian Date, Body Name, SPICE ID, Body SMA, Tholen spectral type, SMASSII spectral type, Absolute Magnitude, Diameter, Distance (km), Distance (LU), Relative Velocity (km/s), Guesstimated intercept delta-v (km/s)</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">)</span>

                <span class="n">PostMissionState</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">Journeys</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">missionevents</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">SpacecraftState</span>
                <span class="n">PostMissionCOE</span> <span class="o">=</span> <span class="n">kepler</span><span class="o">.</span><span class="n">cart2kep</span><span class="p">(</span><span class="n">PostMissionState</span><span class="p">[</span><span class="mi">0</span><span class="p">:</span><span class="mi">3</span><span class="p">],</span><span class="n">PostMissionState</span><span class="p">[</span><span class="mi">3</span><span class="p">:</span><span class="mi">6</span><span class="p">],</span><span class="n">BubbleOptions</span><span class="o">.</span><span class="n">mu</span><span class="p">)</span>
                <span class="n">MissionEndEpoch</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">Journeys</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">missionevents</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">JulianDate</span>
                <span class="n">PostMissionPropagationStep</span> <span class="o">=</span> <span class="n">BubbleOptions</span><span class="o">.</span><span class="n">PostMissionCheckDuration</span> <span class="o">/</span> <span class="n">BubbleOptions</span><span class="o">.</span><span class="n">PostMissionCheckSteps</span>

                <span class="k">for</span> <span class="n">step</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">BubbleOptions</span><span class="o">.</span><span class="n">PostMissionCheckSteps</span><span class="p">):</span>
                    <span class="n">CurrentEpoch</span> <span class="o">=</span> <span class="n">MissionEndEpoch</span> <span class="o">+</span> <span class="p">(</span><span class="n">step</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span> <span class="o">*</span> <span class="n">PostMissionPropagationStep</span>
                    <span class="c1">#propagate the spacecraft to this epoch</span>
                    <span class="n">r</span><span class="p">,</span> <span class="n">v</span> <span class="o">=</span> <span class="n">kepler</span><span class="o">.</span><span class="n">kepler</span><span class="p">(</span><span class="n">PostMissionCOE</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">PostMissionCOE</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">PostMissionCOE</span><span class="p">[</span><span class="mi">2</span><span class="p">],</span> <span class="n">PostMissionCOE</span><span class="p">[</span><span class="mi">3</span><span class="p">],</span> <span class="n">PostMissionCOE</span><span class="p">[</span><span class="mi">4</span><span class="p">],</span> <span class="n">PostMissionCOE</span><span class="p">[</span><span class="mi">5</span><span class="p">],</span> <span class="n">MissionEndEpoch</span><span class="p">,</span> <span class="n">CurrentEpoch</span><span class="p">,</span> <span class="n">BubbleOptions</span><span class="o">.</span><span class="n">mu</span><span class="p">)</span>
                    <span class="n">state</span> <span class="o">=</span> <span class="p">[</span><span class="n">r</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">r</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">r</span><span class="p">[</span><span class="mi">2</span><span class="p">],</span> <span class="n">v</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">v</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">v</span><span class="p">[</span><span class="mi">2</span><span class="p">]]</span>

                    <span class="c1">#check for bodies</span>
                    <span class="n">OutputWindow</span><span class="o">.</span><span class="n">WriteText</span><span class="p">(</span><span class="s2">&quot;Searching for targets of opportunity on JD &quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">CurrentEpoch</span><span class="p">)</span> <span class="o">+</span> <span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>
                    <span class="n">event_body_list</span> <span class="o">=</span> <span class="n">SmallBodyDatabase</span><span class="o">.</span><span class="n">find_bubble_targets</span><span class="p">(</span><span class="n">state</span><span class="p">,</span> <span class="n">CurrentEpoch</span><span class="p">,</span> <span class="n">BubbleOptions</span><span class="o">.</span><span class="n">RelativePositionFilterMagnitude</span><span class="p">,</span> <span class="n">BubbleOptions</span><span class="o">.</span><span class="n">RelativeVelocityFilterMagnitude</span><span class="p">,</span> <span class="n">BubbleOptions</span><span class="o">.</span><span class="n">MaximumMagnitude</span><span class="p">)</span>

                    <span class="c1">#write fields</span>
                    <span class="k">for</span> <span class="n">body</span> <span class="ow">in</span> <span class="n">event_body_list</span><span class="p">:</span>
                        <span class="k">if</span> <span class="n">body</span><span class="o">.</span><span class="n">Tholen</span> <span class="o">==</span> <span class="s1">&#39;-1&#39;</span><span class="p">:</span>
                            <span class="n">Tholen</span> <span class="o">=</span> <span class="s1">&#39;&#39;</span>
                        <span class="k">else</span><span class="p">:</span>
                            <span class="n">Tholen</span> <span class="o">=</span> <span class="n">body</span><span class="o">.</span><span class="n">Tholen</span>

                        <span class="k">if</span> <span class="n">body</span><span class="o">.</span><span class="n">SMASSII</span> <span class="o">==</span> <span class="s1">&#39;-1&#39;</span><span class="p">:</span>
                            <span class="n">SMASSII</span> <span class="o">=</span> <span class="s1">&#39;&#39;</span>
                        <span class="k">else</span><span class="p">:</span>
                            <span class="n">SMASSII</span> <span class="o">=</span> <span class="n">body</span><span class="o">.</span><span class="n">SMASSII</span>

                        <span class="k">if</span> <span class="n">body</span><span class="o">.</span><span class="n">Diameter</span> <span class="o">==</span> <span class="o">-</span><span class="mi">1</span><span class="p">:</span>
                            <span class="n">Diameter</span> <span class="o">=</span> <span class="s1">&#39;&#39;</span>
                        <span class="k">else</span><span class="p">:</span>
                            <span class="n">Diameter</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="n">body</span><span class="o">.</span><span class="n">Diameter</span><span class="p">)</span>

                        <span class="c1">#compute the Sutter-method guesstimated intercept delta-v relative to the forward and backward bracketing event and take the worst case</span>
                        
                        <span class="n">forward_guesstimated_deltav</span> <span class="o">=</span> <span class="n">body</span><span class="o">.</span><span class="n">RelativePositionMagnitude</span> <span class="o">/</span> <span class="p">(</span><span class="n">CurrentEpoch</span> <span class="o">-</span> <span class="n">MissionEndEpoch</span> <span class="o">+</span> <span class="mf">1.0</span><span class="p">)</span> <span class="o">/</span> <span class="mf">86400.0</span>
                        <span class="k">try</span><span class="p">:</span>
                            <span class="n">myDate</span> <span class="o">=</span> <span class="n">astropy</span><span class="o">.</span><span class="n">time</span><span class="o">.</span><span class="n">Time</span><span class="p">(</span><span class="n">CurrentEpoch</span><span class="p">,</span> <span class="nb">format</span><span class="o">=</span><span class="s1">&#39;jd&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">datetime</span><span class="o">.</span><span class="n">strftime</span><span class="p">(</span><span class="s1">&#39;%m/</span><span class="si">%d</span><span class="s1">/%Y&#39;</span><span class="p">)</span>
                        <span class="k">except</span> <span class="ne">ValueError</span><span class="p">:</span>
                            <span class="n">myDate</span> <span class="o">=</span> <span class="s1">&#39;idate&#39;</span>
                        <span class="n">bubblefile</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">CurrentEpoch</span><span class="p">)</span> <span class="o">+</span> <span class="s1">&#39;,&#39;</span> <span class="o">+</span> <span class="n">myDate</span> <span class="o">+</span> <span class="s1">&#39;,&#39;</span> <span class="o">+</span> <span class="n">body</span><span class="o">.</span><span class="n">name</span> <span class="o">+</span> <span class="s1">&#39;,&#39;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">body</span><span class="o">.</span><span class="n">SPICEID</span><span class="p">)</span> <span class="o">+</span> <span class="s1">&#39;,&#39;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">body</span><span class="o">.</span><span class="n">SMA</span><span class="p">)</span> <span class="o">+</span><span class="s1">&#39;,&#39;</span> <span class="o">+</span> <span class="n">Tholen</span> <span class="o">+</span> <span class="s1">&#39;,&#39;</span> <span class="o">+</span> <span class="n">SMASSII</span> <span class="o">+</span> <span class="s1">&#39;,&#39;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">body</span><span class="o">.</span><span class="n">H</span><span class="p">)</span> <span class="o">+</span> <span class="s1">&#39;,&#39;</span> <span class="o">+</span> <span class="n">Diameter</span> <span class="o">+</span> <span class="s1">&#39;,&#39;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">body</span><span class="o">.</span><span class="n">RelativePositionMagnitude</span><span class="p">)</span> <span class="o">+</span> <span class="s1">&#39;,&#39;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">body</span><span class="o">.</span><span class="n">RelativePositionMagnitude</span> <span class="o">/</span> <span class="n">BubbleOptions</span><span class="o">.</span><span class="n">LU</span><span class="p">)</span> <span class="o">+</span> <span class="s1">&#39;,&#39;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">body</span><span class="o">.</span><span class="n">RelativeVelocityMagnitude</span><span class="p">)</span> <span class="o">+</span> <span class="s1">&#39;,&#39;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">forward_guesstimated_deltav</span><span class="p">)</span> <span class="o">+</span> <span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">)</span>
                    
                    <span class="n">OutputWindow</span><span class="o">.</span><span class="n">WriteText</span><span class="p">(</span><span class="s2">&quot;Found &quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">event_body_list</span><span class="p">))</span> <span class="o">+</span> <span class="s2">&quot; candidates</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>
                    <span class="n">bubblefile</span><span class="o">.</span><span class="n">flush</span><span class="p">()</span>

                <span class="n">bubblefile</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">)</span>
        <span class="n">OutputWindow</span><span class="o">.</span><span class="n">WriteText</span><span class="p">(</span><span class="s2">&quot;Bubble search outputted to &quot;</span> <span class="o">+</span> <span class="n">bubblefile</span><span class="o">.</span><span class="n">name</span> <span class="o">+</span> <span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>

        <span class="n">bubblefile</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>

        <span class="k">if</span> <span class="n">BubbleOptions</span><span class="o">.</span><span class="n">ifSpice</span><span class="p">:</span>
            <span class="k">for</span> <span class="n">file</span> <span class="ow">in</span> <span class="n">loaded_SPICE_files</span><span class="p">:</span>
                    <span class="n">spice</span><span class="o">.</span><span class="n">unload</span><span class="p">(</span><span class="n">file</span><span class="p">)</span></div>


    <span class="c1">#method to generate a throttle table report</span>
<div class="viewcode-block" id="Mission.CalculateThrottleTableHistory">
<a class="viewcode-back" href="../PyEMTG/Mission.html#Mission.Mission.CalculateThrottleTableHistory">[docs]</a>
    <span class="k">def</span> <span class="nf">CalculateThrottleTableHistory</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>

        <span class="c1">#find the throttle table setting for each time step</span>
        <span class="n">requested_throttle_table</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="n">mission_throttle_table</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="n">time_step_length_array</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="n">mass_per_step_array</span> <span class="o">=</span> <span class="p">[]</span> <span class="c1"># in kg</span>
        <span class="n">mass_per_step_per_thruster_array</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="n">hours_per_step_array</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="n">hours_per_step_per_thruster_array</span> <span class="o">=</span> <span class="p">[]</span>
        
        <span class="k">for</span> <span class="n">ActiveJourney</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">ChosenJourneys</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">ActiveJourney</span> <span class="o">=</span> <span class="n">ActiveJourney</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">ActiveJourney</span> <span class="o">&lt;=</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">Journeys</span><span class="p">)</span> <span class="o">-</span> <span class="mi">1</span><span class="p">:</span> <span class="c1">#if one journey is selected</span>
                <span class="k">for</span> <span class="n">event</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">Journeys</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">ActiveJourney</span><span class="p">]</span><span class="o">.</span><span class="n">missionevents</span><span class="p">:</span>
                    <span class="k">if</span> <span class="n">event</span><span class="o">.</span><span class="n">EventType</span> <span class="ow">in</span> <span class="p">[</span><span class="s1">&#39;SFthrust&#39;</span><span class="p">,</span> <span class="s1">&#39;SSFthrust&#39;</span><span class="p">,</span> <span class="s1">&#39;FBLTSthrust&#39;</span><span class="p">,</span> <span class="s1">&#39;FBLTthrust&#39;</span><span class="p">,</span> <span class="s1">&#39;PSBIthrust&#39;</span><span class="p">,</span> <span class="s1">&#39;PSFBthrust&#39;</span><span class="p">,</span> <span class="s1">&#39;LT_spiral&#39;</span><span class="p">]</span> <span class="ow">and</span> <span class="n">event</span><span class="o">.</span><span class="n">Number_of_Active_Engines</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
                        
                        <span class="n">mission_throttle_table</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">event</span><span class="o">.</span><span class="n">ThrottleLevel</span><span class="p">)</span>

                        <span class="n">time_step_length_array</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">event</span><span class="o">.</span><span class="n">TimestepLength</span> <span class="o">*</span> <span class="mi">86400</span><span class="p">)</span> <span class="c1"># in seconds</span>
                        
                        <span class="n">mass_per_step_array</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">event</span><span class="o">.</span><span class="n">MassFlowRate</span> <span class="o">*</span> <span class="n">time_step_length_array</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">Journeys</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">ActiveJourney</span><span class="p">]</span><span class="o">.</span><span class="n">thruster_duty_cycle</span><span class="p">)</span>
                        <span class="n">mass_per_step_per_thruster_array</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">mass_per_step_array</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">/</span> <span class="n">event</span><span class="o">.</span><span class="n">Number_of_Active_Engines</span><span class="p">)</span>
                        
                        <span class="n">hours_per_step_array</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">event</span><span class="o">.</span><span class="n">TimestepLength</span> <span class="o">*</span> <span class="mf">24.0</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">Journeys</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">ActiveJourney</span><span class="p">]</span><span class="o">.</span><span class="n">thruster_duty_cycle</span><span class="p">)</span>
                        <span class="n">hours_per_step_per_thruster_array</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">hours_per_step_array</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">/</span> <span class="n">event</span><span class="o">.</span><span class="n">Number_of_Active_Engines</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">Journeys</span><span class="p">)):</span> <span class="c1">#for all journeys</span>
                    <span class="k">for</span> <span class="n">event</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">Journeys</span><span class="p">[</span><span class="n">j</span><span class="p">]</span><span class="o">.</span><span class="n">missionevents</span><span class="p">:</span>
                        <span class="k">if</span> <span class="n">event</span><span class="o">.</span><span class="n">EventType</span> <span class="ow">in</span> <span class="p">[</span><span class="s1">&#39;SFthrust&#39;</span><span class="p">,</span> <span class="s1">&#39;SSFthrust&#39;</span><span class="p">,</span> <span class="s1">&#39;FBLTSthrust&#39;</span><span class="p">,</span> <span class="s1">&#39;FBLTthrust&#39;</span><span class="p">,</span> <span class="s1">&#39;PSBIthrust&#39;</span><span class="p">,</span> <span class="s1">&#39;end_spiral&#39;</span><span class="p">]</span> <span class="ow">and</span> <span class="n">event</span><span class="o">.</span><span class="n">Number_of_Active_Engines</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
                            
                            <span class="n">mission_throttle_table</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">event</span><span class="o">.</span><span class="n">ThrottleLevel</span><span class="p">)</span>

                            <span class="n">time_step_length_array</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">event</span><span class="o">.</span><span class="n">TimestepLength</span> <span class="o">*</span> <span class="mi">86400</span><span class="p">)</span> <span class="c1"># in seconds</span>
                           
                            <span class="n">mass_per_step_array</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">event</span><span class="o">.</span><span class="n">MassFlowRate</span> <span class="o">*</span> <span class="n">time_step_length_array</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">Journeys</span><span class="p">[</span><span class="n">j</span><span class="p">]</span><span class="o">.</span><span class="n">thruster_duty_cycle</span><span class="p">)</span>
                            <span class="n">mass_per_step_per_thruster_array</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">mass_per_step_array</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">/</span> <span class="n">event</span><span class="o">.</span><span class="n">Number_of_Active_Engines</span><span class="p">)</span>
                            
                            <span class="n">hours_per_step_array</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">event</span><span class="o">.</span><span class="n">TimestepLength</span> <span class="o">*</span> <span class="mf">24.0</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">Journeys</span><span class="p">[</span><span class="n">j</span><span class="p">]</span><span class="o">.</span><span class="n">thruster_duty_cycle</span><span class="p">)</span>
                            <span class="n">hours_per_step_per_thruster_array</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">hours_per_step_array</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">/</span> <span class="n">event</span><span class="o">.</span><span class="n">Number_of_Active_Engines</span><span class="p">)</span>

        <span class="c1">#bin the throttle table</span>
        <span class="n">throttle_table_bins</span> <span class="o">=</span> <span class="p">[</span><span class="mf">0.0</span><span class="p">]</span> <span class="o">*</span> <span class="nb">max</span><span class="p">(</span><span class="n">mission_throttle_table</span><span class="p">)</span>
        <span class="n">throttle_table_bins_per_thruster</span> <span class="o">=</span> <span class="p">[</span><span class="mf">0.0</span><span class="p">]</span> <span class="o">*</span> <span class="nb">max</span><span class="p">(</span><span class="n">mission_throttle_table</span><span class="p">)</span>
        <span class="n">throttle_table_hours_bins</span> <span class="o">=</span> <span class="p">[</span><span class="mf">0.0</span><span class="p">]</span> <span class="o">*</span> <span class="nb">max</span><span class="p">(</span><span class="n">mission_throttle_table</span><span class="p">)</span>
        <span class="n">throttle_table_hours_per_thruster</span> <span class="o">=</span> <span class="p">[</span><span class="mf">0.0</span><span class="p">]</span> <span class="o">*</span> <span class="nb">max</span><span class="p">(</span><span class="n">mission_throttle_table</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">mission_throttle_table</span><span class="p">)):</span>
            <span class="n">throttle_table_bins</span><span class="p">[</span><span class="nb">int</span><span class="p">(</span><span class="n">mission_throttle_table</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)]</span> <span class="o">+=</span> <span class="n">mass_per_step_array</span><span class="p">[</span><span class="n">i</span><span class="p">]</span>
            <span class="n">throttle_table_hours_bins</span><span class="p">[</span><span class="nb">int</span><span class="p">(</span><span class="n">mission_throttle_table</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)]</span> <span class="o">+=</span> <span class="n">hours_per_step_array</span><span class="p">[</span><span class="n">i</span><span class="p">]</span>
            <span class="n">throttle_table_bins_per_thruster</span><span class="p">[</span><span class="nb">int</span><span class="p">(</span><span class="n">mission_throttle_table</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)]</span> <span class="o">+=</span> <span class="n">mass_per_step_per_thruster_array</span><span class="p">[</span><span class="n">i</span><span class="p">]</span>
            <span class="n">throttle_table_hours_per_thruster</span><span class="p">[</span><span class="nb">int</span><span class="p">(</span><span class="n">mission_throttle_table</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)]</span> <span class="o">+=</span> <span class="n">hours_per_step_per_thruster_array</span><span class="p">[</span><span class="n">i</span><span class="p">]</span>

        <span class="k">return</span> <span class="n">throttle_table_bins</span><span class="p">,</span> <span class="n">mission_throttle_table</span><span class="p">,</span> <span class="n">throttle_table_hours_bins</span><span class="p">,</span> <span class="n">throttle_table_bins_per_thruster</span><span class="p">,</span> <span class="n">throttle_table_hours_per_thruster</span></div>


<div class="viewcode-block" id="Mission.GenerateThrottleReport">
<a class="viewcode-back" href="../PyEMTG/Mission.html#Mission.Mission.GenerateThrottleReport">[docs]</a>
    <span class="k">def</span> <span class="nf">GenerateThrottleReport</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">reportfilename</span><span class="p">):</span>
        <span class="kn">import</span> <span class="nn">astropy</span>
        
        <span class="c1">#get the throttle table settings history and throttle table binning arrays</span>
        <span class="n">throttle_table_bin_array</span><span class="p">,</span> <span class="n">throttle_table_history_array</span><span class="p">,</span> <span class="n">throttle_operation_hours_array</span><span class="p">,</span> <span class="n">throttle_table_bin_per_thruster</span><span class="p">,</span> <span class="n">throttle_operations_hours_per_thruster</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">CalculateThrottleTableHistory</span><span class="p">()</span>

        <span class="c1">#write out the throttle report for each time step</span>
        <span class="n">reportfile</span> <span class="o">=</span> <span class="nb">open</span><span class="p">(</span><span class="n">reportfilename</span><span class="p">,</span> <span class="n">mode</span> <span class="o">=</span> <span class="s1">&#39;w&#39;</span><span class="p">)</span>
        <span class="n">reportfile</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s1">&#39;Throttle table report for &#39;</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">mission_name</span> <span class="o">+</span> <span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">)</span>
        <span class="n">reportfile</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s1">&#39;Segment start date, Segment width (days), Throttle Setting, Throughtput (kg), Total power in (kW), Number of active thrusters, Total thrust (N), Isp, Total mass flow rate (mg/s)</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">)</span>
        <span class="n">counter</span> <span class="o">=</span> <span class="mi">0</span>
        
        <span class="k">for</span> <span class="n">ActiveJourney</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">ChosenJourneys</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">ActiveJourney</span> <span class="o">=</span> <span class="n">ActiveJourney</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">ActiveJourney</span> <span class="o">&lt;=</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">Journeys</span><span class="p">)</span> <span class="o">-</span> <span class="mi">1</span><span class="p">:</span> <span class="c1">#if one journey is selected</span>
                <span class="k">for</span> <span class="n">event</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">Journeys</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">ActiveJourney</span><span class="p">]</span><span class="o">.</span><span class="n">missionevents</span><span class="p">:</span>
                    <span class="k">if</span> <span class="n">event</span><span class="o">.</span><span class="n">EventType</span> <span class="ow">in</span> <span class="p">[</span><span class="s1">&#39;SFthrust&#39;</span><span class="p">,</span> <span class="s1">&#39;SSFthrust&#39;</span><span class="p">,</span> <span class="s1">&#39;FBLTSthrust&#39;</span><span class="p">,</span> <span class="s1">&#39;FBLTthrust&#39;</span><span class="p">,</span> <span class="s1">&#39;PSFBthrust&#39;</span><span class="p">,</span> <span class="s2">&quot;PSBIthrust&quot;</span><span class="p">]:</span>
                        <span class="n">reportfile</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">astropy</span><span class="o">.</span><span class="n">time</span><span class="o">.</span><span class="n">Time</span><span class="p">(</span><span class="n">event</span><span class="o">.</span><span class="n">JulianDate</span> <span class="o">-</span> <span class="n">event</span><span class="o">.</span><span class="n">TimestepLength</span> <span class="o">/</span> <span class="mf">2.0</span><span class="p">,</span> <span class="nb">format</span><span class="o">=</span><span class="s1">&#39;jd&#39;</span><span class="p">,</span> <span class="n">scale</span><span class="o">=</span><span class="s1">&#39;tdb&#39;</span><span class="p">,</span> <span class="n">out_subfmt</span><span class="o">=</span><span class="s1">&#39;date&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">utc</span><span class="o">.</span><span class="n">iso</span> <span class="o">+</span> <span class="s1">&#39;,&#39;</span> <span class="o">+</span> 
                                         <span class="nb">str</span><span class="p">(</span><span class="n">event</span><span class="o">.</span><span class="n">TimestepLength</span><span class="p">)</span> <span class="o">+</span> <span class="s1">&#39;,&#39;</span> <span class="o">+</span>
                                         <span class="nb">str</span><span class="p">(</span><span class="n">event</span><span class="o">.</span><span class="n">ThrottleLevel</span><span class="p">)</span> <span class="o">+</span> <span class="s1">&#39;,&#39;</span> <span class="o">+</span>
                                         <span class="nb">str</span><span class="p">(</span><span class="n">event</span><span class="o">.</span><span class="n">MassFlowRate</span> <span class="o">*</span> <span class="n">event</span><span class="o">.</span><span class="n">TimestepLength</span> <span class="o">*</span> <span class="mf">86400.0</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">Journeys</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">ActiveJourney</span><span class="p">]</span><span class="o">.</span><span class="n">thruster_duty_cycle</span><span class="p">)</span> <span class="o">+</span> <span class="s1">&#39;,&#39;</span> <span class="o">+</span> 
                                         <span class="nb">str</span><span class="p">(</span><span class="n">event</span><span class="o">.</span><span class="n">ActivePower</span><span class="p">)</span> <span class="o">+</span> <span class="s1">&#39;,&#39;</span> <span class="o">+</span>
                                         <span class="nb">str</span><span class="p">(</span><span class="n">event</span><span class="o">.</span><span class="n">Number_of_Active_Engines</span><span class="p">)</span> <span class="o">+</span> <span class="s1">&#39;,&#39;</span> <span class="o">+</span>
                                         <span class="nb">str</span><span class="p">(</span><span class="n">event</span><span class="o">.</span><span class="n">AvailableThrust</span><span class="p">)</span> <span class="o">+</span> <span class="s1">&#39;,&#39;</span> <span class="o">+</span>
                                         <span class="nb">str</span><span class="p">(</span><span class="n">event</span><span class="o">.</span><span class="n">Isp</span><span class="p">)</span> <span class="o">+</span> <span class="s1">&#39;,&#39;</span> <span class="o">+</span>
                                         <span class="nb">str</span><span class="p">(</span><span class="n">event</span><span class="o">.</span><span class="n">MassFlowRate</span> <span class="o">*</span> <span class="mf">1.0e+6</span><span class="p">)</span> <span class="o">+</span> <span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">)</span>
                        <span class="n">counter</span> <span class="o">+=</span> <span class="mi">1</span>
                    <span class="k">elif</span> <span class="n">event</span><span class="o">.</span><span class="n">EventType</span> <span class="o">==</span> <span class="s1">&#39;end_spiral&#39;</span><span class="p">:</span>
                        <span class="n">reportfile</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">astropy</span><span class="o">.</span><span class="n">time</span><span class="o">.</span><span class="n">Time</span><span class="p">(</span><span class="n">event</span><span class="o">.</span><span class="n">JulianDate</span> <span class="o">-</span> <span class="n">event</span><span class="o">.</span><span class="n">TimestepLength</span><span class="p">,</span> <span class="nb">format</span><span class="o">=</span><span class="s1">&#39;jd&#39;</span><span class="p">,</span> <span class="n">scale</span><span class="o">=</span><span class="s1">&#39;tdb&#39;</span><span class="p">,</span> <span class="n">out_subfmt</span><span class="o">=</span><span class="s1">&#39;date&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">utc</span><span class="o">.</span><span class="n">iso</span> <span class="o">+</span> <span class="s1">&#39;,&#39;</span> <span class="o">+</span> 
                                         <span class="nb">str</span><span class="p">(</span><span class="n">event</span><span class="o">.</span><span class="n">TimestepLength</span><span class="p">)</span> <span class="o">+</span> <span class="s1">&#39;,&#39;</span> <span class="o">+</span>
                                         <span class="nb">str</span><span class="p">(</span><span class="n">event</span><span class="o">.</span><span class="n">ThrottleLevel</span><span class="p">)</span> <span class="o">+</span> <span class="s1">&#39;,&#39;</span> <span class="o">+</span>
                                         <span class="nb">str</span><span class="p">(</span><span class="n">event</span><span class="o">.</span><span class="n">MassFlowRate</span> <span class="o">*</span> <span class="n">event</span><span class="o">.</span><span class="n">TimestepLength</span> <span class="o">*</span> <span class="mf">86400.0</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">Journeys</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">ActiveJourney</span><span class="p">]</span><span class="o">.</span><span class="n">thruster_duty_cycle</span><span class="p">)</span> <span class="o">+</span> <span class="s1">&#39;,&#39;</span> <span class="o">+</span> 
                                         <span class="nb">str</span><span class="p">(</span><span class="n">event</span><span class="o">.</span><span class="n">ActivePower</span><span class="p">)</span> <span class="o">+</span> <span class="s1">&#39;,&#39;</span> <span class="o">+</span>
                                         <span class="nb">str</span><span class="p">(</span><span class="n">event</span><span class="o">.</span><span class="n">Number_of_Active_Engines</span><span class="p">)</span> <span class="o">+</span> <span class="s1">&#39;,&#39;</span> <span class="o">+</span>
                                         <span class="nb">str</span><span class="p">(</span><span class="n">event</span><span class="o">.</span><span class="n">AvailableThrust</span><span class="p">)</span> <span class="o">+</span> <span class="s1">&#39;,&#39;</span> <span class="o">+</span>
                                         <span class="nb">str</span><span class="p">(</span><span class="n">event</span><span class="o">.</span><span class="n">Isp</span><span class="p">)</span> <span class="o">+</span> <span class="s1">&#39;,&#39;</span> <span class="o">+</span>
                                         <span class="nb">str</span><span class="p">(</span><span class="n">event</span><span class="o">.</span><span class="n">MassFlowRate</span> <span class="o">*</span> <span class="mf">1.0e+6</span><span class="p">)</span> <span class="o">+</span> <span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">)</span>
                        <span class="n">counter</span> <span class="o">+=</span> <span class="mi">1</span>

            <span class="k">else</span><span class="p">:</span>
                <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">Journeys</span><span class="p">)):</span> <span class="c1">#for all journeys</span>
                    <span class="k">for</span> <span class="n">event</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">Journeys</span><span class="p">[</span><span class="n">j</span><span class="p">]</span><span class="o">.</span><span class="n">missionevents</span><span class="p">:</span>
                        <span class="k">if</span> <span class="n">event</span><span class="o">.</span><span class="n">EventType</span> <span class="ow">in</span> <span class="p">[</span><span class="s1">&#39;SFthrust&#39;</span><span class="p">,</span> <span class="s1">&#39;SSFthrust&#39;</span><span class="p">,</span> <span class="s1">&#39;FBLTSthrust&#39;</span><span class="p">,</span> <span class="s1">&#39;FBLTthrust&#39;</span><span class="p">,</span> <span class="s1">&#39;PSFBthrust&#39;</span><span class="p">,</span> <span class="s2">&quot;PSBIthrust&quot;</span><span class="p">]</span> <span class="ow">and</span> <span class="n">event</span><span class="o">.</span><span class="n">Number_of_Active_Engines</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
                            <span class="n">reportfile</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">astropy</span><span class="o">.</span><span class="n">time</span><span class="o">.</span><span class="n">Time</span><span class="p">(</span><span class="n">event</span><span class="o">.</span><span class="n">JulianDate</span> <span class="o">-</span> <span class="n">event</span><span class="o">.</span><span class="n">TimestepLength</span> <span class="o">/</span> <span class="mf">2.0</span><span class="p">,</span> <span class="nb">format</span><span class="o">=</span><span class="s1">&#39;jd&#39;</span><span class="p">,</span> <span class="n">scale</span><span class="o">=</span><span class="s1">&#39;tdb&#39;</span><span class="p">,</span> <span class="n">out_subfmt</span><span class="o">=</span><span class="s1">&#39;date&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">utc</span><span class="o">.</span><span class="n">iso</span> <span class="o">+</span> <span class="s1">&#39;,&#39;</span> <span class="o">+</span> 
                                         <span class="nb">str</span><span class="p">(</span><span class="n">event</span><span class="o">.</span><span class="n">TimestepLength</span><span class="p">)</span> <span class="o">+</span> <span class="s1">&#39;,&#39;</span> <span class="o">+</span>
                                         <span class="nb">str</span><span class="p">(</span><span class="n">event</span><span class="o">.</span><span class="n">ThrottleLevel</span><span class="p">)</span> <span class="o">+</span> <span class="s1">&#39;,&#39;</span> <span class="o">+</span>
                                         <span class="nb">str</span><span class="p">(</span><span class="n">event</span><span class="o">.</span><span class="n">MassFlowRate</span> <span class="o">*</span> <span class="n">event</span><span class="o">.</span><span class="n">TimestepLength</span> <span class="o">*</span> <span class="mf">86400.0</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">Journeys</span><span class="p">[</span><span class="n">j</span><span class="p">]</span><span class="o">.</span><span class="n">thruster_duty_cycle</span><span class="p">)</span> <span class="o">+</span> <span class="s1">&#39;,&#39;</span> <span class="o">+</span> 
                                         <span class="nb">str</span><span class="p">(</span><span class="n">event</span><span class="o">.</span><span class="n">ActivePower</span><span class="p">)</span> <span class="o">+</span> <span class="s1">&#39;,&#39;</span> <span class="o">+</span>
                                         <span class="nb">str</span><span class="p">(</span><span class="n">event</span><span class="o">.</span><span class="n">Number_of_Active_Engines</span><span class="p">)</span> <span class="o">+</span> <span class="s1">&#39;,&#39;</span> <span class="o">+</span>
                                         <span class="nb">str</span><span class="p">(</span><span class="n">event</span><span class="o">.</span><span class="n">AvailableThrust</span><span class="p">)</span> <span class="o">+</span> <span class="s1">&#39;,&#39;</span> <span class="o">+</span>
                                         <span class="nb">str</span><span class="p">(</span><span class="n">event</span><span class="o">.</span><span class="n">Isp</span><span class="p">)</span> <span class="o">+</span> <span class="s1">&#39;,&#39;</span> <span class="o">+</span>
                                         <span class="nb">str</span><span class="p">(</span><span class="n">event</span><span class="o">.</span><span class="n">MassFlowRate</span> <span class="o">*</span> <span class="mf">1.0e+6</span><span class="p">)</span> <span class="o">+</span> <span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">)</span>
                            <span class="n">counter</span> <span class="o">+=</span> <span class="mi">1</span>
                        <span class="k">elif</span> <span class="n">event</span><span class="o">.</span><span class="n">EventType</span> <span class="o">==</span> <span class="s1">&#39;end_spiral&#39;</span><span class="p">:</span>
                            <span class="n">reportfile</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">astropy</span><span class="o">.</span><span class="n">time</span><span class="o">.</span><span class="n">Time</span><span class="p">(</span><span class="n">event</span><span class="o">.</span><span class="n">JulianDate</span> <span class="o">-</span> <span class="n">event</span><span class="o">.</span><span class="n">TimestepLength</span><span class="p">,</span> <span class="nb">format</span><span class="o">=</span><span class="s1">&#39;jd&#39;</span><span class="p">,</span> <span class="n">scale</span><span class="o">=</span><span class="s1">&#39;tdb&#39;</span><span class="p">,</span> <span class="n">out_subfmt</span><span class="o">=</span><span class="s1">&#39;date&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">utc</span><span class="o">.</span><span class="n">iso</span> <span class="o">+</span> <span class="s1">&#39;,&#39;</span> <span class="o">+</span> 
                                         <span class="nb">str</span><span class="p">(</span><span class="n">event</span><span class="o">.</span><span class="n">TimestepLength</span><span class="p">)</span> <span class="o">+</span> <span class="s1">&#39;,&#39;</span> <span class="o">+</span>
                                         <span class="nb">str</span><span class="p">(</span><span class="n">event</span><span class="o">.</span><span class="n">ThrottleLevel</span><span class="p">)</span> <span class="o">+</span> <span class="s1">&#39;,&#39;</span> <span class="o">+</span>
                                         <span class="nb">str</span><span class="p">(</span><span class="n">event</span><span class="o">.</span><span class="n">MassFlowRate</span> <span class="o">*</span> <span class="n">event</span><span class="o">.</span><span class="n">TimestepLength</span> <span class="o">*</span> <span class="mf">86400.0</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">Journeys</span><span class="p">[</span><span class="n">j</span><span class="p">]</span><span class="o">.</span><span class="n">thruster_duty_cycle</span><span class="p">)</span> <span class="o">+</span> <span class="s1">&#39;,&#39;</span> <span class="o">+</span> 
                                         <span class="nb">str</span><span class="p">(</span><span class="n">event</span><span class="o">.</span><span class="n">ActivePower</span><span class="p">)</span> <span class="o">+</span> <span class="s1">&#39;,&#39;</span> <span class="o">+</span>
                                         <span class="nb">str</span><span class="p">(</span><span class="n">event</span><span class="o">.</span><span class="n">Number_of_Active_Engines</span><span class="p">)</span> <span class="o">+</span> <span class="s1">&#39;,&#39;</span> <span class="o">+</span>
                                         <span class="nb">str</span><span class="p">(</span><span class="n">event</span><span class="o">.</span><span class="n">AvailableThrust</span><span class="p">)</span> <span class="o">+</span> <span class="s1">&#39;,&#39;</span> <span class="o">+</span>
                                         <span class="nb">str</span><span class="p">(</span><span class="n">event</span><span class="o">.</span><span class="n">Isp</span><span class="p">)</span> <span class="o">+</span> <span class="s1">&#39;,&#39;</span> <span class="o">+</span>
                                         <span class="nb">str</span><span class="p">(</span><span class="n">event</span><span class="o">.</span><span class="n">MassFlowRate</span> <span class="o">*</span> <span class="mf">1.0e+6</span><span class="p">)</span> <span class="o">+</span> <span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">)</span>
                            <span class="n">counter</span> <span class="o">+=</span> <span class="mi">1</span>

        <span class="n">reportfile</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">)</span>
        <span class="n">reportfile</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">)</span>

        <span class="c1">#write out a throttle binning report</span>
        <span class="n">reportfile</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s1">&#39;Throttle table binning report for &#39;</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">mission_name</span> <span class="o">+</span> <span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">)</span>
        <span class="n">reportfile</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s1">&#39;Throttle setting, Throughput (kg), operating hours, Throughput per thruster (kg), operating hours per thruster</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">throttle_table_bin_array</span><span class="p">)):</span>
            <span class="n">reportfile</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">i</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span> <span class="o">+</span> <span class="s1">&#39;,&#39;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">throttle_table_bin_array</span><span class="p">[</span><span class="n">i</span><span class="p">])</span> <span class="o">+</span> <span class="s1">&#39;,&#39;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">throttle_operation_hours_array</span><span class="p">[</span><span class="n">i</span><span class="p">])</span> <span class="o">+</span> <span class="s1">&#39;,&#39;</span>\
               <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">throttle_table_bin_per_thruster</span><span class="p">[</span><span class="n">i</span><span class="p">])</span> <span class="o">+</span> <span class="s1">&#39;,&#39;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">throttle_operations_hours_per_thruster</span><span class="p">[</span><span class="n">i</span><span class="p">])</span> <span class="o">+</span> <span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">)</span>

        <span class="n">reportfile</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s1">&#39;</span><span class="se">\n\n</span><span class="s1">&#39;</span><span class="p">)</span>
        <span class="n">reportfile</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s1">&#39;Worst case for a single thruster</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">)</span>
        <span class="n">reportfile</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s1">&#39;computed by always being on in multi-thruster operations and handling all of the single-thrust operations)</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">)</span>
        <span class="n">single_thruster_worst_case_throughput</span> <span class="o">=</span> <span class="mf">0.0</span>
        <span class="n">single_thruster_worst_case_hours</span> <span class="o">=</span> <span class="mf">0.0</span>
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">throttle_table_bin_array</span><span class="p">)):</span>
            <span class="n">single_thruster_worst_case_throughput</span> <span class="o">+=</span> <span class="n">throttle_table_bin_per_thruster</span><span class="p">[</span><span class="n">i</span><span class="p">]</span>
            <span class="n">single_thruster_worst_case_hours</span> <span class="o">+=</span> <span class="n">throttle_operations_hours_per_thruster</span><span class="p">[</span><span class="n">i</span><span class="p">]</span>
        <span class="n">reportfile</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s1">&#39;throughput (kg): &#39;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">single_thruster_worst_case_throughput</span><span class="p">)</span> <span class="o">+</span> <span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">)</span>
        <span class="n">reportfile</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s1">&#39;operating hours: &#39;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">single_thruster_worst_case_hours</span><span class="p">)</span> <span class="o">+</span> <span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">)</span>

        <span class="n">reportfile</span><span class="o">.</span><span class="n">close</span><span class="p">()</span></div>

        
<div class="viewcode-block" id="Mission.GenerateThrottlePlot">
<a class="viewcode-back" href="../PyEMTG/Mission.html#Mission.Mission.GenerateThrottlePlot">[docs]</a>
    <span class="k">def</span> <span class="nf">GenerateThrottlePlot</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">throttletablefile</span><span class="p">,</span> <span class="n">reportfilename</span><span class="p">):</span>
        <span class="kn">import</span> <span class="nn">matplotlib.pyplot</span> <span class="k">as</span> <span class="nn">plt</span>
        
        <span class="n">trajectory_mdot</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="n">trajectory_thrust</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="n">trajectory_power</span> <span class="o">=</span> <span class="p">[]</span>
        
        <span class="n">counter</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="k">for</span> <span class="n">ActiveJourney</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">ChosenJourneys</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">ActiveJourney</span> <span class="o">=</span> <span class="n">ActiveJourney</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">ActiveJourney</span> <span class="o">&lt;=</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">Journeys</span><span class="p">)</span> <span class="o">-</span> <span class="mi">1</span><span class="p">:</span> <span class="c1">#if one journey is selected</span>
                <span class="k">for</span> <span class="n">event</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">Journeys</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">ActiveJourney</span><span class="p">]</span><span class="o">.</span><span class="n">missionevents</span><span class="p">:</span>
                    <span class="k">if</span> <span class="n">event</span><span class="o">.</span><span class="n">EventType</span> <span class="ow">in</span> <span class="p">[</span><span class="s1">&#39;SFthrust&#39;</span><span class="p">,</span> <span class="s1">&#39;SSFthrust&#39;</span><span class="p">,</span> <span class="s1">&#39;FBLTSthrust&#39;</span><span class="p">,</span> <span class="s1">&#39;FBLTthrust&#39;</span><span class="p">,</span> <span class="s2">&quot;PSBIthrust&quot;</span><span class="p">]:</span>
                        <span class="n">trajectory_mdot</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">event</span><span class="o">.</span><span class="n">MassFlowRate</span> <span class="o">*</span> <span class="mf">1.0e+6</span> <span class="o">/</span> <span class="n">event</span><span class="o">.</span><span class="n">Number_of_Active_Engines</span> <span class="o">/</span> <span class="n">event</span><span class="o">.</span><span class="n">DVmagorThrottle</span><span class="p">)</span>
                        <span class="n">trajectory_thrust</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">event</span><span class="o">.</span><span class="n">AvailableThrust</span> <span class="o">*</span> <span class="mf">1.0e+3</span> <span class="o">/</span> <span class="n">event</span><span class="o">.</span><span class="n">Number_of_Active_Engines</span><span class="p">)</span>
                        <span class="n">trajectory_power</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">event</span><span class="o">.</span><span class="n">ActivePower</span> <span class="o">/</span> <span class="n">event</span><span class="o">.</span><span class="n">Number_of_Active_Engines</span><span class="p">)</span>
                        <span class="n">counter</span> <span class="o">+=</span> <span class="mi">1</span>
                    <span class="k">elif</span> <span class="n">event</span><span class="o">.</span><span class="n">EventType</span> <span class="o">==</span> <span class="s1">&#39;end_spiral&#39;</span><span class="p">:</span>
                        <span class="n">trajectory_mdot</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">event</span><span class="o">.</span><span class="n">MassFlowRate</span> <span class="o">*</span> <span class="mf">1.0e+6</span> <span class="o">/</span> <span class="n">event</span><span class="o">.</span><span class="n">Number_of_Active_Engines</span> <span class="o">/</span> <span class="n">event</span><span class="o">.</span><span class="n">DVmagorThrottle</span><span class="p">)</span>
                        <span class="n">trajectory_thrust</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">event</span><span class="o">.</span><span class="n">AvailableThrust</span> <span class="o">*</span> <span class="mf">1.0e+3</span> <span class="o">/</span> <span class="n">event</span><span class="o">.</span><span class="n">Number_of_Active_Engines</span><span class="p">)</span>
                        <span class="n">trajectory_power</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">event</span><span class="o">.</span><span class="n">ActivePower</span> <span class="o">/</span> <span class="n">event</span><span class="o">.</span><span class="n">Number_of_Active_Engines</span><span class="p">)</span>
                        <span class="n">counter</span> <span class="o">+=</span> <span class="mi">1</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">Journeys</span><span class="p">)):</span> <span class="c1">#for all journeys</span>
                    <span class="k">for</span> <span class="n">event</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">Journeys</span><span class="p">[</span><span class="n">j</span><span class="p">]</span><span class="o">.</span><span class="n">missionevents</span><span class="p">:</span>
                        <span class="k">if</span> <span class="n">event</span><span class="o">.</span><span class="n">EventType</span> <span class="ow">in</span> <span class="p">[</span><span class="s1">&#39;SFthrust&#39;</span><span class="p">,</span> <span class="s1">&#39;SSFthrust&#39;</span><span class="p">,</span> <span class="s1">&#39;FBLTSthrust&#39;</span><span class="p">,</span> <span class="s1">&#39;FBLTthrust&#39;</span><span class="p">,</span> <span class="s2">&quot;PSBIthrust&quot;</span><span class="p">]</span> <span class="ow">and</span> <span class="n">event</span><span class="o">.</span><span class="n">Number_of_Active_Engines</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
                            <span class="n">trajectory_mdot</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">event</span><span class="o">.</span><span class="n">MassFlowRate</span> <span class="o">*</span> <span class="mf">1.0e+6</span> <span class="o">/</span> <span class="n">event</span><span class="o">.</span><span class="n">Number_of_Active_Engines</span> <span class="o">/</span> <span class="n">event</span><span class="o">.</span><span class="n">DVmagorThrottle</span><span class="p">)</span>
                            <span class="n">trajectory_thrust</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">event</span><span class="o">.</span><span class="n">AvailableThrust</span> <span class="o">*</span> <span class="mf">1.0e+3</span> <span class="o">/</span> <span class="n">event</span><span class="o">.</span><span class="n">Number_of_Active_Engines</span><span class="p">)</span>
                            <span class="n">trajectory_power</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">event</span><span class="o">.</span><span class="n">ActivePower</span> <span class="o">/</span> <span class="n">event</span><span class="o">.</span><span class="n">Number_of_Active_Engines</span><span class="p">)</span>
                            <span class="n">counter</span> <span class="o">+=</span> <span class="mi">1</span>
                        <span class="k">elif</span> <span class="n">event</span><span class="o">.</span><span class="n">EventType</span> <span class="o">==</span> <span class="s1">&#39;end_spiral&#39;</span><span class="p">:</span>
                            <span class="n">trajectory_mdot</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">event</span><span class="o">.</span><span class="n">MassFlowRate</span> <span class="o">*</span> <span class="mf">1.0e+6</span> <span class="o">/</span> <span class="n">event</span><span class="o">.</span><span class="n">Number_of_Active_Engines</span> <span class="o">/</span> <span class="n">event</span><span class="o">.</span><span class="n">DVmagorThrottle</span><span class="p">)</span>
                            <span class="n">trajectory_thrust</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">event</span><span class="o">.</span><span class="n">AvailableThrust</span> <span class="o">*</span> <span class="mf">1.0e+3</span> <span class="o">/</span> <span class="n">event</span><span class="o">.</span><span class="n">Number_of_Active_Engines</span><span class="p">)</span>
                            <span class="n">trajectory_power</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">event</span><span class="o">.</span><span class="n">ActivePower</span> <span class="o">/</span> <span class="n">event</span><span class="o">.</span><span class="n">Number_of_Active_Engines</span><span class="p">)</span>
                            <span class="n">counter</span> <span class="o">+=</span> <span class="mi">1</span>
                 

        <span class="n">thruster_throttle_table</span> <span class="o">=</span> <span class="n">ThrottleTable</span><span class="o">.</span><span class="n">ThrottleTable</span><span class="p">(</span><span class="n">throttletablefile</span><span class="p">)</span>
                                
        <span class="n">thruster_throttle_table</span><span class="o">.</span><span class="n">plot_throttle_table</span><span class="p">(</span><span class="kc">False</span><span class="p">,</span> <span class="p">[],</span> <span class="p">[],</span> <span class="kc">False</span><span class="p">,</span><span class="n">trajectory_mdot</span><span class="p">,</span><span class="n">trajectory_thrust</span><span class="p">,</span><span class="n">trajectory_power</span><span class="p">)</span></div>


<div class="viewcode-block" id="Mission.GenerateThrottleHistogram">
<a class="viewcode-back" href="../PyEMTG/Mission.html#Mission.Mission.GenerateThrottleHistogram">[docs]</a>
    <span class="k">def</span> <span class="nf">GenerateThrottleHistogram</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">PlotOptions</span><span class="p">):</span>
        
        <span class="kn">import</span> <span class="nn">matplotlib.pyplot</span>
        <span class="c1">#get the throttle table settings history and throttle table binning arrays</span>
        <span class="n">throttle_table_bin_array</span><span class="p">,</span> <span class="n">throttle_table_history_array</span><span class="p">,</span> <span class="n">throttle_operation_hours_array</span><span class="p">,</span> <span class="n">throttle_table_bin_per_thruster</span><span class="p">,</span> <span class="n">throttle_operations_hours_per_thruster</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">CalculateThrottleTableHistory</span><span class="p">()</span>

        <span class="c1">#generate a histogram</span>
        <span class="n">HistogramFigure</span> <span class="o">=</span> <span class="n">matplotlib</span><span class="o">.</span><span class="n">pyplot</span><span class="o">.</span><span class="n">figure</span><span class="p">()</span>
        <span class="n">HistogramAxes</span> <span class="o">=</span> <span class="n">HistogramFigure</span><span class="o">.</span><span class="n">add_axes</span><span class="p">([</span><span class="mf">0.1</span><span class="p">,</span> <span class="mf">0.1</span><span class="p">,</span> <span class="mf">0.8</span><span class="p">,</span> <span class="mf">0.8</span><span class="p">])</span>
        <span class="n">matplotlib</span><span class="o">.</span><span class="n">rcParams</span><span class="o">.</span><span class="n">update</span><span class="p">({</span><span class="s1">&#39;font.size&#39;</span><span class="p">:</span> <span class="n">PlotOptions</span><span class="o">.</span><span class="n">FontSize</span><span class="p">})</span>

        <span class="n">bins</span> <span class="o">=</span> <span class="nb">range</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">throttle_table_bin_array</span><span class="p">)</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span>
        <span class="n">HistogramAxes</span><span class="o">.</span><span class="n">bar</span><span class="p">(</span><span class="n">bins</span><span class="p">,</span> <span class="n">throttle_table_bin_array</span><span class="p">)</span>
        <span class="n">HistogramAxes</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s1">&#39;Throttle level&#39;</span><span class="p">)</span>
        <span class="n">HistogramAxes</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s1">&#39;Throughput (kg)&#39;</span><span class="p">)</span>
        <span class="n">HistogramAxes</span><span class="o">.</span><span class="n">grid</span><span class="p">(</span><span class="n">b</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
        <span class="n">HistogramAxes</span><span class="o">.</span><span class="n">set_xlim</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">throttle_table_bin_array</span><span class="p">)</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span>
        <span class="n">HistogramAxes</span><span class="o">.</span><span class="n">set_xticks</span><span class="p">(</span><span class="n">bins</span><span class="p">)</span>

        <span class="c1"># Hide major tick labels</span>
        <span class="n">HistogramAxes</span><span class="o">.</span><span class="n">xaxis</span><span class="o">.</span><span class="n">set_major_formatter</span><span class="p">(</span><span class="n">matplotlib</span><span class="o">.</span><span class="n">ticker</span><span class="o">.</span><span class="n">NullFormatter</span><span class="p">())</span>

        <span class="c1"># Customize minor tick labels</span>
        <span class="n">minorlabels</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="n">minorlocators</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">b</span> <span class="ow">in</span> <span class="n">bins</span><span class="p">:</span>
            <span class="n">minorlabels</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">b</span><span class="p">))</span>
            <span class="n">minorlocators</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">b</span> <span class="o">+</span> <span class="mf">0.5</span><span class="p">)</span>
        <span class="n">HistogramAxes</span><span class="o">.</span><span class="n">xaxis</span><span class="o">.</span><span class="n">set_minor_locator</span><span class="p">(</span><span class="n">matplotlib</span><span class="o">.</span><span class="n">ticker</span><span class="o">.</span><span class="n">FixedLocator</span><span class="p">(</span><span class="n">minorlocators</span><span class="p">))</span>
        <span class="n">HistogramAxes</span><span class="o">.</span><span class="n">xaxis</span><span class="o">.</span><span class="n">set_minor_formatter</span><span class="p">(</span><span class="n">matplotlib</span><span class="o">.</span><span class="n">ticker</span><span class="o">.</span><span class="n">FixedFormatter</span><span class="p">(</span><span class="n">minorlabels</span><span class="p">))</span>

        <span class="n">HistogramFigure</span><span class="o">.</span><span class="n">show</span><span class="p">()</span></div>


<div class="viewcode-block" id="Mission.AutoTableMission">
<a class="viewcode-back" href="../PyEMTG/Mission.html#Mission.Mission.AutoTableMission">[docs]</a>
    <span class="k">def</span> <span class="nf">AutoTableMission</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">TableFileName</span><span class="p">,</span> <span class="n">PlotOptions</span><span class="p">):</span>
        <span class="c1">#reset the event label counter</span>
        <span class="n">PlotOptions</span><span class="o">.</span><span class="n">EventCounter</span> <span class="o">=</span> <span class="mi">1</span>
        <span class="n">skipNext</span> <span class="o">=</span> <span class="kc">False</span>

        <span class="c1">#do we need the delta-v and flyby altitude columns?</span>
        <span class="k">for</span> <span class="n">journey</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">Journeys</span><span class="p">:</span>
            <span class="k">for</span> <span class="n">event</span> <span class="ow">in</span> <span class="n">journey</span><span class="o">.</span><span class="n">missionevents</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">event</span><span class="o">.</span><span class="n">EventType</span> <span class="ow">in</span> <span class="p">[</span><span class="s1">&#39;chem_burn&#39;</span><span class="p">,</span><span class="s1">&#39;pwr_flyby&#39;</span><span class="p">,</span><span class="s1">&#39;insertion&#39;</span><span class="p">,</span><span class="s1">&#39;rendezvous&#39;</span><span class="p">,</span><span class="s1">&#39;TCM&#39;</span><span class="p">]:</span>
                    <span class="n">PlotOptions</span><span class="o">.</span><span class="n">AutoTableDeltavColumn</span> <span class="o">=</span> <span class="kc">True</span>
                <span class="k">elif</span> <span class="n">event</span><span class="o">.</span><span class="n">EventType</span> <span class="o">==</span> <span class="s1">&#39;departure&#39;</span> <span class="ow">and</span> <span class="n">event</span><span class="o">.</span><span class="n">DVmagorThrottle</span> <span class="o">&gt;</span> <span class="mf">1.0e-6</span><span class="p">:</span>
                    <span class="n">PlotOptions</span><span class="o">.</span><span class="n">AutoTableDeltavColumn</span> <span class="o">=</span> <span class="kc">True</span>
                <span class="k">if</span> <span class="n">event</span><span class="o">.</span><span class="n">EventType</span> <span class="ow">in</span> <span class="p">[</span><span class="s1">&#39;pwr_flyby&#39;</span><span class="p">,</span><span class="s1">&#39;upwr_flyby&#39;</span><span class="p">,</span><span class="s1">&#39;periapse&#39;</span><span class="p">]:</span>
                    <span class="n">PlotOptions</span><span class="o">.</span><span class="n">AutoTableAltitudeColumn</span> <span class="o">=</span> <span class="kc">True</span>

        <span class="n">TableFile</span> <span class="o">=</span> <span class="nb">open</span><span class="p">(</span><span class="n">TableFileName</span><span class="p">,</span> <span class="n">mode</span> <span class="o">=</span> <span class="s1">&#39;w&#39;</span><span class="p">)</span>

        <span class="n">TableFile</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s1">&#39;</span><span class="si">%a</span><span class="s1">uto-generated table from PyEMTG</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">)</span>
        <span class="n">TableFile</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s1">&#39;</span><span class="se">\\</span><span class="s1">documentclass</span><span class="si">{article}</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">)</span>
        <span class="n">TableFile</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s1">&#39;</span><span class="se">\\</span><span class="s1">usepackage[margin=1in, landscape]</span><span class="si">{geometry}</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">)</span>
        <span class="n">TableFile</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s1">&#39;</span><span class="se">\\</span><span class="s1">usepackage</span><span class="si">{amsmath}</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">)</span>
        <span class="n">TableFile</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s1">&#39;</span><span class="se">\\</span><span class="s1">usepackage</span><span class="si">{float}</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">)</span>
        <span class="n">TableFile</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">)</span>
        <span class="n">TableFile</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s1">&#39;</span><span class="se">\\</span><span class="s1">begin</span><span class="si">{document}</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">)</span>
        <span class="n">TableFile</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">)</span>
        <span class="n">TableFile</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s1">&#39;</span><span class="se">\\</span><span class="s1">begin</span><span class="si">{table}</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">)</span>
        <span class="n">TableFile</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s1">&#39;   \centering</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">)</span>
        <span class="n">TableFile</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s1">&#39;   \caption{Itinerary for &#39;</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">mission_name</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s1">&#39;_&#39;</span><span class="p">,</span><span class="s1">&#39;-&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">strip</span><span class="p">(</span><span class="s1">&#39; &#39;</span><span class="p">)</span> <span class="o">+</span> <span class="s1">&#39;}</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">)</span>
        <span class="n">TableFile</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s1">&#39;   </span><span class="se">\\</span><span class="s1">begin</span><span class="si">{tabular}</span><span class="s1">{lllllll&#39;</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">PlotOptions</span><span class="o">.</span><span class="n">AutoTableAltitudeColumn</span><span class="p">:</span>
            <span class="n">TableFile</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s1">&#39;l&#39;</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">PlotOptions</span><span class="o">.</span><span class="n">AutoTableDeltavColumn</span><span class="p">:</span>
            <span class="n">TableFile</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s1">&#39;ll&#39;</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">PlotOptions</span><span class="o">.</span><span class="n">DisplayEventMass</span><span class="p">:</span>
            <span class="n">TableFile</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s1">&#39;l&#39;</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">PlotOptions</span><span class="o">.</span><span class="n">DisplayArrivalPhaseAngle</span><span class="p">:</span>
            <span class="n">TableFile</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s1">&#39;l&#39;</span><span class="p">)</span>
        <span class="n">TableFile</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s1">&#39;}</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">)</span>
        <span class="n">TableFile</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s1">&#39;       \hline\hline</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">)</span>
        <span class="n">TableFile</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s1">&#39;       Event \# &amp; Date &amp; Event &amp; Location &amp; $v_</span><span class="se">\\</span><span class="s1">infty </span><span class="se">\\</span><span class="s1">left(km/s</span><span class="se">\\</span><span class="s1">right)$&#39;</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">PlotOptions</span><span class="o">.</span><span class="n">AutoTableDeltavColumn</span><span class="p">:</span>
           <span class="n">TableFile</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s1">&#39; &amp; $\Delta v </span><span class="se">\\</span><span class="s1">left(km/s</span><span class="se">\\</span><span class="s1">right)$&#39;</span><span class="p">)</span>
           <span class="n">TableFile</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s1">&#39; &amp; $I_</span><span class="si">{sp}</span><span class="s1">$&#39;</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">PlotOptions</span><span class="o">.</span><span class="n">AutoTableAltitudeColumn</span><span class="p">:</span>
           <span class="n">TableFile</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s1">&#39; &amp; Flyby altitude (km)&#39;</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">PlotOptions</span><span class="o">.</span><span class="n">DisplayEventMass</span><span class="p">:</span>
            <span class="n">TableFile</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s1">&#39; &amp; Mass (kg)&#39;</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">PlotOptions</span><span class="o">.</span><span class="n">DisplayArrivalPhaseAngle</span><span class="p">:</span>
            <span class="n">TableFile</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s1">&#39; &amp; &#39;</span> <span class="o">+</span> <span class="sa">r</span><span class="s1">&#39;$\beta$&#39;</span> <span class="o">+</span> <span class="s1">&#39;(&#39;</span> <span class="o">+</span> <span class="sa">r</span><span class="s1">&#39;$^\circ$&#39;</span> <span class="o">+</span> <span class="s1">&#39;)&#39;</span><span class="p">)</span>
        <span class="n">TableFile</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s1">&#39;</span><span class="se">\\\\\n</span><span class="s1">&#39;</span><span class="p">)</span>
        <span class="n">TableFile</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s1">&#39;       \hline</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">)</span>

        <span class="k">for</span> <span class="n">journey</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">Journeys</span><span class="p">:</span>
            <span class="n">skipNext</span> <span class="o">=</span> <span class="n">journey</span><span class="o">.</span><span class="n">AutoTableJourney</span><span class="p">(</span><span class="n">TableFile</span><span class="p">,</span> <span class="n">PlotOptions</span><span class="p">,</span> <span class="n">skipNext</span><span class="p">)</span>

        <span class="n">TableFile</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s1">&#39;       \hline\hline</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">)</span>
        <span class="n">TableFile</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s1">&#39;   \end</span><span class="si">{tabular}</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">)</span>
        <span class="n">TableFile</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s1">&#39;   \label{tab:&#39;</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">mission_name</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s1">&#39;_&#39;</span><span class="p">,</span><span class="s1">&#39;-&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">strip</span><span class="p">(</span><span class="s1">&#39; &#39;</span><span class="p">)</span> <span class="o">+</span> <span class="s1">&#39;}</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">)</span>
        <span class="n">TableFile</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s1">&#39;\end</span><span class="si">{table}</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">)</span>
        <span class="n">TableFile</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">)</span>
        <span class="n">TableFile</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s1">&#39;Total flight time: &#39;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">total_flight_time_years</span><span class="p">)</span> <span class="o">+</span> <span class="s1">&#39; years</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">)</span>
        <span class="n">TableFile</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">)</span>
        <span class="n">TableFile</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s1">&#39;Total deterministic $\Delta v$: &#39;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">total_deterministic_deltav</span><span class="p">)</span> <span class="o">+</span> <span class="s1">&#39; km/s </span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">)</span>
        <span class="n">TableFile</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">)</span>
        <span class="k">if</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">total_statistical_deltav</span> <span class="o">&gt;</span> <span class="mf">1.0e-8</span><span class="p">):</span>
            <span class="n">TableFile</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s1">&#39;Total statistical $\Delta v$: &#39;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">total_statistical_deltav</span><span class="p">)</span> <span class="o">+</span> <span class="s1">&#39; km/s </span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">)</span>
        <span class="n">TableFile</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">)</span>
        <span class="n">TableFile</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s1">&#39;\end</span><span class="si">{document}</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">)</span>

        <span class="n">TableFile</span><span class="o">.</span><span class="n">close</span><span class="p">()</span></div>


    <span class="c1">#************************************************************************************getJourneyIndex()</span>
<div class="viewcode-block" id="Mission.getJourneyIndex">
<a class="viewcode-back" href="../PyEMTG/Mission.html#Mission.Mission.getJourneyIndex">[docs]</a>
    <span class="k">def</span> <span class="nf">getJourneyIndex</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">journeyNameString</span><span class="p">):</span>
        <span class="k">for</span> <span class="n">journeyIndex</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">Journeys</span><span class="p">)):</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">Journeys</span><span class="p">[</span><span class="n">journeyIndex</span><span class="p">]</span><span class="o">.</span><span class="n">journey_name</span> <span class="o">==</span> <span class="n">journeyNameString</span><span class="p">:</span>
                <span class="k">return</span> <span class="n">journeyIndex</span>
        
        <span class="c1">#if you get this far, something went wrong                                                                 </span>
        <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="s2">&quot;Journey &#39;&quot;</span> <span class="o">+</span> <span class="n">journeyNameString</span> <span class="o">+</span> <span class="s2">&quot;&#39; not found.&quot;</span><span class="p">)</span>  </div>

        
<div class="viewcode-block" id="Mission.Comparatron">
<a class="viewcode-back" href="../PyEMTG/Mission.html#Mission.Mission.Comparatron">[docs]</a>
    <span class="k">def</span> <span class="nf">Comparatron</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">baseline_path</span><span class="p">,</span> <span class="n">csv_file_name</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">full_output</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">tolerance_dict</span><span class="o">=</span><span class="p">{},</span> <span class="n">default_tolerance</span><span class="o">=</span><span class="mf">1e-15</span><span class="p">,</span>
                    <span class="n">attributes_to_ignore</span> <span class="o">=</span> <span class="p">[]):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        baseline_path: the file location of the emtg case to compare against. This is the only required argument.</span>
<span class="sd">        csv_file_name: can specify the output file name. A csv file is only output if there are mismatches between cases. By default, it uses the mission name as the name for the csv output file</span>
<span class="sd">        full_output: determines whether all cases that disagree between self and the baseline will be saved to csv. If True, all cases that are not in exact agreement will be saved. If False, only cases that do not meet the tolerance will be saved to the csv output.</span>
<span class="sd">        tolerance_dict: a dictionary of tolerences that, if provided, will override the default value. Provide a dictionary with the attribute name as the key and the alternate tolerance as the value (i.e. {&#39;total_statistical_deltav&#39;:1e-6,&#39;Declination&#39;:1e-8})</span>
<span class="sd">        default_tolerance: the tolerance value used for all attributes that do not appear in the tolerance_dict</span>
<span class="sd">        attributes_to_ignore: list of attributes that should not be compared between the baseline and self. i.e., we do not care if the values are different.</span>
<span class="sd">        prepend Mission attributes with M., Journey attributes with J., and MissionEvent attributes with E.</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="kn">from</span> <span class="nn">pandas</span> <span class="kn">import</span> <span class="n">DataFrame</span><span class="p">,</span> <span class="n">Series</span><span class="p">,</span> <span class="n">concat</span><span class="p">,</span> <span class="n">merge</span>
        <span class="kn">from</span> <span class="nn">numbers</span> <span class="kn">import</span> <span class="n">Number</span>
        <span class="kn">from</span> <span class="nn">numpy</span> <span class="kn">import</span> <span class="n">frompyfunc</span>

        
        <span class="k">if</span> <span class="n">csv_file_name</span> <span class="o">==</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">csv_file_name</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">mission_name</span> <span class="o">+</span> <span class="s1">&#39;_comparison.csv&#39;</span>
		
        <span class="c1">#Create mission object for baseline case to compare against, create empty dataframe to store comparison</span>
        <span class="n">baseline</span> <span class="o">=</span> <span class="n">Mission</span><span class="p">(</span><span class="n">baseline_path</span><span class="p">)</span>
        <span class="n">comparison</span> <span class="o">=</span> <span class="n">DataFrame</span><span class="p">(</span><span class="n">columns</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;Output Name&#39;</span><span class="p">,</span><span class="s1">&#39;Baseline Value&#39;</span><span class="p">,</span><span class="s1">&#39;New Value&#39;</span><span class="p">,</span><span class="s1">&#39;Error&#39;</span><span class="p">,</span><span class="s1">&#39;Match&#39;</span><span class="p">])</span>
        <span class="c1">#This comparison df is what is written to the csv output file. The Output Name corresponds to the attribute name within the Mission, Journey, or Mission Event objects. Error is the absolute error </span>
        
        <span class="c1">#can I test the current mission? did it actually load anything? if not, return</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="nb">hasattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="s1">&#39;Journeys&#39;</span><span class="p">):</span>
            <span class="n">comparison</span> <span class="o">=</span> <span class="n">comparison</span><span class="o">.</span><span class="n">append</span><span class="p">({</span><span class="s1">&#39;Output Name&#39;</span> <span class="p">:</span> <span class="s1">&#39;No Journeys!&#39;</span><span class="p">,</span> <span class="s1">&#39;Match&#39;</span> <span class="p">:</span> <span class="kc">False</span><span class="p">},</span> <span class="n">ignore_index</span> <span class="o">=</span> <span class="kc">True</span><span class="p">)</span>
            <span class="n">comparison</span><span class="o">.</span><span class="n">to_csv</span><span class="p">(</span><span class="n">csv_file_name</span><span class="p">,</span> <span class="n">index</span> <span class="o">=</span> <span class="kc">False</span><span class="p">)</span>
            <span class="k">return</span> <span class="kc">False</span><span class="p">,</span> <span class="n">comparison</span>
			
        
        <span class="c1">#Make sure the number of journeys are the same between both cases (if they aren&#39;t then the missions are set up differently and a comparison is likely meaningless)</span>
        <span class="c1">#NOTE: The number of mission events may vary between solutions with the same journey structure so we worry about mission event mismatches later.</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">baseline</span><span class="o">.</span><span class="n">Journeys</span><span class="p">)</span> <span class="o">!=</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">Journeys</span><span class="p">):</span>
            <span class="n">comparison</span> <span class="o">=</span> <span class="n">comparison</span><span class="o">.</span><span class="n">append</span><span class="p">({</span><span class="s1">&#39;Output Name&#39;</span> <span class="p">:</span> <span class="s1">&#39;Journey Mismatch!&#39;</span><span class="p">,</span> <span class="s1">&#39;Match&#39;</span> <span class="p">:</span> <span class="kc">False</span><span class="p">},</span> <span class="n">ignore_index</span> <span class="o">=</span> <span class="kc">True</span><span class="p">)</span>
            <span class="n">comparison</span><span class="o">.</span><span class="n">to_csv</span><span class="p">(</span><span class="n">csv_file_name</span><span class="p">,</span> <span class="n">index</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
            <span class="k">return</span> <span class="kc">False</span><span class="p">,</span> <span class="n">comparison</span>

        <span class="c1">#Some attributes we will always want to ignore in our comparisons (and some of these, e.g. &#39;parent&#39;, appear at more than one Mission/Journey/MissionEvent level)</span>
        <span class="n">universal_ignore_list</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;user_data&#39;</span><span class="p">,</span> <span class="s1">&#39;Journeys&#39;</span><span class="p">,</span> <span class="s1">&#39;timeToCompletionOfBestSolutionAttempt&#39;</span><span class="p">,</span> <span class="s1">&#39;parent&#39;</span><span class="p">,</span> <span class="s1">&#39;missionevents&#39;</span><span class="p">]</span>
        <span class="c1">#NOTE: Do NOT specify the level (&#39;M.&#39;, &#39;J.&#39;, or &#39;E.&#39;) in this universal ignore list. They will be applied at all levels.</span>
        <span class="c1">#NOTE: &#39;Journeys&#39; and &#39;missionevents&#39; appearing in this list doesn&#39;t mean we&#39;re ignoring them, we will still iterate through all of them. We just don&#39;t want to compare the top-level Journey/missionevent objects.</span>

        
        <span class="c1">#Now extract the user-provided attributes_to_ignore and combine with the universal_ignore_list.</span>
        <span class="c1">#Need to have a per-level (Mission, Journey, etc.) list of attributes to ignore.</span>
        <span class="n">mission_attrs_to_ignore</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;M.&#39;</span> <span class="o">+</span> <span class="n">attr</span> <span class="k">for</span> <span class="n">attr</span> <span class="ow">in</span> <span class="n">universal_ignore_list</span><span class="p">]</span> <span class="o">+</span> <span class="p">[</span><span class="n">attr</span> <span class="k">for</span> <span class="n">attr</span> <span class="ow">in</span> <span class="n">attributes_to_ignore</span> <span class="k">if</span> <span class="n">attr</span><span class="o">.</span><span class="n">upper</span><span class="p">()</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s1">&#39;M.&#39;</span><span class="p">)]</span> <span class="c1">#using the upper command so the attributes_to_ignore user input can be case-insensitive</span>
        <span class="n">journey_attrs_to_ignore</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;J.&#39;</span> <span class="o">+</span> <span class="n">attr</span> <span class="k">for</span> <span class="n">attr</span> <span class="ow">in</span> <span class="n">universal_ignore_list</span><span class="p">]</span> <span class="o">+</span> <span class="p">[</span><span class="n">attr</span> <span class="k">for</span> <span class="n">attr</span> <span class="ow">in</span> <span class="n">attributes_to_ignore</span> <span class="k">if</span> <span class="n">attr</span><span class="o">.</span><span class="n">upper</span><span class="p">()</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s1">&#39;J.&#39;</span><span class="p">)]</span>
        <span class="n">mevent_attrs_to_ignore</span>  <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;E.&#39;</span> <span class="o">+</span> <span class="n">attr</span> <span class="k">for</span> <span class="n">attr</span> <span class="ow">in</span> <span class="n">universal_ignore_list</span><span class="p">]</span> <span class="o">+</span> <span class="p">[</span><span class="n">attr</span> <span class="k">for</span> <span class="n">attr</span> <span class="ow">in</span> <span class="n">attributes_to_ignore</span> <span class="k">if</span> <span class="n">attr</span><span class="o">.</span><span class="n">upper</span><span class="p">()</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s1">&#39;E.&#39;</span><span class="p">)]</span>
        
        
        <span class="c1">#Need a few temporary/intermediary variables to use while unpacking the mission data</span>
        <span class="n">pending_attrs</span> <span class="o">=</span> <span class="n">DataFrame</span><span class="p">(</span><span class="n">columns</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;attr&#39;</span><span class="p">,</span> <span class="s1">&#39;val&#39;</span><span class="p">,</span> <span class="s1">&#39;full_str&#39;</span><span class="p">])</span> <span class="c1">#only need one of these since we unpack one (baseline or new) at a time</span>
        <span class="n">number_attrs</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;baseline&#39;</span> <span class="p">:</span> <span class="p">[],</span> <span class="s1">&#39;new&#39;</span> <span class="p">:</span> <span class="p">[]}</span>
        <span class="n">str_attrs</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;baseline&#39;</span> <span class="p">:</span> <span class="p">[],</span> <span class="s1">&#39;new&#39;</span> <span class="p">:</span> <span class="p">[]}</span>
        
        
        <span class="c1">#Need a universal unpacking function</span>
        <span class="k">def</span> <span class="nf">unpackDef</span><span class="p">(</span><span class="n">owning_attr</span><span class="p">,</span> <span class="n">object_of_interest</span><span class="p">,</span> <span class="n">baseline_or_new</span><span class="p">,</span> <span class="n">level</span><span class="p">,</span> <span class="n">ranking</span><span class="p">,</span> <span class="n">full_attr_str</span><span class="p">):</span>

            <span class="k">nonlocal</span> <span class="n">pending_attrs</span><span class="p">,</span> <span class="n">number_attrs</span><span class="p">,</span> <span class="n">str_attrs</span>

            <span class="n">unpacked</span> <span class="o">=</span> <span class="p">[]</span>
            <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">object_of_interest</span><span class="p">,</span> <span class="n">Number</span><span class="p">):</span> <span class="c1">#NOTE: This will also catch nan values</span>
                <span class="n">number_attrs</span><span class="p">[</span><span class="n">baseline_or_new</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">({</span><span class="s1">&#39;attr&#39;</span> <span class="p">:</span> <span class="n">full_attr_str</span><span class="p">,</span> <span class="s1">&#39;val&#39;</span> <span class="p">:</span> <span class="n">object_of_interest</span><span class="p">,</span>
                                                      <span class="s1">&#39;attr_internal&#39;</span> <span class="p">:</span> <span class="n">level</span> <span class="o">+</span> <span class="n">owning_attr</span><span class="p">,</span> <span class="s1">&#39;rank&#39;</span> <span class="p">:</span> <span class="n">ranking</span><span class="p">})</span>
                <span class="k">return</span>

            <span class="k">elif</span> <span class="nb">type</span><span class="p">(</span><span class="n">object_of_interest</span><span class="p">)</span> <span class="o">==</span> <span class="nb">str</span><span class="p">:</span>
                <span class="n">str_attrs</span><span class="p">[</span><span class="n">baseline_or_new</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">({</span><span class="s1">&#39;attr&#39;</span> <span class="p">:</span> <span class="n">full_attr_str</span><span class="p">,</span> <span class="s1">&#39;val&#39;</span> <span class="p">:</span> <span class="n">object_of_interest</span><span class="p">,</span>
                                                   <span class="s1">&#39;attr_internal&#39;</span> <span class="p">:</span> <span class="n">level</span> <span class="o">+</span> <span class="n">owning_attr</span><span class="p">,</span> <span class="s1">&#39;rank&#39;</span> <span class="p">:</span> <span class="n">ranking</span><span class="p">})</span>
                <span class="k">return</span>

            <span class="k">elif</span> <span class="p">(</span><span class="nb">type</span><span class="p">(</span><span class="n">object_of_interest</span><span class="p">)</span> <span class="o">==</span> <span class="nb">list</span><span class="p">)</span> <span class="ow">or</span> <span class="p">(</span><span class="nb">type</span><span class="p">(</span><span class="n">object_of_interest</span><span class="p">)</span> <span class="o">==</span> <span class="nb">tuple</span><span class="p">):</span>
                <span class="k">for</span> <span class="p">(</span><span class="n">ix</span><span class="p">,</span> <span class="n">elem</span><span class="p">)</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">object_of_interest</span><span class="p">):</span>
                    <span class="n">unpacked</span><span class="o">.</span><span class="n">append</span><span class="p">({</span><span class="s1">&#39;attr&#39;</span> <span class="p">:</span> <span class="n">owning_attr</span><span class="p">,</span> <span class="s1">&#39;val&#39;</span> <span class="p">:</span> <span class="n">elem</span><span class="p">,</span> <span class="s1">&#39;full_str&#39;</span> <span class="p">:</span> <span class="n">full_attr_str</span> <span class="o">+</span> <span class="s1">&#39;[&#39;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">ix</span><span class="p">)</span> <span class="o">+</span> <span class="s1">&#39;]&#39;</span><span class="p">})</span>

            <span class="k">elif</span> <span class="nb">type</span><span class="p">(</span><span class="n">object_of_interest</span><span class="p">)</span> <span class="o">==</span> <span class="nb">dict</span><span class="p">:</span>
                <span class="k">for</span> <span class="n">key</span> <span class="ow">in</span> <span class="n">object_of_interest</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
                    <span class="n">unpacked</span><span class="o">.</span><span class="n">append</span><span class="p">({</span><span class="s1">&#39;attr&#39;</span> <span class="p">:</span> <span class="n">owning_attr</span><span class="p">,</span> <span class="s1">&#39;val&#39;</span> <span class="p">:</span> <span class="n">object_of_interest</span><span class="p">[</span><span class="n">key</span><span class="p">],</span>
                                     <span class="s1">&#39;full_str&#39;</span> <span class="p">:</span> <span class="n">full_attr_str</span>  <span class="o">+</span> <span class="s1">&#39;[&#39;</span> <span class="o">+</span> <span class="n">key</span> <span class="o">+</span> <span class="s1">&#39;]&#39;</span><span class="p">})</span>

            <span class="c1">#assuming that None values correspond to string attributes (using a blank string as the comparison value)</span>
            <span class="k">elif</span> <span class="n">object_of_interest</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                <span class="n">str_attrs</span><span class="p">[</span><span class="n">baseline_or_new</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">({</span><span class="s1">&#39;attr&#39;</span> <span class="p">:</span> <span class="n">full_attr_str</span><span class="p">,</span> <span class="s1">&#39;val&#39;</span> <span class="p">:</span> <span class="s1">&#39;&#39;</span><span class="p">,</span>
                                                   <span class="s1">&#39;attr_internal&#39;</span> <span class="p">:</span> <span class="n">level</span> <span class="o">+</span> <span class="n">owning_attr</span><span class="p">,</span> <span class="s1">&#39;rank&#39;</span> <span class="p">:</span> <span class="n">ranking</span><span class="p">})</span>

            <span class="c1">#otherwise, we&#39;re dealing with a custom class object</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">class_attr_dict</span> <span class="o">=</span> <span class="nb">vars</span><span class="p">(</span><span class="n">object_of_interest</span><span class="p">)</span>
                <span class="k">for</span> <span class="n">attr</span> <span class="ow">in</span> <span class="n">class_attr_dict</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
                    <span class="n">unpacked</span><span class="o">.</span><span class="n">append</span><span class="p">({</span><span class="s1">&#39;attr&#39;</span> <span class="p">:</span> <span class="n">attr</span><span class="p">,</span> <span class="s1">&#39;val&#39;</span> <span class="p">:</span> <span class="n">class_attr_dict</span><span class="p">[</span><span class="n">attr</span><span class="p">],</span> <span class="s1">&#39;full_str&#39;</span> <span class="p">:</span> <span class="n">full_attr_str</span> <span class="o">+</span> <span class="s1">&#39;.&#39;</span> <span class="o">+</span> <span class="n">attr</span><span class="p">})</span>

            <span class="n">unpacked</span> <span class="o">=</span> <span class="n">DataFrame</span><span class="p">(</span><span class="n">unpacked</span><span class="p">)</span>
            <span class="n">pending_attrs</span> <span class="o">=</span> <span class="n">concat</span><span class="p">([</span><span class="n">pending_attrs</span><span class="p">,</span> <span class="n">unpacked</span><span class="p">])</span>
            <span class="k">return</span>
        <span class="n">unpack</span> <span class="o">=</span> <span class="n">frompyfunc</span><span class="p">(</span><span class="n">unpackDef</span><span class="p">,</span> <span class="mi">6</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>
        
        <span class="c1">#Store all relevant mission values</span>
        <span class="n">baseline_mission_attributes</span> <span class="o">=</span> <span class="n">DataFrame</span><span class="p">(</span><span class="n">columns</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;attr&#39;</span><span class="p">,</span> <span class="s1">&#39;val&#39;</span><span class="p">,</span> <span class="s1">&#39;full_str&#39;</span><span class="p">])</span>
        <span class="n">new_mission_attributes</span> <span class="o">=</span> <span class="n">DataFrame</span><span class="p">(</span><span class="n">columns</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;attr&#39;</span><span class="p">,</span> <span class="s1">&#39;val&#39;</span><span class="p">,</span> <span class="s1">&#39;full_str&#39;</span><span class="p">])</span>

        <span class="c1">#Populate the baseline information</span>
        <span class="n">baseline_mission_attributes</span><span class="p">[</span><span class="s1">&#39;attr&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="nb">vars</span><span class="p">(</span><span class="n">baseline</span><span class="p">)</span><span class="o">.</span><span class="n">keys</span><span class="p">()</span>
        <span class="n">baseline_mission_attributes</span><span class="p">[</span><span class="s1">&#39;val&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="nb">vars</span><span class="p">(</span><span class="n">baseline</span><span class="p">)</span><span class="o">.</span><span class="n">values</span><span class="p">()</span>
        <span class="n">baseline_mission_attributes</span><span class="p">[</span><span class="s1">&#39;full_str&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;Mission.&#39;</span> <span class="o">+</span> <span class="n">baseline_mission_attributes</span><span class="p">[</span><span class="s1">&#39;attr&#39;</span><span class="p">]</span>

        <span class="c1">#The following line is a little long but performing this step in 1 line instead of multiple is a significant enough performance improvement</span>
        <span class="c1"># to be worth the decreased readability. All this line is doing is filtering out the attributes we wish to ignore.</span>
        <span class="n">baseline_mission_attributes</span> <span class="o">=</span> <span class="n">baseline_mission_attributes</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="o">~</span><span class="p">(</span><span class="s1">&#39;M.&#39;</span> <span class="o">+</span> <span class="n">baseline_mission_attributes</span><span class="p">[</span><span class="s1">&#39;attr&#39;</span><span class="p">])</span><span class="o">.</span><span class="n">isin</span><span class="p">(</span><span class="n">mission_attrs_to_ignore</span><span class="p">)]</span>

        <span class="c1">#Now populate our own information</span>
        <span class="n">new_mission_attributes</span><span class="p">[</span><span class="s1">&#39;attr&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="nb">vars</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="n">keys</span><span class="p">()</span>
        <span class="n">new_mission_attributes</span><span class="p">[</span><span class="s1">&#39;val&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="nb">vars</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="n">values</span><span class="p">()</span>
        <span class="n">new_mission_attributes</span><span class="p">[</span><span class="s1">&#39;full_str&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;Mission.&#39;</span> <span class="o">+</span> <span class="n">new_mission_attributes</span><span class="p">[</span><span class="s1">&#39;attr&#39;</span><span class="p">]</span>

        <span class="n">new_mission_attributes</span> <span class="o">=</span> <span class="n">new_mission_attributes</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="o">~</span><span class="p">(</span><span class="s1">&#39;M.&#39;</span> <span class="o">+</span> <span class="n">new_mission_attributes</span><span class="p">[</span><span class="s1">&#39;attr&#39;</span><span class="p">])</span><span class="o">.</span><span class="n">isin</span><span class="p">(</span><span class="n">mission_attrs_to_ignore</span><span class="p">)]</span>

        
        <span class="c1">#Now we need to unpack the mission_attributes dataframes into their numeric and string components</span>
        <span class="c1">#Start with unpacking the baseline data</span>
        <span class="n">unpack</span><span class="p">(</span><span class="n">baseline_mission_attributes</span><span class="p">[</span><span class="s1">&#39;attr&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">values</span><span class="p">,</span> <span class="n">baseline_mission_attributes</span><span class="p">[</span><span class="s1">&#39;val&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">values</span><span class="p">,</span> <span class="s1">&#39;baseline&#39;</span><span class="p">,</span>
               <span class="s1">&#39;M.&#39;</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="n">baseline_mission_attributes</span><span class="p">[</span><span class="s1">&#39;full_str&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">values</span><span class="p">)</span>
        <span class="c1">#NOTE: If there were nothing but strings and numbers, we would already be done. However, there are also lists, dictionaries,</span>
        <span class="c1">#       and custom class objects to unpack. These were stored in the pending_attrs dataframe in the unpack function.</span>
        <span class="c1">#       We now need to recursively step through the levels in the data structure until all the data has been unpacked.</span>
        <span class="k">while</span> <span class="nb">len</span><span class="p">(</span><span class="n">pending_attrs</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
            <span class="n">current_attrs</span> <span class="o">=</span> <span class="n">pending_attrs</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
            <span class="n">pending_attrs</span> <span class="o">=</span> <span class="n">DataFrame</span><span class="p">(</span><span class="n">columns</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;attr&#39;</span><span class="p">,</span> <span class="s1">&#39;val&#39;</span><span class="p">,</span> <span class="s1">&#39;full_str&#39;</span><span class="p">])</span>

            <span class="n">unpack</span><span class="p">(</span><span class="n">current_attrs</span><span class="p">[</span><span class="s1">&#39;attr&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">values</span><span class="p">,</span> <span class="n">current_attrs</span><span class="p">[</span><span class="s1">&#39;val&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">values</span><span class="p">,</span> <span class="s1">&#39;baseline&#39;</span><span class="p">,</span> <span class="s1">&#39;M.&#39;</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="n">current_attrs</span><span class="p">[</span><span class="s1">&#39;full_str&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">values</span><span class="p">)</span>

        <span class="c1">#Now repeat the process for our own data</span>
        <span class="n">unpack</span><span class="p">(</span><span class="n">new_mission_attributes</span><span class="p">[</span><span class="s1">&#39;attr&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">values</span><span class="p">,</span> <span class="n">new_mission_attributes</span><span class="p">[</span><span class="s1">&#39;val&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">values</span><span class="p">,</span> <span class="s1">&#39;new&#39;</span><span class="p">,</span> <span class="s1">&#39;M.&#39;</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span>
               <span class="n">new_mission_attributes</span><span class="p">[</span><span class="s1">&#39;full_str&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">values</span><span class="p">)</span>
        <span class="k">while</span> <span class="nb">len</span><span class="p">(</span><span class="n">pending_attrs</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
            <span class="n">current_attrs</span> <span class="o">=</span> <span class="n">pending_attrs</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
            <span class="n">pending_attrs</span> <span class="o">=</span> <span class="n">DataFrame</span><span class="p">(</span><span class="n">columns</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;attr&#39;</span><span class="p">,</span> <span class="s1">&#39;val&#39;</span><span class="p">,</span> <span class="s1">&#39;full_str&#39;</span><span class="p">])</span>

            <span class="n">unpack</span><span class="p">(</span><span class="n">current_attrs</span><span class="p">[</span><span class="s1">&#39;attr&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">values</span><span class="p">,</span> <span class="n">current_attrs</span><span class="p">[</span><span class="s1">&#39;val&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">values</span><span class="p">,</span> <span class="s1">&#39;new&#39;</span><span class="p">,</span> <span class="s1">&#39;M.&#39;</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="n">current_attrs</span><span class="p">[</span><span class="s1">&#39;full_str&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">values</span><span class="p">)</span>


        <span class="c1">#now we need to unpack the Journey &amp; MissionEvent Data</span>
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">baseline</span><span class="o">.</span><span class="n">Journeys</span><span class="p">)):</span>
            <span class="n">journey_str</span> <span class="o">=</span> <span class="s1">&#39;Mission.Journey[&#39;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">i</span><span class="p">)</span> <span class="o">+</span> <span class="s1">&#39;].&#39;</span>

            <span class="n">baseline_journey_attributes</span> <span class="o">=</span> <span class="n">DataFrame</span><span class="p">(</span><span class="n">columns</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;attr&#39;</span><span class="p">,</span> <span class="s1">&#39;val&#39;</span><span class="p">,</span> <span class="s1">&#39;full_str&#39;</span><span class="p">])</span>
            <span class="n">new_journey_attributes</span> <span class="o">=</span> <span class="n">DataFrame</span><span class="p">(</span><span class="n">columns</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;attr&#39;</span><span class="p">,</span> <span class="s1">&#39;val&#39;</span><span class="p">,</span> <span class="s1">&#39;full_str&#39;</span><span class="p">])</span>

            <span class="n">baseline_journey_attributes</span><span class="p">[</span><span class="s1">&#39;attr&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="nb">vars</span><span class="p">(</span><span class="n">baseline</span><span class="o">.</span><span class="n">Journeys</span><span class="p">[</span><span class="n">i</span><span class="p">])</span><span class="o">.</span><span class="n">keys</span><span class="p">()</span>
            <span class="n">baseline_journey_attributes</span><span class="p">[</span><span class="s1">&#39;val&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="nb">vars</span><span class="p">(</span><span class="n">baseline</span><span class="o">.</span><span class="n">Journeys</span><span class="p">[</span><span class="n">i</span><span class="p">])</span><span class="o">.</span><span class="n">values</span><span class="p">()</span>
            <span class="c1">#NOTE: The full string is no longer just a copy of the &#39;attr&#39; columns. We need to know which Journey each value</span>
            <span class="c1">#       belongs to.</span>
            <span class="n">baseline_journey_attributes</span><span class="p">[</span><span class="s1">&#39;full_str&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">journey_str</span> <span class="o">+</span> <span class="n">baseline_journey_attributes</span><span class="p">[</span><span class="s1">&#39;attr&#39;</span><span class="p">]</span>

            <span class="n">new_journey_attributes</span><span class="p">[</span><span class="s1">&#39;attr&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="nb">vars</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">Journeys</span><span class="p">[</span><span class="n">i</span><span class="p">])</span><span class="o">.</span><span class="n">keys</span><span class="p">()</span>
            <span class="n">new_journey_attributes</span><span class="p">[</span><span class="s1">&#39;val&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="nb">vars</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">Journeys</span><span class="p">[</span><span class="n">i</span><span class="p">])</span><span class="o">.</span><span class="n">values</span><span class="p">()</span>
            <span class="n">new_journey_attributes</span><span class="p">[</span><span class="s1">&#39;full_str&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">journey_str</span> <span class="o">+</span> <span class="n">new_journey_attributes</span><span class="p">[</span><span class="s1">&#39;attr&#39;</span><span class="p">]</span>

            <span class="n">baseline_journey_attributes</span> <span class="o">=</span> <span class="n">baseline_journey_attributes</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="o">~</span><span class="p">(</span><span class="s1">&#39;J.&#39;</span> <span class="o">+</span> <span class="n">baseline_journey_attributes</span><span class="p">[</span><span class="s1">&#39;attr&#39;</span><span class="p">])</span><span class="o">.</span><span class="n">isin</span><span class="p">(</span><span class="n">journey_attrs_to_ignore</span><span class="p">)]</span>
            <span class="n">new_journey_attributes</span> <span class="o">=</span> <span class="n">new_journey_attributes</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="o">~</span><span class="p">(</span><span class="s1">&#39;J.&#39;</span> <span class="o">+</span> <span class="n">new_journey_attributes</span><span class="p">[</span><span class="s1">&#39;attr&#39;</span><span class="p">])</span><span class="o">.</span><span class="n">isin</span><span class="p">(</span><span class="n">journey_attrs_to_ignore</span><span class="p">)]</span>

            <span class="n">unpack</span><span class="p">(</span><span class="n">baseline_journey_attributes</span><span class="p">[</span><span class="s1">&#39;attr&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">values</span><span class="p">,</span> <span class="n">baseline_journey_attributes</span><span class="p">[</span><span class="s1">&#39;val&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">values</span><span class="p">,</span> <span class="s1">&#39;baseline&#39;</span><span class="p">,</span> <span class="s1">&#39;J.&#39;</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span>
                   <span class="n">baseline_journey_attributes</span><span class="p">[</span><span class="s1">&#39;full_str&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">values</span><span class="p">)</span>
            <span class="k">while</span> <span class="nb">len</span><span class="p">(</span><span class="n">pending_attrs</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
                <span class="n">current_attrs</span> <span class="o">=</span> <span class="n">pending_attrs</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
                <span class="n">pending_attrs</span> <span class="o">=</span> <span class="n">DataFrame</span><span class="p">(</span><span class="n">columns</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;attr&#39;</span><span class="p">,</span> <span class="s1">&#39;val&#39;</span><span class="p">,</span> <span class="s1">&#39;full_str&#39;</span><span class="p">])</span>

                <span class="n">unpack</span><span class="p">(</span><span class="n">current_attrs</span><span class="p">[</span><span class="s1">&#39;attr&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">values</span><span class="p">,</span> <span class="n">current_attrs</span><span class="p">[</span><span class="s1">&#39;val&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">values</span><span class="p">,</span> <span class="s1">&#39;baseline&#39;</span><span class="p">,</span> <span class="s1">&#39;J.&#39;</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="n">current_attrs</span><span class="p">[</span><span class="s1">&#39;full_str&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">values</span><span class="p">)</span>

            <span class="n">unpack</span><span class="p">(</span><span class="n">new_journey_attributes</span><span class="p">[</span><span class="s1">&#39;attr&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">values</span><span class="p">,</span> <span class="n">new_journey_attributes</span><span class="p">[</span><span class="s1">&#39;val&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">values</span><span class="p">,</span> <span class="s1">&#39;new&#39;</span><span class="p">,</span> <span class="s1">&#39;J.&#39;</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span>
                   <span class="n">new_journey_attributes</span><span class="p">[</span><span class="s1">&#39;full_str&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">values</span><span class="p">)</span>
            <span class="k">while</span> <span class="nb">len</span><span class="p">(</span><span class="n">pending_attrs</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
                <span class="n">current_attrs</span> <span class="o">=</span> <span class="n">pending_attrs</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
                <span class="n">pending_attrs</span> <span class="o">=</span> <span class="n">DataFrame</span><span class="p">(</span><span class="n">columns</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;attr&#39;</span><span class="p">,</span> <span class="s1">&#39;val&#39;</span><span class="p">,</span> <span class="s1">&#39;full_str&#39;</span><span class="p">])</span>

                <span class="n">unpack</span><span class="p">(</span><span class="n">current_attrs</span><span class="p">[</span><span class="s1">&#39;attr&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">values</span><span class="p">,</span> <span class="n">current_attrs</span><span class="p">[</span><span class="s1">&#39;val&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">values</span><span class="p">,</span> <span class="s1">&#39;new&#39;</span><span class="p">,</span> <span class="s1">&#39;J.&#39;</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="n">current_attrs</span><span class="p">[</span><span class="s1">&#39;full_str&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">values</span><span class="p">)</span>

            <span class="c1">#repeat for the mission events</span>
            <span class="c1"># first we need to check if the number of mission events match between cases</span>
            <span class="n">n_baseline_mevents</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">baseline</span><span class="o">.</span><span class="n">Journeys</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">missionevents</span><span class="p">)</span>
            <span class="n">n_new_mevents</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">Journeys</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">missionevents</span><span class="p">)</span>

            <span class="n">n_mevents</span> <span class="o">=</span> <span class="n">n_baseline_mevents</span>
            <span class="k">if</span> <span class="p">(</span><span class="n">n_baseline_mevents</span> <span class="o">!=</span> <span class="n">n_new_mevents</span><span class="p">):</span>
                <span class="n">comparison</span> <span class="o">=</span> <span class="n">comparison</span><span class="o">.</span><span class="n">append</span><span class="p">({</span><span class="s1">&#39;Output Name&#39;</span><span class="p">:</span> <span class="s1">&#39;Journey[&#39;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">i</span><span class="p">)</span> <span class="o">+</span> <span class="s1">&#39;] MissionEvent Mismatch&#39;</span><span class="p">,</span>
                                                <span class="s1">&#39;Baseline Value&#39;</span><span class="p">:</span> <span class="n">n_baseline_mevents</span><span class="p">,</span> <span class="s1">&#39;New Value&#39;</span><span class="p">:</span> <span class="n">n_new_mevents</span><span class="p">,</span>
                                                <span class="s1">&#39;Error&#39;</span><span class="p">:</span> <span class="nb">abs</span><span class="p">(</span><span class="n">n_new_mevents</span> <span class="o">-</span> <span class="n">n_baseline_mevents</span><span class="p">),</span> <span class="s1">&#39;Match&#39;</span><span class="p">:</span> <span class="kc">False</span><span class="p">})</span>
                <span class="n">n_mevents</span> <span class="o">=</span> <span class="nb">min</span><span class="p">([</span><span class="n">n_baseline_mevents</span><span class="p">,</span> <span class="n">n_new_mevents</span><span class="p">])</span>

            <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">n_mevents</span><span class="p">):</span>
                <span class="n">mevent_str</span> <span class="o">=</span> <span class="n">journey_str</span> <span class="o">+</span> <span class="s1">&#39;MissionEvent[&#39;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">j</span><span class="p">)</span> <span class="o">+</span> <span class="s1">&#39;].&#39;</span>

                <span class="n">baseline_mevent_attributes</span> <span class="o">=</span> <span class="n">DataFrame</span><span class="p">(</span><span class="n">columns</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;attr&#39;</span><span class="p">,</span> <span class="s1">&#39;val&#39;</span><span class="p">,</span> <span class="s1">&#39;full_str&#39;</span><span class="p">])</span>
                <span class="n">new_mevent_attributes</span> <span class="o">=</span> <span class="n">DataFrame</span><span class="p">(</span><span class="n">columns</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;attr&#39;</span><span class="p">,</span> <span class="s1">&#39;val&#39;</span><span class="p">,</span> <span class="s1">&#39;full_str&#39;</span><span class="p">])</span>

                <span class="n">baseline_mevent_attributes</span><span class="p">[</span><span class="s1">&#39;attr&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="nb">vars</span><span class="p">(</span><span class="n">baseline</span><span class="o">.</span><span class="n">Journeys</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">missionevents</span><span class="p">[</span><span class="n">j</span><span class="p">])</span><span class="o">.</span><span class="n">keys</span><span class="p">()</span>
                <span class="n">baseline_mevent_attributes</span><span class="p">[</span><span class="s1">&#39;val&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="nb">vars</span><span class="p">(</span><span class="n">baseline</span><span class="o">.</span><span class="n">Journeys</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">missionevents</span><span class="p">[</span><span class="n">j</span><span class="p">])</span><span class="o">.</span><span class="n">values</span><span class="p">()</span>
                <span class="n">baseline_mevent_attributes</span><span class="p">[</span><span class="s1">&#39;full_str&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">mevent_str</span> <span class="o">+</span> <span class="n">baseline_mevent_attributes</span><span class="p">[</span><span class="s1">&#39;attr&#39;</span><span class="p">]</span>
                <span class="c1">#need to make sure ThrottleLevel is handled as a string. First need to know where it is in the df.</span>
                <span class="n">throttle_level_ix</span> <span class="o">=</span> <span class="n">baseline_mevent_attributes</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">baseline_mevent_attributes</span><span class="p">[</span><span class="s1">&#39;attr&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="s1">&#39;ThrottleLevel&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">index</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
                <span class="c1">#now convert it to a string (and replace &quot;0&quot; with &quot;-&quot; because, reasons)</span>
                <span class="n">baseline_mevent_attributes</span><span class="o">.</span><span class="n">at</span><span class="p">[</span><span class="n">throttle_level_ix</span><span class="p">,</span> <span class="s1">&#39;val&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="n">baseline_mevent_attributes</span><span class="o">.</span><span class="n">at</span><span class="p">[</span><span class="n">throttle_level_ix</span><span class="p">,</span> <span class="s1">&#39;val&#39;</span><span class="p">])</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s1">&#39;0.0&#39;</span><span class="p">,</span> <span class="s1">&#39;-&#39;</span><span class="p">)</span>
                
                <span class="n">new_mevent_attributes</span><span class="p">[</span><span class="s1">&#39;attr&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="nb">vars</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">Journeys</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">missionevents</span><span class="p">[</span><span class="n">j</span><span class="p">])</span><span class="o">.</span><span class="n">keys</span><span class="p">()</span>
                <span class="n">new_mevent_attributes</span><span class="p">[</span><span class="s1">&#39;val&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="nb">vars</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">Journeys</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">missionevents</span><span class="p">[</span><span class="n">j</span><span class="p">])</span><span class="o">.</span><span class="n">values</span><span class="p">()</span>
                <span class="n">new_mevent_attributes</span><span class="p">[</span><span class="s1">&#39;full_str&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">mevent_str</span> <span class="o">+</span> <span class="n">new_mevent_attributes</span><span class="p">[</span><span class="s1">&#39;attr&#39;</span><span class="p">]</span>
                <span class="n">throttle_level_ix</span> <span class="o">=</span> <span class="n">new_mevent_attributes</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">new_mevent_attributes</span><span class="p">[</span><span class="s1">&#39;attr&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="s1">&#39;ThrottleLevel&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">index</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
                <span class="n">new_mevent_attributes</span><span class="o">.</span><span class="n">at</span><span class="p">[</span><span class="n">throttle_level_ix</span><span class="p">,</span> <span class="s1">&#39;val&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="n">new_mevent_attributes</span><span class="o">.</span><span class="n">at</span><span class="p">[</span><span class="n">throttle_level_ix</span><span class="p">,</span> <span class="s1">&#39;val&#39;</span><span class="p">])</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s1">&#39;0.0&#39;</span><span class="p">,</span> <span class="s1">&#39;-&#39;</span><span class="p">)</span>

                <span class="n">baseline_mevent_attributes</span> <span class="o">=</span> <span class="n">baseline_mevent_attributes</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="o">~</span><span class="p">(</span><span class="s1">&#39;E.&#39;</span> <span class="o">+</span> <span class="n">baseline_mevent_attributes</span><span class="p">[</span><span class="s1">&#39;attr&#39;</span><span class="p">])</span><span class="o">.</span><span class="n">isin</span><span class="p">(</span><span class="n">mevent_attrs_to_ignore</span><span class="p">)]</span>
                <span class="n">new_mevent_attributes</span> <span class="o">=</span> <span class="n">new_mevent_attributes</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="o">~</span><span class="p">(</span><span class="s1">&#39;E.&#39;</span> <span class="o">+</span> <span class="n">new_mevent_attributes</span><span class="p">[</span><span class="s1">&#39;attr&#39;</span><span class="p">])</span><span class="o">.</span><span class="n">isin</span><span class="p">(</span><span class="n">mevent_attrs_to_ignore</span><span class="p">)]</span>

                <span class="n">unpack</span><span class="p">(</span><span class="n">baseline_mevent_attributes</span><span class="p">[</span><span class="s1">&#39;attr&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">values</span><span class="p">,</span> <span class="n">baseline_mevent_attributes</span><span class="p">[</span><span class="s1">&#39;val&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">values</span><span class="p">,</span> <span class="s1">&#39;baseline&#39;</span><span class="p">,</span> <span class="s1">&#39;E.&#39;</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span>
                       <span class="n">baseline_mevent_attributes</span><span class="p">[</span><span class="s1">&#39;full_str&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">values</span><span class="p">)</span>
                <span class="k">while</span> <span class="nb">len</span><span class="p">(</span><span class="n">pending_attrs</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
                    <span class="n">current_attrs</span> <span class="o">=</span> <span class="n">pending_attrs</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
                    <span class="n">pending_attrs</span> <span class="o">=</span> <span class="n">DataFrame</span><span class="p">(</span><span class="n">columns</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;attr&#39;</span><span class="p">,</span> <span class="s1">&#39;val&#39;</span><span class="p">,</span> <span class="s1">&#39;full_str&#39;</span><span class="p">])</span>

                    <span class="n">unpack</span><span class="p">(</span><span class="n">current_attrs</span><span class="p">[</span><span class="s1">&#39;attr&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">values</span><span class="p">,</span> <span class="n">current_attrs</span><span class="p">[</span><span class="s1">&#39;val&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">values</span><span class="p">,</span> <span class="s1">&#39;baseline&#39;</span><span class="p">,</span> <span class="s1">&#39;E.&#39;</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="n">current_attrs</span><span class="p">[</span><span class="s1">&#39;full_str&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">values</span><span class="p">)</span>

                <span class="n">unpack</span><span class="p">(</span><span class="n">new_mevent_attributes</span><span class="p">[</span><span class="s1">&#39;attr&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">values</span><span class="p">,</span> <span class="n">new_mevent_attributes</span><span class="p">[</span><span class="s1">&#39;val&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">values</span><span class="p">,</span> <span class="s1">&#39;new&#39;</span><span class="p">,</span> <span class="s1">&#39;E.&#39;</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span>
                       <span class="n">new_mevent_attributes</span><span class="p">[</span><span class="s1">&#39;full_str&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">values</span><span class="p">)</span>
                <span class="k">while</span> <span class="nb">len</span><span class="p">(</span><span class="n">pending_attrs</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
                    <span class="n">current_attrs</span> <span class="o">=</span> <span class="n">pending_attrs</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
                    <span class="n">pending_attrs</span> <span class="o">=</span> <span class="n">DataFrame</span><span class="p">(</span><span class="n">columns</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;attr&#39;</span><span class="p">,</span> <span class="s1">&#39;val&#39;</span><span class="p">,</span> <span class="s1">&#39;full_str&#39;</span><span class="p">])</span>

                    <span class="n">unpack</span><span class="p">(</span><span class="n">current_attrs</span><span class="p">[</span><span class="s1">&#39;attr&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">values</span><span class="p">,</span> <span class="n">current_attrs</span><span class="p">[</span><span class="s1">&#39;val&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">values</span><span class="p">,</span> <span class="s1">&#39;new&#39;</span><span class="p">,</span> <span class="s1">&#39;E.&#39;</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="n">current_attrs</span><span class="p">[</span><span class="s1">&#39;full_str&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">values</span><span class="p">)</span>

        
        <span class="c1">#Convert the numerical and string data in number_attrs &amp; str_attrs into dataframes</span>
        <span class="n">baseline_numbers</span> <span class="o">=</span> <span class="n">DataFrame</span><span class="p">(</span><span class="n">number_attrs</span><span class="p">[</span><span class="s1">&#39;baseline&#39;</span><span class="p">])</span>
        <span class="n">baseline_numbers</span><span class="o">.</span><span class="n">rename</span><span class="p">({</span><span class="s1">&#39;val&#39;</span> <span class="p">:</span> <span class="s1">&#39;Baseline Value&#39;</span><span class="p">},</span> <span class="n">axis</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span> <span class="n">inplace</span> <span class="o">=</span> <span class="kc">True</span><span class="p">)</span> <span class="c1">#need to rename these columns for when we merge the baseline + new dfs</span>

        <span class="n">baseline_strs</span> <span class="o">=</span> <span class="n">DataFrame</span><span class="p">(</span><span class="n">str_attrs</span><span class="p">[</span><span class="s1">&#39;baseline&#39;</span><span class="p">])</span>
        <span class="n">baseline_strs</span><span class="o">.</span><span class="n">rename</span><span class="p">({</span><span class="s1">&#39;val&#39;</span> <span class="p">:</span> <span class="s1">&#39;Baseline Value&#39;</span><span class="p">},</span> <span class="n">axis</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span> <span class="n">inplace</span> <span class="o">=</span> <span class="kc">True</span><span class="p">)</span>

        <span class="n">new_numbers</span> <span class="o">=</span> <span class="n">DataFrame</span><span class="p">(</span><span class="n">number_attrs</span><span class="p">[</span><span class="s1">&#39;new&#39;</span><span class="p">])</span>
        <span class="n">new_numbers</span><span class="o">.</span><span class="n">rename</span><span class="p">({</span><span class="s1">&#39;val&#39;</span> <span class="p">:</span> <span class="s1">&#39;New Value&#39;</span><span class="p">},</span> <span class="n">axis</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span> <span class="n">inplace</span> <span class="o">=</span> <span class="kc">True</span><span class="p">)</span>

        <span class="n">new_strs</span> <span class="o">=</span> <span class="n">DataFrame</span><span class="p">(</span><span class="n">str_attrs</span><span class="p">[</span><span class="s1">&#39;baseline&#39;</span><span class="p">])</span>
        <span class="n">new_strs</span><span class="o">.</span><span class="n">rename</span><span class="p">({</span><span class="s1">&#39;val&#39;</span> <span class="p">:</span> <span class="s1">&#39;New Value&#39;</span><span class="p">},</span> <span class="n">axis</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span> <span class="n">inplace</span> <span class="o">=</span> <span class="kc">True</span><span class="p">)</span>
        
            
        <span class="c1">#We can now work out if any attributes appear in only 1 mission/journey/missionevent object and not the other, but don&#39;t</span>
        <span class="c1"># want to use any of the existing columns to compare. We want to have a per-journey, per-missionevent comparison so we</span>
        <span class="c1"># can&#39;t use the attr_internal column as is. We also don&#39;t want to be comparing each individual element/entry of a list/dict so</span>
        <span class="c1"># we can&#39;t use the &#39;attr&#39; column as is. For example, let&#39;s look at the Journey[0] boundary constraints. If one of the mission</span>
        <span class="c1"># objects is missing this particular attribute for Journey[0], we don&#39;t want to see:</span>
        <span class="c1">#     &quot;Missing Mission.Journey[0].boundary_state[0][0], Mission.Journey[0].boundary_states[0][1], ... , Mission.Journey[0].boundary_states[1][5]</span>
        <span class="c1"># in the comparatron output. We want instead want to see:</span>
        <span class="c1">#    &quot;Missing Mission.Journey[0].boundary_state</span>
        <span class="c1"># We&#39;ll have to perform a couple string operations to get the desired values.</span>
        <span class="n">baseline_numbers</span><span class="p">[</span><span class="s1">&#39;for_compare&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">baseline_numbers</span><span class="p">[</span><span class="s1">&#39;attr&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">str</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;.&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">str</span><span class="p">[:</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">str</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="s1">&#39;.&#39;</span><span class="p">)</span> <span class="o">+</span> <span class="s1">&#39;.&#39;</span> <span class="o">+</span> <span class="n">baseline_numbers</span><span class="p">[</span><span class="s1">&#39;attr_internal&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">str</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;.&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">str</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
        <span class="n">baseline_strs</span><span class="p">[</span><span class="s1">&#39;for_compare&#39;</span><span class="p">]</span>    <span class="o">=</span> <span class="n">baseline_strs</span><span class="p">[</span><span class="s1">&#39;attr&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">str</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;.&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">str</span><span class="p">[:</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">str</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="s1">&#39;.&#39;</span><span class="p">)</span> <span class="o">+</span> <span class="s1">&#39;.&#39;</span> <span class="o">+</span> <span class="n">baseline_strs</span><span class="p">[</span><span class="s1">&#39;attr_internal&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">str</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;.&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">str</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>

        <span class="n">new_numbers</span><span class="p">[</span><span class="s1">&#39;for_compare&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">new_numbers</span><span class="p">[</span><span class="s1">&#39;attr&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">str</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;.&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">str</span><span class="p">[:</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">str</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="s1">&#39;.&#39;</span><span class="p">)</span> <span class="o">+</span> <span class="s1">&#39;.&#39;</span> <span class="o">+</span> <span class="n">new_numbers</span><span class="p">[</span><span class="s1">&#39;attr_internal&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">str</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;.&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">str</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
        <span class="n">new_strs</span><span class="p">[</span><span class="s1">&#39;for_compare&#39;</span><span class="p">]</span>    <span class="o">=</span> <span class="n">new_strs</span><span class="p">[</span><span class="s1">&#39;attr&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">str</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;.&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">str</span><span class="p">[:</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">str</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="s1">&#39;.&#39;</span><span class="p">)</span> <span class="o">+</span> <span class="s1">&#39;.&#39;</span> <span class="o">+</span> <span class="n">new_strs</span><span class="p">[</span><span class="s1">&#39;attr_internal&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">str</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;.&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">str</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>

        <span class="c1">#Now we can pull the unique values for each string in the new &#39;for_compare&#39; columns.</span>
        <span class="n">baseline_numerical_attrs</span> <span class="o">=</span> <span class="n">baseline_numbers</span><span class="p">[</span><span class="s1">&#39;for_compare&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">unique</span><span class="p">()</span>
        <span class="n">baseline_string_attrs</span>    <span class="o">=</span> <span class="n">baseline_strs</span><span class="p">[</span><span class="s1">&#39;for_compare&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">unique</span><span class="p">()</span>

        <span class="n">new_numerical_attrs</span> <span class="o">=</span> <span class="n">new_numbers</span><span class="p">[</span><span class="s1">&#39;for_compare&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">unique</span><span class="p">()</span>
        <span class="n">new_string_attrs</span>    <span class="o">=</span> <span class="n">new_strs</span><span class="p">[</span><span class="s1">&#39;for_compare&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">unique</span><span class="p">()</span>

        <span class="c1">#And use these strings to identify missing attributes</span>
        <span class="n">attrs_only_in_baseline</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="nb">set</span><span class="p">(</span><span class="n">baseline_numerical_attrs</span><span class="p">)</span> <span class="o">-</span> <span class="nb">set</span><span class="p">(</span><span class="n">new_numerical_attrs</span><span class="p">))</span> <span class="o">+</span> <span class="nb">list</span><span class="p">(</span><span class="nb">set</span><span class="p">(</span><span class="n">baseline_string_attrs</span><span class="p">)</span> <span class="o">-</span> <span class="nb">set</span><span class="p">(</span><span class="n">new_string_attrs</span><span class="p">))</span>
        <span class="n">attrs_only_in_new</span>      <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="nb">set</span><span class="p">(</span><span class="n">new_numerical_attrs</span><span class="p">)</span> <span class="o">-</span> <span class="nb">set</span><span class="p">(</span><span class="n">baseline_numerical_attrs</span><span class="p">))</span> <span class="o">+</span> <span class="nb">list</span><span class="p">(</span><span class="nb">set</span><span class="p">(</span><span class="n">new_string_attrs</span><span class="p">)</span> <span class="o">-</span> <span class="nb">set</span><span class="p">(</span><span class="n">baseline_string_attrs</span><span class="p">))</span>
        <span class="n">attr_check</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">attrs_only_in_baseline</span><span class="p">)</span> <span class="o">+</span> <span class="nb">len</span><span class="p">(</span><span class="n">attrs_only_in_new</span><span class="p">)</span>

        <span class="c1">#Now change gears. Need to know the correct tolerance values to use for each attribute in the numerical data.</span>
        <span class="c1">#First we need to work out what (unique) attributes are shared between the baseline and new data sets (want to use the</span>
        <span class="c1"># &#39;attr_internal&#39; columns for this since we don&#39;t have per-journey or per-missionevent custom tolerances).</span>
        <span class="c1">#Can pull the unique values by using the df[&#39;column&#39;].unique() function. By converting the unique column values into sets,</span>
        <span class="c1"># we can use python&#39;s intersection() function to determine the shared attributes between baseline and new.</span>
        <span class="n">numerical_attributes</span> <span class="o">=</span> <span class="nb">set</span><span class="p">(</span><span class="n">baseline_numbers</span><span class="p">[</span><span class="s1">&#39;attr_internal&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">unique</span><span class="p">())</span><span class="o">.</span><span class="n">intersection</span><span class="p">(</span><span class="nb">set</span><span class="p">(</span><span class="n">new_numbers</span><span class="p">[</span><span class="s1">&#39;attr_internal&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">unique</span><span class="p">()))</span>

        <span class="c1">#Then create a default dictionary that assigns the default tolerance to all numerical attributes.</span>
        <span class="n">default_tolerance_dict</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">(</span><span class="nb">zip</span><span class="p">(</span><span class="n">numerical_attributes</span><span class="p">,</span> <span class="p">[</span><span class="n">default_tolerance</span><span class="p">]</span><span class="o">*</span><span class="nb">len</span><span class="p">(</span><span class="n">numerical_attributes</span><span class="p">)))</span>

        <span class="c1">#And merge in the user-provided, per-attribute tolerance values</span>
        <span class="n">all_tolerances</span> <span class="o">=</span> <span class="p">{</span><span class="o">**</span><span class="n">default_tolerance_dict</span><span class="p">,</span> <span class="o">**</span><span class="n">tolerance_dict</span><span class="p">}</span>
        <span class="c1">#^Any attributes that appear in tolerance_dict will overwrite the defaults when they are merged.</span>
        <span class="c1">#This dictionary will get mapped to our combined (baseline + new) dataframe of numerical data.</span>


        <span class="c1">#Now ready to merge baseline data with new data into combined dataframes (1 df for numerical data, 1 df for strings)</span>
        <span class="c1">#Start with the numerical df. Using an inner join so that only attributes that appear in both baseline and new are kept.</span>
        <span class="n">numbers_df</span> <span class="o">=</span> <span class="n">merge</span><span class="p">(</span><span class="n">baseline_numbers</span><span class="p">,</span> <span class="n">new_numbers</span><span class="p">[[</span><span class="s1">&#39;attr&#39;</span><span class="p">,</span> <span class="s1">&#39;New Value&#39;</span><span class="p">]],</span> <span class="n">how</span> <span class="o">=</span> <span class="s1">&#39;inner&#39;</span><span class="p">,</span> <span class="n">on</span> <span class="o">=</span> <span class="s1">&#39;attr&#39;</span><span class="p">,</span> <span class="n">copy</span> <span class="o">=</span> <span class="kc">False</span><span class="p">)</span>
        <span class="c1">#NOTE: For some reason the merge function is makeing 36 duplicates of every row. Must be a bug but to avoid this</span>
        <span class="c1">#       crap we can just use the drop_duplicates function. Whenever this gets fixed we won&#39;t care about the unnecessary</span>
        <span class="c1">#       drop_duplicates() call.</span>
        <span class="n">numbers_df</span><span class="o">.</span><span class="n">drop_duplicates</span><span class="p">(</span><span class="n">keep</span> <span class="o">=</span> <span class="s1">&#39;first&#39;</span><span class="p">,</span> <span class="n">inplace</span> <span class="o">=</span> <span class="kc">True</span><span class="p">)</span>
        <span class="n">numbers_df</span><span class="o">.</span><span class="n">rename</span><span class="p">({</span><span class="s1">&#39;attr&#39;</span> <span class="p">:</span> <span class="s1">&#39;Output Name&#39;</span><span class="p">},</span> <span class="n">axis</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span> <span class="n">inplace</span> <span class="o">=</span> <span class="kc">True</span><span class="p">)</span> <span class="c1">#So that the column names match the old comparatron output</span>

        <span class="c1">#The dfs as they exist at this point are missing required columns for the output: Error, Tolerance, &amp; Match.</span>
        <span class="c1">#We have everything we need to fill these columns in here.</span>
        <span class="n">numbers_df</span><span class="p">[</span><span class="s1">&#39;Error&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="nb">abs</span><span class="p">(</span><span class="n">numbers_df</span><span class="p">[</span><span class="s1">&#39;New Value&#39;</span><span class="p">]</span> <span class="o">-</span> <span class="n">numbers_df</span><span class="p">[</span><span class="s1">&#39;Baseline Value&#39;</span><span class="p">])</span>
        <span class="n">numbers_df</span><span class="p">[</span><span class="s1">&#39;Tolerance&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">numbers_df</span><span class="p">[</span><span class="s1">&#39;attr_internal&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">map</span><span class="p">(</span><span class="n">all_tolerances</span><span class="p">)</span>
        <span class="n">numbers_df</span><span class="p">[</span><span class="s1">&#39;Match&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">numbers_df</span><span class="p">[</span><span class="s1">&#39;Error&#39;</span><span class="p">]</span> <span class="o">&lt;=</span> <span class="n">numbers_df</span><span class="p">[</span><span class="s1">&#39;Tolerance&#39;</span><span class="p">]</span>

        <span class="n">strs_df</span> <span class="o">=</span> <span class="n">merge</span><span class="p">(</span><span class="n">baseline_strs</span><span class="p">,</span> <span class="n">new_strs</span><span class="p">,</span> <span class="n">how</span> <span class="o">=</span> <span class="s1">&#39;inner&#39;</span><span class="p">,</span> <span class="n">on</span> <span class="o">=</span> <span class="s1">&#39;attr&#39;</span><span class="p">,</span> <span class="n">copy</span> <span class="o">=</span> <span class="kc">False</span><span class="p">)</span>
        <span class="n">strs_df</span><span class="o">.</span><span class="n">drop_duplicates</span><span class="p">(</span><span class="n">keep</span> <span class="o">=</span> <span class="s1">&#39;first&#39;</span><span class="p">,</span> <span class="n">inplace</span> <span class="o">=</span> <span class="kc">True</span><span class="p">)</span>
        <span class="n">strs_df</span><span class="o">.</span><span class="n">rename</span><span class="p">({</span><span class="s1">&#39;attr&#39;</span> <span class="p">:</span> <span class="s1">&#39;Output Name&#39;</span><span class="p">},</span> <span class="n">axis</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span> <span class="n">inplace</span> <span class="o">=</span> <span class="kc">True</span><span class="p">)</span>

        <span class="n">strs_df</span><span class="p">[</span><span class="s1">&#39;Error&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">Series</span><span class="p">(</span><span class="n">dtype</span> <span class="o">=</span> <span class="nb">float</span><span class="p">)</span> <span class="c1">#these need to be type float for compatibility with the numbers_df when we combine everything together into the comparison df for output</span>
        <span class="n">strs_df</span><span class="p">[</span><span class="s1">&#39;Tolerance&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">Series</span><span class="p">(</span><span class="n">dtype</span> <span class="o">=</span> <span class="nb">float</span><span class="p">)</span>
        <span class="n">strs_df</span><span class="p">[</span><span class="s1">&#39;Match&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">strs_df</span><span class="p">[</span><span class="s1">&#39;Baseline Value&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="n">strs_df</span><span class="p">[</span><span class="s1">&#39;New Value&#39;</span><span class="p">]</span>

        <span class="n">comparison</span> <span class="o">=</span> <span class="n">concat</span><span class="p">([</span><span class="n">numbers_df</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">numbers_df</span><span class="p">[</span><span class="s1">&#39;Error&#39;</span><span class="p">]</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">],</span> <span class="n">strs_df</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="o">~</span><span class="n">strs_df</span><span class="p">[</span><span class="s1">&#39;Match&#39;</span><span class="p">]]])</span>
        <span class="n">comparison</span> <span class="o">=</span> <span class="n">comparison</span><span class="p">[[</span><span class="s1">&#39;Output Name&#39;</span><span class="p">,</span> <span class="s1">&#39;Baseline Value&#39;</span><span class="p">,</span><span class="s1">&#39;New Value&#39;</span><span class="p">,</span><span class="s1">&#39;Error&#39;</span><span class="p">,</span><span class="s1">&#39;Tolerance&#39;</span><span class="p">,</span><span class="s1">&#39;Match&#39;</span><span class="p">]]</span>
            
        <span class="c1">#If there are any attributes in the attributes_only_in_xxx lists then append them to comparison df</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">attrs_only_in_baseline</span><span class="p">)</span> <span class="o">!=</span> <span class="mi">0</span><span class="p">:</span>
            <span class="n">comparison</span> <span class="o">=</span> <span class="n">comparison</span><span class="o">.</span><span class="n">append</span><span class="p">({</span><span class="s1">&#39;Output Name&#39;</span><span class="p">:</span><span class="s1">&#39;Attributes only in Baseline&#39;</span><span class="p">,</span><span class="s1">&#39;Baseline Value&#39;</span><span class="p">:</span><span class="n">attributes_only_in_baseline</span><span class="p">,</span><span class="s1">&#39;Match&#39;</span><span class="p">:</span><span class="kc">False</span><span class="p">},</span> <span class="n">ignore_index</span> <span class="o">=</span> <span class="kc">True</span><span class="p">)</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">attrs_only_in_new</span><span class="p">)</span> <span class="o">!=</span> <span class="mi">0</span><span class="p">:</span>
            <span class="n">comparison</span> <span class="o">=</span> <span class="n">comparison</span><span class="o">.</span><span class="n">append</span><span class="p">({</span><span class="s1">&#39;Output Name&#39;</span><span class="p">:</span><span class="s1">&#39;Attributes only in New&#39;</span><span class="p">,</span><span class="s1">&#39;New Value&#39;</span><span class="p">:</span><span class="n">attributes_only_in_new</span><span class="p">,</span><span class="s1">&#39;Match&#39;</span><span class="p">:</span><span class="kc">False</span><span class="p">},</span> <span class="n">ignore_index</span> <span class="o">=</span> <span class="kc">True</span><span class="p">)</span>

                   
        <span class="c1">#Return a value of True if the missions are in complete agreement</span>
        <span class="k">if</span> <span class="n">comparison</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">comparison</span><span class="p">[</span><span class="s1">&#39;Match&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="kc">False</span><span class="p">]</span><span class="o">.</span><span class="n">empty</span><span class="p">:</span>
            <span class="k">return</span> <span class="kc">True</span><span class="p">,</span> <span class="n">comparison</span><span class="p">;</span>
			
        <span class="k">else</span><span class="p">:</span>
<span class="c1">#            comp_return=list(comparison.loc[comparison[&#39;Match&#39;]==False][&#39;Output Name&#39;])</span>
            <span class="k">if</span> <span class="n">full_output</span><span class="p">:</span> <span class="c1">#if full_output=True, save all values present in comparison to a csv</span>
                <span class="n">comparison</span><span class="o">.</span><span class="n">to_csv</span><span class="p">(</span><span class="n">csv_file_name</span><span class="p">,</span><span class="n">index</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
                <span class="k">return</span> <span class="kc">False</span><span class="p">,</span> <span class="n">comparison</span><span class="p">;</span>
            <span class="k">else</span><span class="p">:</span> <span class="c1">#if full_output=False, save only values that are not within the tolerance to a csv</span>
                <span class="n">comparison</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="o">~</span><span class="n">comparison</span><span class="p">[</span><span class="s1">&#39;Match&#39;</span><span class="p">]]</span><span class="o">.</span><span class="n">to_csv</span><span class="p">(</span><span class="n">csv_file_name</span><span class="p">,</span> <span class="n">index</span> <span class="o">=</span> <span class="kc">False</span><span class="p">)</span>
                <span class="k">return</span> <span class="kc">False</span><span class="p">,</span> <span class="n">comparison</span><span class="p">;</span></div>
</div>

                
</pre></div>

          </div>
          
        </div>
      </div>
      <div class="sphinxsidebar" role="navigation" aria-label="main navigation">
        <div class="sphinxsidebarwrapper">
<h1 class="logo"><a href="../index.html">EMTG python</a></h1>








<h3>Navigation</h3>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../PyEMTG/index.html">PyEMTG documentation</a></li>
<li class="toctree-l1"><a class="reference internal" href="../PEATSA/index.html">PEATSA documentation</a></li>
<li class="toctree-l1"><a class="reference internal" href="../OptionsOverhaul/index.html">OptionsOverhaul documentation</a></li>
</ul>

<div class="relations">
<h3>Related Topics</h3>
<ul>
  <li><a href="../index.html">Documentation overview</a><ul>
  <li><a href="index.html">Module code</a><ul>
  </ul></li>
  </ul></li>
</ul>
</div>
<search id="searchbox" style="display: none" role="search">
  <h3 id="searchlabel">Quick search</h3>
    <div class="searchformwrapper">
    <form class="search" action="../search.html" method="get">
      <input type="text" name="q" aria-labelledby="searchlabel" autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false"/>
      <input type="submit" value="Go" />
    </form>
    </div>
</search>
<script>document.getElementById('searchbox').style.display = "block"</script>








        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="footer">
      &#169;2024, Jacob Englander, Donald Ellison, Jeremy Knittel, Noble Hatten.
      
      |
      Powered by <a href="https://www.sphinx-doc.org/">Sphinx 7.3.7</a>
      &amp; <a href="https://alabaster.readthedocs.io">Alabaster 0.7.16</a>
      
    </div>

    

    
  </body>
</html>