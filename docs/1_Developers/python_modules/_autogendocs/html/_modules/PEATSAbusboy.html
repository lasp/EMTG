<!DOCTYPE html>

<html lang="en" data-content_root="../">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>PEATSAbusboy &#8212; EMTG python  documentation</title>
    <link rel="stylesheet" type="text/css" href="../_static/pygments.css?v=61cd365c" />
    <link rel="stylesheet" type="text/css" href="../_static/alabaster.css?v=12dfc556" />
    <script src="../_static/documentation_options.js?v=7f41d439"></script>
    <script src="../_static/doctools.js?v=9a2dae69"></script>
    <script src="../_static/sphinx_highlight.js?v=dc90522c"></script>
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
   
  <link rel="stylesheet" href="../_static/custom.css" type="text/css" />
  

  
  

  </head><body>
  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          

          <div class="body" role="main">
            
  <h1>Source code for PEATSAbusboy</h1><div class="highlight"><pre>
<span></span><span class="c1">#EMTG: Evolutionary Mission Trajectory Generator</span>
<span class="c1">#An open-source global optimization tool for preliminary mission design</span>
<span class="c1">#Provided by NASA Goddard Space Flight Center</span>
<span class="c1">#</span>
<span class="c1">#Copyright (c) 2014 - 2024 United States Government as represented by the</span>
<span class="c1">#Administrator of the National Aeronautics and Space Administration.</span>
<span class="c1">#All Other Rights Reserved.</span>
<span class="c1">#</span>
<span class="c1"># Copyright (c) 2024 The Regents of the University of Colorado.</span>
<span class="c1"># All Other Rights Reserved.</span>

<span class="c1">#Licensed under the NASA Open Source License (the &quot;License&quot;); </span>
<span class="c1">#You may not use this file except in compliance with the License. </span>
<span class="c1">#You may obtain a copy of the License at:</span>
<span class="c1">#https://opensource.org/license/nasa1-3-php</span>
<span class="c1">#Unless required by applicable law or agreed to in writing, software</span>
<span class="c1">#distributed under the License is distributed on an &quot;AS IS&quot; BASIS,</span>
<span class="c1">#WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either </span>
<span class="c1">#express or implied.   See the License for the specific language</span>
<span class="c1">#governing permissions and limitations under the License.</span>

<span class="sd">&quot;&quot;&quot;</span>
<span class="sd">PEATSAbusboy.py</span>
<span class="sd">==================</span>

<span class="sd">Class to analyze all of the .emtg files from a PEATSA iteration and put them into a list of PEATSAbox objects</span>

<span class="sd">&quot;&quot;&quot;</span>


<div class="viewcode-block" id="parallelParser">
<a class="viewcode-back" href="../PEATSA/PEATSAbusboy.html#PEATSAbusboy.parallelParser">[docs]</a>
<span class="k">def</span> <span class="nf">parallelParser</span><span class="p">(</span><span class="n">instance</span><span class="p">,</span> <span class="n">name</span><span class="p">,</span> <span class="n">i</span><span class="p">,</span> <span class="n">nCases</span><span class="p">,</span> <span class="n">args</span><span class="o">=</span><span class="p">(),</span> <span class="n">kwargs</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Non-class method required for parallelization.</span>
<span class="sd">    We use this to call parse_fun instead of calling parse_fun directly.</span>
<span class="sd">    See torek&#39;s response from April 2018 at https://stackoverflow.com/questions/1816958/cant-pickle-type-instancemethod-when-using-multiprocessing-pool-map/7309686#7309686</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="kn">import</span> <span class="nn">logging</span>
    <span class="k">if</span> <span class="n">kwargs</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">kwargs</span> <span class="o">=</span> <span class="p">{}</span>
    <span class="n">logging</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">i</span><span class="p">)</span> <span class="o">+</span> <span class="s1">&#39;/&#39;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">nCases</span><span class="p">))</span>
    <span class="k">return</span> <span class="nb">getattr</span><span class="p">(</span><span class="n">instance</span><span class="p">,</span> <span class="n">name</span><span class="p">)(</span><span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span></div>

    
<div class="viewcode-block" id="parallelParserRegions">
<a class="viewcode-back" href="../PEATSA/PEATSAbusboy.html#PEATSAbusboy.parallelParserRegions">[docs]</a>
<span class="k">def</span> <span class="nf">parallelParserRegions</span><span class="p">(</span><span class="n">instance</span><span class="p">,</span> <span class="n">name</span><span class="p">,</span> <span class="n">region</span><span class="p">,</span> <span class="n">PEATSAorder</span><span class="p">,</span> <span class="n">emtgopt_files</span><span class="p">,</span> <span class="n">results_folder</span><span class="p">,</span> <span class="n">kwargs</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Non-class method required for parallelization.</span>
<span class="sd">    We use this to call parse_fun instead of calling parse_fun directly.</span>
<span class="sd">    See torek&#39;s response from April 2018 at https://stackoverflow.com/questions/1816958/cant-pickle-type-instancemethod-when-using-multiprocessing-pool-map/7309686#7309686</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="kn">import</span> <span class="nn">logging</span>
    <span class="k">if</span> <span class="n">kwargs</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">kwargs</span> <span class="o">=</span> <span class="p">{}</span>
        
    <span class="c1">#i = region[0] # lower bound index</span>
    <span class="n">results</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="c1">#logging.info(str(i))</span>
    <span class="c1">#while i &lt;= region[1]: # upper bound index</span>
    <span class="c1">#    args = (PEATSAorder, emtgopt_files[i], results_folder,)</span>
    <span class="c1">#    results.append(getattr(instance, name)(*args, **kwargs))</span>
        <span class="c1">#logging.info(str(i))</span>
    <span class="n">logging</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s1">&#39;started parsing a region&#39;</span><span class="p">)</span>
    <span class="k">for</span> <span class="n">emtgopt_file</span> <span class="ow">in</span> <span class="n">emtgopt_files</span><span class="p">:</span>
        <span class="n">args</span> <span class="o">=</span> <span class="p">(</span><span class="n">PEATSAorder</span><span class="p">,</span> <span class="n">emtgopt_file</span><span class="p">,</span> <span class="n">results_folder</span><span class="p">,)</span>
        <span class="n">results</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="nb">getattr</span><span class="p">(</span><span class="n">instance</span><span class="p">,</span> <span class="n">name</span><span class="p">)(</span><span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">))</span>
    <span class="n">logging</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s1">&#39;finished parsing a region&#39;</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">results</span></div>


<div class="viewcode-block" id="parallelParserNotReadingRegions">
<a class="viewcode-back" href="../PEATSA/PEATSAbusboy.html#PEATSAbusboy.parallelParserNotReadingRegions">[docs]</a>
<span class="k">def</span> <span class="nf">parallelParserNotReadingRegions</span><span class="p">(</span><span class="n">instance</span><span class="p">,</span> <span class="n">name</span><span class="p">,</span> <span class="n">PEATSAorder</span><span class="p">,</span> <span class="n">PEATSAboxes</span><span class="p">,</span> <span class="n">kwargs</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Non-class method required for parallelization.</span>
<span class="sd">    We use this to call parse_fun instead of calling parse_fun directly.</span>
<span class="sd">    See torek&#39;s response from April 2018 at https://stackoverflow.com/questions/1816958/cant-pickle-type-instancemethod-when-using-multiprocessing-pool-map/7309686#7309686</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="kn">import</span> <span class="nn">logging</span>
    <span class="k">if</span> <span class="n">kwargs</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">kwargs</span> <span class="o">=</span> <span class="p">{}</span>
        
    <span class="n">results</span> <span class="o">=</span> <span class="p">[]</span>

    <span class="n">logging</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s1">&#39;started post-read parsing a region&#39;</span><span class="p">)</span>
    <span class="k">for</span> <span class="n">box</span> <span class="ow">in</span> <span class="n">PEATSAboxes</span><span class="p">:</span>
        <span class="n">args</span> <span class="o">=</span> <span class="p">(</span><span class="n">PEATSAorder</span><span class="p">,</span> <span class="n">box</span><span class="p">,)</span>
        <span class="n">results</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="nb">getattr</span><span class="p">(</span><span class="n">instance</span><span class="p">,</span> <span class="n">name</span><span class="p">)(</span><span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">))</span>
    <span class="n">logging</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s1">&#39;finished post-read parsing a region&#39;</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">results</span></div>

    
<div class="viewcode-block" id="parallelCallback">
<a class="viewcode-back" href="../PEATSA/PEATSAbusboy.html#PEATSAbusboy.parallelCallback">[docs]</a>
<span class="k">def</span> <span class="nf">parallelCallback</span><span class="p">(</span><span class="n">x</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Callback is required for parallelization. This doesn&#39;t actually do anything.</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    x : TYPE</span>
<span class="sd">        DESCRIPTION.</span>

<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    None.</span>

<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">return</span></div>


<div class="viewcode-block" id="PEATSAbusboy">
<a class="viewcode-back" href="../PEATSA/PEATSAbusboy.html#PEATSAbusboy.PEATSAbusboy">[docs]</a>
<span class="k">class</span> <span class="nc">PEATSAbusboy</span><span class="p">(</span><span class="nb">object</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Used to analyze all of the .emtg files from a PEATSA iteration and put them into a list of PEATSAbox objects</span>
<span class="sd">    </span>
<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    None.</span>

<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    None.</span>
<span class="sd">    &quot;&quot;&quot;</span>
        
<div class="viewcode-block" id="PEATSAbusboy.load_external_seed_boxes">
<a class="viewcode-back" href="../PEATSA/PEATSAbusboy.html#PEATSAbusboy.PEATSAbusboy.load_external_seed_boxes">[docs]</a>
    <span class="k">def</span> <span class="nf">load_external_seed_boxes</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">PEATSAorder</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Description.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        PEATSAorder : TYPE</span>
<span class="sd">            DESCRIPTION.</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        external_seed_boxes : TYPE</span>
<span class="sd">            DESCRIPTION.</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="kn">import</span> <span class="nn">os</span>
        
        <span class="c1"># Initialize an output list</span>
        <span class="n">external_seed_boxes</span> <span class="o">=</span> <span class="p">[]</span>
        
        <span class="c1"># loop through all seed folders and parse them</span>
        <span class="k">for</span> <span class="n">seed_folder</span> <span class="ow">in</span> <span class="n">PEATSAorder</span><span class="o">.</span><span class="n">seed_folders</span><span class="p">:</span>
    
            <span class="c1"># Check what type of folder this is</span>
            <span class="k">if</span> <span class="n">seed_folder</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
        
                <span class="c1"># Get a list of all the subfolders in the main results directory. Each of these should be an iteration directory</span>
                <span class="n">subfolders</span> <span class="o">=</span> <span class="p">[</span><span class="n">seed_folder</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">+</span> <span class="s2">&quot;/&quot;</span> <span class="o">+</span> <span class="n">folder</span> <span class="o">+</span> <span class="s2">&quot;/&quot;</span> <span class="k">for</span> <span class="n">folder</span> <span class="ow">in</span> <span class="n">os</span><span class="o">.</span><span class="n">listdir</span><span class="p">(</span><span class="n">seed_folder</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span> <span class="k">if</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">isdir</span><span class="p">(</span><span class="n">seed_folder</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">+</span> <span class="s2">&quot;/&quot;</span> <span class="o">+</span> <span class="n">folder</span><span class="p">)]</span>
    
                <span class="c1"># Loop through all of the subfolders (iteration directories)</span>
                <span class="k">for</span> <span class="n">folder</span> <span class="ow">in</span> <span class="n">subfolders</span><span class="p">:</span>
            
                    <span class="c1"># Parse the results for this subfolder and add it to the rest of the results</span>
                    <span class="n">external_seed_boxes</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">parse_results</span><span class="p">(</span><span class="n">PEATSAorder</span><span class="p">,</span><span class="n">folder</span><span class="p">,</span><span class="n">external_seed_boxes</span><span class="p">)</span>
            
            <span class="k">elif</span> <span class="n">seed_folder</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
        
                <span class="c1"># Parse the results for this subfolder and add it to the rest of the results</span>
                <span class="n">external_seed_boxes</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">parse_results</span><span class="p">(</span><span class="n">PEATSAorder</span><span class="p">,</span><span class="n">seed_folder</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span><span class="n">external_seed_boxes</span><span class="p">)</span>
    
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">external_seed_boxes</span><span class="p">):</span>
            <span class="c1"># Sort the seed results and eliminate lesser cases</span>
            <span class="n">external_seed_boxes</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">sort_and_filter</span><span class="p">(</span><span class="n">PEATSAorder</span><span class="p">,</span><span class="n">external_seed_boxes</span><span class="p">)</span>    
        
        <span class="n">external_ctr</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="k">for</span> <span class="n">box</span> <span class="ow">in</span> <span class="n">external_seed_boxes</span><span class="p">:</span>
            <span class="n">external_ctr</span> <span class="o">+=</span> <span class="mi">1</span>
            <span class="n">box</span><span class="o">.</span><span class="n">mission_name</span> <span class="o">=</span> <span class="s2">&quot;External_Case&quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">external_ctr</span><span class="p">)</span> <span class="o">+</span> <span class="s2">&quot;_&quot;</span> <span class="o">+</span> <span class="n">box</span><span class="o">.</span><span class="n">mission_name</span>
            <span class="n">box</span><span class="o">.</span><span class="n">in_study</span> <span class="o">=</span> <span class="kc">False</span>
        
        <span class="c1"># Return the list of boxes</span>
        <span class="k">return</span> <span class="n">external_seed_boxes</span></div>

        
<div class="viewcode-block" id="PEATSAbusboy.fresh_parse_results">
<a class="viewcode-back" href="../PEATSA/PEATSAbusboy.html#PEATSAbusboy.PEATSAbusboy.fresh_parse_results">[docs]</a>
    <span class="k">def</span> <span class="nf">fresh_parse_results</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">PEATSAorder</span><span class="p">,</span><span class="n">restart_dir</span><span class="p">,</span><span class="n">history</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Description</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        PEATSAorder : TYPE</span>
<span class="sd">            DESCRIPTION.</span>
<span class="sd">        restart_dir : TYPE</span>
<span class="sd">            DESCRIPTION.</span>
<span class="sd">        history : TYPE, optional</span>
<span class="sd">            DESCRIPTION. The default is None.</span>

<span class="sd">        Raises</span>
<span class="sd">        ------</span>
<span class="sd">        Exception</span>
<span class="sd">            DESCRIPTION.</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        TYPE</span>
<span class="sd">            DESCRIPTION.</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="kn">import</span> <span class="nn">sys</span>
        <span class="kn">import</span> <span class="nn">os</span>
        <span class="n">sys</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">PEATSAorder</span><span class="o">.</span><span class="n">emtg_root_directory</span> <span class="o">+</span> <span class="s2">&quot;/PyEMTG&quot;</span><span class="p">)</span>
        <span class="kn">import</span> <span class="nn">MissionOptions</span>
        <span class="kn">import</span> <span class="nn">Mission</span>
        <span class="kn">import</span> <span class="nn">logging</span>
        <span class="n">logging</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;Parsing a full results root folder&quot;</span><span class="p">)</span>
        
        <span class="c1"># Initialize the output array</span>
        <span class="n">boxes_out</span> <span class="o">=</span> <span class="p">[]</span>
                
        <span class="c1"># Get a list of all the subfolders in the main results directory. Each of these should be an iteration directory</span>
        <span class="n">subfolders</span> <span class="o">=</span> <span class="p">[</span><span class="n">restart_dir</span> <span class="o">+</span> <span class="s2">&quot;/&quot;</span> <span class="o">+</span> <span class="n">folder</span> <span class="o">+</span> <span class="s2">&quot;/&quot;</span> <span class="k">for</span> <span class="n">folder</span> <span class="ow">in</span> <span class="n">os</span><span class="o">.</span><span class="n">listdir</span><span class="p">(</span><span class="n">restart_dir</span><span class="p">)</span> <span class="k">if</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">isdir</span><span class="p">(</span><span class="n">restart_dir</span> <span class="o">+</span> <span class="s2">&quot;/&quot;</span> <span class="o">+</span> <span class="n">folder</span><span class="p">)]</span>
    
        <span class="c1"># Loop through all of the subfolders (iteration directories)</span>
        <span class="k">for</span> <span class="n">folder</span> <span class="ow">in</span> <span class="n">subfolders</span><span class="p">:</span>
                            
            <span class="k">if</span> <span class="n">history</span> <span class="o">==</span> <span class="kc">None</span><span class="p">:</span>
                <span class="c1"># Parse the results for this subfolder and add it to the rest of the results</span>
                <span class="n">boxes_out</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">parse_results</span><span class="p">(</span><span class="n">PEATSAorder</span><span class="p">,</span><span class="n">folder</span><span class="p">,</span><span class="n">boxes_out</span><span class="p">,</span><span class="kc">False</span><span class="p">,</span><span class="n">history</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="c1"># Parse the results for this subfolder and add it to the rest of the results</span>
                <span class="n">boxes_out</span><span class="p">,</span> <span class="n">history</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">parse_results</span><span class="p">(</span><span class="n">PEATSAorder</span><span class="p">,</span><span class="n">folder</span><span class="p">,</span><span class="n">boxes_out</span><span class="p">,</span><span class="kc">False</span><span class="p">,</span><span class="n">history</span><span class="p">)</span>
        
        <span class="c1"># Check to mkae sure we got some results</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">boxes_out</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
            <span class="c1"># Maybe the user forgot the results folder on top of the peatsa path   </span>
            
            <span class="c1"># Get a list of all the subfolders in the main results directory. Each of these should be an iteration directory</span>
            <span class="n">subfolders</span> <span class="o">=</span> <span class="p">[</span><span class="n">restart_dir</span> <span class="o">+</span> <span class="s2">&quot;/results/&quot;</span> <span class="o">+</span> <span class="n">folder</span> <span class="o">+</span> <span class="s2">&quot;/&quot;</span> <span class="k">for</span> <span class="n">folder</span> <span class="ow">in</span> <span class="n">os</span><span class="o">.</span><span class="n">listdir</span><span class="p">(</span><span class="n">restart_dir</span> <span class="o">+</span> <span class="s2">&quot;/results&quot;</span><span class="p">)</span> <span class="k">if</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">isdir</span><span class="p">(</span><span class="n">restart_dir</span> <span class="o">+</span> <span class="s2">&quot;/results/&quot;</span> <span class="o">+</span> <span class="n">folder</span><span class="p">)]</span>
    
            <span class="c1"># Loop through all of the subfolders (iteration directories)</span>
            <span class="k">for</span> <span class="n">folder</span> <span class="ow">in</span> <span class="n">subfolders</span><span class="p">:</span>
                
                <span class="k">if</span> <span class="n">history</span> <span class="o">==</span> <span class="kc">None</span><span class="p">:</span>
                    <span class="c1"># Parse the results for this subfolder and add it to the rest of the results</span>
                    <span class="n">boxes_out</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">parse_results</span><span class="p">(</span><span class="n">PEATSAorder</span><span class="p">,</span><span class="n">folder</span><span class="p">,</span><span class="n">boxes_out</span><span class="p">,</span><span class="kc">False</span><span class="p">,</span><span class="n">history</span><span class="p">)</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="c1"># Parse the results for this subfolder and add it to the rest of the results</span>
                    <span class="n">boxes_out</span><span class="p">,</span> <span class="n">history</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">parse_results</span><span class="p">(</span><span class="n">PEATSAorder</span><span class="p">,</span><span class="n">folder</span><span class="p">,</span><span class="n">boxes_out</span><span class="p">,</span><span class="kc">False</span><span class="p">,</span><span class="n">history</span><span class="p">)</span>
                    
        <span class="c1"># Check to see if we have results now</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">boxes_out</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="s2">&quot;Not able to find any emtg results. Check to make sure that the &#39;restart_run_root_directory&#39; path is correct&quot;</span><span class="p">)</span>
        
        <span class="c1"># Return the list of all results</span>
        <span class="k">if</span> <span class="n">history</span> <span class="o">==</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">boxes_out</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">boxes_out</span><span class="p">,</span> <span class="n">history</span></div>

        
<div class="viewcode-block" id="PEATSAbusboy.parse_results">
<a class="viewcode-back" href="../PEATSA/PEATSAbusboy.html#PEATSAbusboy.PEATSAbusboy.parse_results">[docs]</a>
    <span class="k">def</span> <span class="nf">parse_results</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">PEATSAorder</span><span class="p">,</span><span class="n">results_folder</span><span class="p">,</span><span class="n">PEATSAboxes</span><span class="p">,</span><span class="n">update_seed_criteria_or_fingerprint_flag</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span><span class="n">history</span> <span class="o">=</span> <span class="kc">None</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Description.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        PEATSAorder : TYPE</span>
<span class="sd">            DESCRIPTION.</span>
<span class="sd">        results_folder : TYPE</span>
<span class="sd">            DESCRIPTION.</span>
<span class="sd">        PEATSAboxes : TYPE</span>
<span class="sd">            DESCRIPTION.</span>
<span class="sd">        update_seed_criteria_or_fingerprint_flag : TYPE, optional</span>
<span class="sd">            DESCRIPTION. The default is False.</span>
<span class="sd">        history : TYPE, optional</span>
<span class="sd">            DESCRIPTION. The default is None.</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        TYPE</span>
<span class="sd">            DESCRIPTION.</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="kn">import</span> <span class="nn">sys</span>
        <span class="kn">import</span> <span class="nn">os</span>
        <span class="n">sys</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">PEATSAorder</span><span class="o">.</span><span class="n">emtg_root_directory</span> <span class="o">+</span> <span class="s2">&quot;/PyEMTG&quot;</span><span class="p">)</span>
        <span class="kn">import</span> <span class="nn">MissionOptions</span>
        <span class="kn">import</span> <span class="nn">logging</span>
        <span class="kn">import</span> <span class="nn">PEATSAbox</span>
        <span class="n">logging</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;Parsing folder and updating results: &quot;</span> <span class="o">+</span> <span class="n">results_folder</span><span class="p">)</span>
        
        <span class="c1"># Check if we need to reload the boxes</span>
        <span class="k">if</span> <span class="n">update_seed_criteria_or_fingerprint_flag</span><span class="p">:</span>
            <span class="c1"># we do</span>
            <span class="n">tempBoxes</span> <span class="o">=</span> <span class="p">[]</span>
            
            <span class="c1"># Loop through all the boxes</span>
            <span class="k">for</span> <span class="n">box</span> <span class="ow">in</span> <span class="n">PEATSAboxes</span><span class="p">:</span>
                <span class="c1"># Append a new box after reloading the data</span>
                <span class="n">tempBoxes</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">PEATSAbox</span><span class="o">.</span><span class="n">PEATSAbox</span><span class="p">(</span><span class="n">PEATSAorder</span><span class="p">,</span><span class="n">box</span><span class="o">.</span><span class="n">PEATSApath</span><span class="p">,</span><span class="n">box</span><span class="o">.</span><span class="n">PEATSAdough_path</span><span class="p">,</span><span class="n">box</span><span class="o">.</span><span class="n">PEATSAcrust_path</span><span class="p">))</span>
                
            <span class="c1"># Update the list of boxes with the new data</span>
            <span class="n">PEATSAboxes</span> <span class="o">=</span> <span class="n">tempBoxes</span>
            
        <span class="c1">#logging.info(&quot;Before parsing:&quot;)</span>
        <span class="c1">#for box in PEATSAboxes:</span>
        <span class="c1">#    string = box.PEATSApath + &quot;/&quot; + box.PEATSAcrust_path</span>
        <span class="c1">#    logging.info(string)</span>
        <span class="c1"># Get a listing of all the emtgopt files in this directory.</span>
        <span class="n">emtgopt_files</span> <span class="o">=</span> <span class="p">[</span><span class="n">file</span> <span class="k">for</span> <span class="n">file</span> <span class="ow">in</span> <span class="n">os</span><span class="o">.</span><span class="n">listdir</span><span class="p">(</span><span class="n">results_folder</span><span class="p">)</span> <span class="k">if</span> <span class="n">file</span><span class="o">.</span><span class="n">endswith</span><span class="p">(</span><span class="s1">&#39;.emtgopt&#39;</span><span class="p">)]</span>
        
        <span class="c1"># way faster to do this now and save it than do it in parse_fun</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">emtg_files</span> <span class="o">=</span> <span class="p">[</span><span class="n">file</span> <span class="k">for</span> <span class="n">file</span> <span class="ow">in</span> <span class="n">os</span><span class="o">.</span><span class="n">listdir</span><span class="p">(</span><span class="n">results_folder</span><span class="p">)</span> <span class="k">if</span> <span class="n">file</span><span class="o">.</span><span class="n">endswith</span><span class="p">(</span><span class="s1">&#39;.emtg&#39;</span><span class="p">)]</span>

        <span class="c1"># Check if parsing will be done in parallel</span>
        <span class="k">if</span> <span class="n">PEATSAorder</span><span class="o">.</span><span class="n">parse_in_parallel</span><span class="p">:</span>
            <span class="kn">import</span> <span class="nn">multiprocessing</span> <span class="k">as</span> <span class="nn">mp</span>

            <span class="c1">######################################</span>
            <span class="c1"># new way of parallel post-processing:</span>
            <span class="n">nCases</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">emtgopt_files</span><span class="p">)</span> <span class="c1"># number of things we need to post-process</span>
            <span class="k">if</span> <span class="n">nCases</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">history</span> <span class="o">==</span> <span class="kc">None</span><span class="p">:</span>
                    <span class="k">return</span> <span class="n">PEATSAboxes</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="k">return</span> <span class="n">PEATSAboxes</span><span class="p">,</span> <span class="n">history</span>
                <span class="c1"># no cases: parallelism will break if we allow it to happen</span>
                <span class="c1"># there are no new_boxes to add to peatsa boxes</span>
                <span class="c1"># just break</span>
            
            <span class="c1"># read the cases in serial</span>
            <span class="c1">#logging.info(&#39;Reading cases prior to parallel processing.&#39;)</span>
            <span class="c1">#new_boxes = []</span>
            <span class="c1">#for emtgoptfile in emtgopt_files:</span>
            <span class="c1">#    # Call the parse function to get the new box</span>
            <span class="c1">#    # Add the new case to the list</span>
            <span class="c1">#    new_boxes.append(self.parse_fun_read_only(PEATSAorder,emtgoptfile,results_folder))</span>

            <span class="c1">#logging.info(&#39;Finished reading cases prior to parallel processing.&#39;)</span>
            <span class="c1"># now, do the parallelizable stuff in parallel</span>
            <span class="n">nProcessors</span> <span class="o">=</span> <span class="n">mp</span><span class="o">.</span><span class="n">cpu_count</span><span class="p">()</span> <span class="c1"># get the actual number of processors</span>
            
            <span class="n">processorsDesired</span> <span class="o">=</span> <span class="nb">min</span><span class="p">(</span><span class="n">nProcessors</span><span class="p">,</span> <span class="n">PEATSAorder</span><span class="o">.</span><span class="n">parse_in_parallel_nCores</span><span class="p">)</span> <span class="c1"># number of processors: the minimum of the number of processors we have and the number the user requested</span>
            <span class="n">logging</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s1">&#39;Starting parallel post-processing&#39;</span><span class="p">)</span>
            <span class="n">nWorkers</span> <span class="o">=</span> <span class="nb">min</span><span class="p">(</span><span class="n">processorsDesired</span><span class="p">,</span> <span class="n">nCases</span><span class="p">)</span>
            <span class="n">logging</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s1">&#39;Using &#39;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">nWorkers</span><span class="p">)</span> <span class="o">+</span> <span class="s1">&#39; processes for &#39;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">nCases</span><span class="p">)</span> <span class="o">+</span> <span class="s1">&#39; cases&#39;</span><span class="p">)</span>
            <span class="n">pool</span> <span class="o">=</span> <span class="n">mp</span><span class="o">.</span><span class="n">Pool</span><span class="p">(</span><span class="n">nWorkers</span><span class="p">)</span> <span class="c1"># create the parallel pool</span>
                
            <span class="n">regions</span> <span class="o">=</span> <span class="p">[]</span>
            <span class="n">nCasesPerWorker</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">nCases</span> <span class="o">/</span> <span class="n">nWorkers</span><span class="p">)</span>
            <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">nWorkers</span><span class="p">):</span>
                <span class="n">lb</span> <span class="o">=</span> <span class="n">i</span> <span class="o">*</span> <span class="n">nCasesPerWorker</span>
                <span class="k">if</span> <span class="n">i</span> <span class="o">==</span> <span class="n">nWorkers</span> <span class="o">-</span> <span class="mi">1</span><span class="p">:</span>
                    <span class="n">ub</span> <span class="o">=</span> <span class="n">nCases</span> <span class="o">-</span> <span class="mi">1</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">ub</span> <span class="o">=</span> <span class="p">(</span><span class="n">i</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span> <span class="o">*</span> <span class="n">nCasesPerWorker</span> <span class="o">-</span> <span class="mi">1</span>
                <span class="n">regions</span><span class="o">.</span><span class="n">append</span><span class="p">((</span><span class="n">lb</span><span class="p">,</span> <span class="n">ub</span><span class="p">))</span>
                
            <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">regions</span><span class="p">)):</span>
                <span class="n">logging</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s1">&#39;Region &#39;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">i</span><span class="p">)</span> <span class="o">+</span> <span class="s1">&#39;: &#39;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">regions</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="mi">0</span><span class="p">])</span> <span class="o">+</span> <span class="s1">&#39; to &#39;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">regions</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="mi">1</span><span class="p">]))</span>
                
            <span class="c1">#results = [pool.apply_async(parallelParserNotReadingRegions, args = (self, &#39;parse_fun_after_reading&#39;, PEATSAorder, new_boxes[regions[i][0]:regions[i][1]+1],), callback = parallelCallback) for i in range(len(regions))]</span>
            <span class="n">results</span> <span class="o">=</span> <span class="p">[</span><span class="n">pool</span><span class="o">.</span><span class="n">apply_async</span><span class="p">(</span><span class="n">parallelParserRegions</span><span class="p">,</span> <span class="n">args</span> <span class="o">=</span> <span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="s1">&#39;parse_fun&#39;</span><span class="p">,</span> <span class="n">regions</span><span class="p">[</span><span class="n">i</span><span class="p">],</span> <span class="n">PEATSAorder</span><span class="p">,</span> <span class="n">emtgopt_files</span><span class="p">[</span><span class="n">regions</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="mi">0</span><span class="p">]:</span><span class="n">regions</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="mi">1</span><span class="p">]</span><span class="o">+</span><span class="mi">1</span><span class="p">],</span> <span class="n">results_folder</span><span class="p">,),</span> <span class="n">callback</span> <span class="o">=</span> <span class="n">parallelCallback</span><span class="p">)</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">regions</span><span class="p">))]</span>
            <span class="n">pool</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
            <span class="nb">map</span><span class="p">(</span><span class="n">mp</span><span class="o">.</span><span class="n">pool</span><span class="o">.</span><span class="n">ApplyResult</span><span class="o">.</span><span class="n">wait</span><span class="p">,</span> <span class="n">results</span><span class="p">)</span>
            <span class="n">pool</span><span class="o">.</span><span class="n">join</span><span class="p">()</span>
            
            <span class="n">logging</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s1">&#39;Finished parallel post-processing&#39;</span><span class="p">)</span>
            <span class="n">new_boxes</span> <span class="o">=</span> <span class="p">[</span><span class="n">r</span><span class="o">.</span><span class="n">get</span><span class="p">()</span> <span class="k">for</span> <span class="n">r</span> <span class="ow">in</span> <span class="n">results</span><span class="p">]</span> <span class="c1"># grab the results of the parsing</span>
            <span class="n">list_of_list_of_boxes</span> <span class="o">=</span> <span class="p">[</span><span class="n">r</span><span class="o">.</span><span class="n">get</span><span class="p">()</span> <span class="k">for</span> <span class="n">r</span> <span class="ow">in</span> <span class="n">results</span><span class="p">]</span> <span class="c1"># results is a list of lists. we want just a single list of all those items</span>
            <span class="n">new_boxes</span> <span class="o">=</span> <span class="p">[</span><span class="n">item</span> <span class="k">for</span> <span class="n">sublist</span> <span class="ow">in</span> <span class="n">list_of_list_of_boxes</span> <span class="k">for</span> <span class="n">item</span> <span class="ow">in</span> <span class="n">sublist</span><span class="p">]</span>
            <span class="n">logging</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s1">&#39;Put processed results in new_boxes&#39;</span><span class="p">)</span>
            
            <span class="c1"># do the parsing:</span>
            <span class="c1">#results = [pool.apply_async(parallelParser, args = (self, &#39;parse_fun&#39;, i, nCases, (PEATSAorder, emtgopt_files[i], results_folder,)), callback = parallelCallback) for i in range(nCases)]</span>
            <span class="c1">#pool.close()</span>
            <span class="c1">#pool.join()</span>
            <span class="c1">#logging.info(&#39;Finished parallel post-processing&#39;)</span>
            <span class="c1">#new_boxes = [r.get() for r in results] # grab the results of the parsing</span>
            <span class="c1">#logging.info(&#39;Put processed results in new_boxes&#39;)</span>
            
            <span class="c1">##################################################</span>
            
            <span class="k">if</span> <span class="n">history</span> <span class="o">!=</span> <span class="kc">None</span><span class="p">:</span>
                <span class="k">for</span> <span class="n">new_box</span> <span class="ow">in</span> <span class="n">new_boxes</span><span class="p">:</span>
                    <span class="n">history</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">update_history</span><span class="p">(</span><span class="n">PEATSAorder</span><span class="p">,</span><span class="n">new_box</span><span class="p">,</span><span class="n">history</span><span class="p">)</span>
            <span class="c1"># Add in the new boxes</span>
            <span class="n">PEATSAboxes</span> <span class="o">+=</span> <span class="n">new_boxes</span>        

        <span class="k">else</span><span class="p">:</span>
            <span class="c1"># Loop through all of the emtgopt files in serial</span>
            <span class="k">for</span> <span class="n">emtgoptfile</span> <span class="ow">in</span> <span class="n">emtgopt_files</span><span class="p">:</span>
                
                <span class="c1"># Call the parse function to get the new box</span>
                <span class="n">new_box</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">parse_fun</span><span class="p">(</span><span class="n">PEATSAorder</span><span class="p">,</span><span class="n">emtgoptfile</span><span class="p">,</span><span class="n">results_folder</span><span class="p">)</span>
                
                <span class="c1"># Add the new case to the list</span>
                <span class="n">PEATSAboxes</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">new_box</span><span class="p">)</span>
                
                <span class="k">if</span> <span class="n">history</span> <span class="o">!=</span> <span class="kc">None</span><span class="p">:</span>
                    <span class="n">history</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">update_history</span><span class="p">(</span><span class="n">PEATSAorder</span><span class="p">,</span><span class="n">new_box</span><span class="p">,</span><span class="n">history</span><span class="p">)</span>
        
        <span class="c1">#logging.info(&quot;After parsing:&quot;)</span>
        <span class="c1">#for box in PEATSAboxes:</span>
        <span class="c1">#    string = box.PEATSApath + &quot;/&quot; + box.PEATSAcrust_path</span>
        <span class="c1">#    logging.info(string)</span>
            
        <span class="c1"># Return the full list</span>
        <span class="k">if</span> <span class="n">history</span> <span class="o">==</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">PEATSAboxes</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">PEATSAboxes</span><span class="p">,</span> <span class="n">history</span></div>

        


<div class="viewcode-block" id="PEATSAbusboy.update_history">
<a class="viewcode-back" href="../PEATSA/PEATSAbusboy.html#PEATSAbusboy.PEATSAbusboy.update_history">[docs]</a>
    <span class="k">def</span> <span class="nf">update_history</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">PEATSAorder</span><span class="p">,</span><span class="n">new_box</span><span class="p">,</span><span class="n">history</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Description</span>
<span class="sd">        &quot;&quot;&quot;</span>
        
        <span class="c1"># Get the base mission name, as this will be used as the key in the dictionary</span>
        <span class="n">key</span> <span class="o">=</span> <span class="n">new_box</span><span class="o">.</span><span class="n">mission_name</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;_seeded_by&quot;</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;_v&quot;</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>

        <span class="c1"># Check if the case finished:</span>
        <span class="k">if</span> <span class="n">new_box</span><span class="o">.</span><span class="n">PEATSAcrust_path</span> <span class="o">==</span> <span class="s2">&quot;FAILURE_fake.emtg&quot;</span><span class="p">:</span>
            <span class="n">ifFinished</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">ifFinished</span> <span class="o">=</span> <span class="mi">1</span>
        
        <span class="n">seed</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="k">if</span> <span class="n">PEATSAorder</span><span class="o">.</span><span class="n">iteration</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>    
            <span class="c1"># Find the seed from the seed history</span>
            <span class="n">seed</span> <span class="o">=</span> <span class="o">-</span><span class="mi">1</span>
            <span class="k">if</span> <span class="s2">&quot;seeded_by&quot;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">new_box</span><span class="o">.</span><span class="n">mission_name</span><span class="p">:</span>
                <span class="c1"># There isnt actually a seed</span>
                <span class="n">seed</span> <span class="o">=</span> <span class="kc">None</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="c1"># Excract hte seeded by string</span>
                <span class="n">seed_target</span> <span class="o">=</span> <span class="n">new_box</span><span class="o">.</span><span class="n">mission_name</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;seeded_by&quot;</span><span class="p">)[</span><span class="mi">1</span><span class="p">]</span>
                <span class="c1"># Loop through the seeds in the history for this case</span>
                <span class="k">for</span> <span class="n">possible_seed</span> <span class="ow">in</span> <span class="n">history</span><span class="p">[</span><span class="s1">&#39;seed&#39;</span><span class="p">][</span><span class="o">-</span><span class="mi">1</span><span class="p">][</span><span class="n">key</span><span class="p">]:</span>
                    <span class="c1"># Check if this seed name is in the seeded by string</span>
                    <span class="k">if</span> <span class="n">possible_seed</span> <span class="o">!=</span> <span class="kc">None</span> <span class="ow">and</span> <span class="n">possible_seed</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="ow">in</span> <span class="n">seed_target</span><span class="p">:</span>
                        <span class="c1"># It is, we found it</span>
                        <span class="n">seed</span> <span class="o">=</span> <span class="n">possible_seed</span>
                        <span class="k">break</span>
                    
            <span class="c1"># Make sure we found the seed, and throw an error if not</span>
            <span class="k">if</span> <span class="n">seed</span> <span class="o">==</span> <span class="o">-</span><span class="mi">1</span><span class="p">:</span>
                <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="s2">&quot;Cant find this case in the seed history: &quot;</span> <span class="o">+</span> <span class="n">new_box</span><span class="o">.</span><span class="n">mission_name</span><span class="p">)</span>
        
        <span class="c1"># Did this case converge?</span>
        <span class="k">if</span> <span class="n">new_box</span><span class="o">.</span><span class="n">converged</span><span class="p">:</span>
            <span class="c1"># Check if this case was seedeed</span>
            <span class="k">if</span> <span class="n">seed</span> <span class="o">==</span> <span class="kc">None</span><span class="p">:</span>
                <span class="c1"># It was not, so yes, it improved from its &quot;seed&quot;</span>
                <span class="n">ifImprovedFromSeed</span> <span class="o">=</span> <span class="mi">1</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="c1"># It was seeded. Get the seeds&#39; objective value</span>
                <span class="n">seed_obj_val</span> <span class="o">=</span> <span class="n">seed</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
                
                <span class="c1"># Check if the seed has a better objective value or the case does</span>
                <span class="k">if</span> <span class="n">PEATSAorder</span><span class="o">.</span><span class="n">max_or_min</span> <span class="o">==</span> <span class="s2">&quot;max&quot;</span> <span class="ow">and</span> <span class="n">new_box</span><span class="o">.</span><span class="n">objective_value</span> <span class="o">&gt;</span> <span class="n">seed_obj_val</span><span class="p">:</span>
                    <span class="n">ifImprovedFromSeed</span> <span class="o">=</span> <span class="mi">1</span>
                <span class="k">elif</span> <span class="n">PEATSAorder</span><span class="o">.</span><span class="n">max_or_min</span> <span class="o">==</span> <span class="s2">&quot;min&quot;</span> <span class="ow">and</span> <span class="n">new_box</span><span class="o">.</span><span class="n">objective_value</span> <span class="o">&lt;</span> <span class="n">seed_obj_val</span><span class="p">:</span>
                    <span class="n">ifImprovedFromSeed</span> <span class="o">=</span> <span class="mi">1</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">ifImprovedFromSeed</span> <span class="o">=</span> <span class="mi">0</span>                        
        <span class="k">else</span><span class="p">:</span>
            <span class="c1"># The case did not converge, so clearly it did not do as well as the seed</span>
            <span class="n">ifImprovedFromSeed</span> <span class="o">=</span> <span class="mi">0</span>    
        
        
        <span class="c1"># Check if this key is already in the dictionary</span>
        <span class="k">if</span> <span class="n">key</span> <span class="ow">in</span> <span class="n">history</span><span class="p">[</span><span class="s1">&#39;run&#39;</span><span class="p">][</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
            <span class="c1"># It is. so multiple versions of this case are being run. Add the case to list</span>
            <span class="n">history</span><span class="p">[</span><span class="s1">&#39;run&#39;</span><span class="p">][</span><span class="o">-</span><span class="mi">1</span><span class="p">][</span><span class="n">key</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">((</span><span class="n">ifFinished</span><span class="p">,</span><span class="n">new_box</span><span class="o">.</span><span class="n">converged</span><span class="p">,</span><span class="n">ifImprovedFromSeed</span><span class="p">,</span><span class="n">seed</span><span class="p">))</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="c1"># This case is not yet in the history. Add it, along with the seed details as the first entry in a list</span>
            <span class="n">history</span><span class="p">[</span><span class="s1">&#39;run&#39;</span><span class="p">][</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">update</span><span class="p">({</span><span class="n">key</span><span class="p">:[(</span><span class="n">ifFinished</span><span class="p">,</span><span class="n">new_box</span><span class="o">.</span><span class="n">converged</span><span class="p">,</span><span class="n">ifImprovedFromSeed</span><span class="p">,</span><span class="n">seed</span><span class="p">)]})</span> 
        
        <span class="c1"># Check if this key is the objetive dictionary</span>
        <span class="k">if</span> <span class="n">key</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">history</span><span class="p">[</span><span class="s1">&#39;objective&#39;</span><span class="p">][</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
            <span class="c1"># Add this key to the history</span>
            <span class="n">history</span><span class="p">[</span><span class="s1">&#39;objective&#39;</span><span class="p">][</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">update</span><span class="p">({</span><span class="n">key</span><span class="p">:(</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">)})</span> 
            
        <span class="c1"># Check if this key is in the firstSolveFeasible dictionary</span>
        <span class="k">if</span> <span class="n">key</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">history</span><span class="p">[</span><span class="s1">&#39;firstSolveFeasible&#39;</span><span class="p">][</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
            <span class="c1"># Add this key to the history</span>
            <span class="n">history</span><span class="p">[</span><span class="s1">&#39;firstSolveFeasible&#39;</span><span class="p">][</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">update</span><span class="p">({</span><span class="n">key</span><span class="p">:(</span><span class="mi">0</span><span class="p">)})</span> <span class="c1"># just one element in the tuple: 1 if first attempt converged, 0 if it did not</span>
            
        <span class="c1"># Check if this key is in the bestSolutionIndex dictionary</span>
        <span class="k">if</span> <span class="n">key</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">history</span><span class="p">[</span><span class="s1">&#39;bestSolutionIndex&#39;</span><span class="p">][</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
            <span class="c1"># Add this key to the history</span>
            <span class="n">history</span><span class="p">[</span><span class="s1">&#39;bestSolutionIndex&#39;</span><span class="p">][</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">update</span><span class="p">({</span><span class="n">key</span><span class="p">:(</span><span class="mi">0</span><span class="p">)})</span> <span class="c1"># just one element in the tuple: 0 if no converged solutions, int for best attempt otherwise</span>
            
         <span class="c1"># Check if this key is in the solutionAttempts dictionary</span>
        <span class="k">if</span> <span class="n">key</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">history</span><span class="p">[</span><span class="s1">&#39;solutionAttempts&#39;</span><span class="p">][</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
            <span class="c1"># Add this key to the history</span>
            <span class="n">history</span><span class="p">[</span><span class="s1">&#39;solutionAttempts&#39;</span><span class="p">][</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">update</span><span class="p">({</span><span class="n">key</span><span class="p">:(</span><span class="mi">0</span><span class="p">)})</span> <span class="c1"># just one element in the tuple: number of solution attempts</span>
            
        <span class="c1"># how many solution attempts? relevant whether feasible or not</span>
        <span class="n">history</span><span class="p">[</span><span class="s1">&#39;solutionAttempts&#39;</span><span class="p">][</span><span class="o">-</span><span class="mi">1</span><span class="p">][</span><span class="n">key</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span><span class="n">new_box</span><span class="o">.</span><span class="n">number_of_solution_attempts</span><span class="p">)</span>
        
        <span class="c1"># Check if this case converged</span>
        <span class="k">if</span> <span class="n">new_box</span><span class="o">.</span><span class="n">converged</span><span class="p">:</span>
            <span class="c1"># did the first solution attempt converge?</span>
            <span class="n">history</span><span class="p">[</span><span class="s1">&#39;firstSolveFeasible&#39;</span><span class="p">][</span><span class="o">-</span><span class="mi">1</span><span class="p">][</span><span class="n">key</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span><span class="n">new_box</span><span class="o">.</span><span class="n">first_nlp_solve_feasible</span><span class="p">)</span>
            
            <span class="c1"># what was the solution attempt index of the best solution found?</span>
            <span class="n">history</span><span class="p">[</span><span class="s1">&#39;bestSolutionIndex&#39;</span><span class="p">][</span><span class="o">-</span><span class="mi">1</span><span class="p">][</span><span class="n">key</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span><span class="n">new_box</span><span class="o">.</span><span class="n">solution_attempt_index_that_produced_best_feasible_solution</span><span class="p">)</span>
    
            <span class="c1"># Check if this is the first iteration</span>
            <span class="k">if</span> <span class="n">PEATSAorder</span><span class="o">.</span><span class="n">iteration</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
                <span class="c1"># It is. </span>
            
                <span class="c1"># Check if there is already a converged case</span>
                <span class="k">if</span> <span class="n">history</span><span class="p">[</span><span class="s1">&#39;objective&#39;</span><span class="p">][</span><span class="o">-</span><span class="mi">1</span><span class="p">][</span><span class="n">key</span><span class="p">][</span><span class="mi">0</span><span class="p">]:</span>
                    <span class="c1"># There is. </span>
                    
                    <span class="c1">#Check if this one did better</span>
                    <span class="k">if</span> <span class="n">PEATSAorder</span><span class="o">.</span><span class="n">max_or_min</span> <span class="o">==</span> <span class="s2">&quot;min&quot;</span> <span class="ow">and</span> <span class="n">history</span><span class="p">[</span><span class="s1">&#39;objective&#39;</span><span class="p">][</span><span class="o">-</span><span class="mi">1</span><span class="p">][</span><span class="n">key</span><span class="p">][</span><span class="mi">1</span><span class="p">]</span> <span class="o">&gt;</span> <span class="n">new_box</span><span class="o">.</span><span class="n">objective_value</span><span class="p">:</span>
                        <span class="c1"># It did. Update the tuple</span>
                        <span class="n">history</span><span class="p">[</span><span class="s1">&#39;objective&#39;</span><span class="p">][</span><span class="o">-</span><span class="mi">1</span><span class="p">][</span><span class="n">key</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="n">new_box</span><span class="o">.</span><span class="n">objective_value</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">)</span>
                    <span class="k">elif</span> <span class="n">PEATSAorder</span><span class="o">.</span><span class="n">max_or_min</span> <span class="o">==</span> <span class="s2">&quot;max&quot;</span> <span class="ow">and</span> <span class="n">history</span><span class="p">[</span><span class="s1">&#39;objective&#39;</span><span class="p">][</span><span class="o">-</span><span class="mi">1</span><span class="p">][</span><span class="n">key</span><span class="p">][</span><span class="mi">1</span><span class="p">]</span> <span class="o">&lt;</span> <span class="n">new_box</span><span class="o">.</span><span class="n">objective_value</span><span class="p">:</span>
                        <span class="c1"># It did. Update the tuple</span>
                        <span class="n">history</span><span class="p">[</span><span class="s1">&#39;objective&#39;</span><span class="p">][</span><span class="o">-</span><span class="mi">1</span><span class="p">][</span><span class="n">key</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="n">new_box</span><span class="o">.</span><span class="n">objective_value</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">)</span>
                        
                <span class="c1"># Check if this case converged</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="c1"># It did. Update the history</span>
                    <span class="n">history</span><span class="p">[</span><span class="s1">&#39;objective&#39;</span><span class="p">][</span><span class="o">-</span><span class="mi">1</span><span class="p">][</span><span class="n">key</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="n">new_box</span><span class="o">.</span><span class="n">objective_value</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">)</span>
            <span class="c1"># This is not the first iteration, so we have to compare to previous iterations</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="c1"># Check if this case has been converged before</span>
                <span class="k">if</span> <span class="n">history</span><span class="p">[</span><span class="s1">&#39;objective&#39;</span><span class="p">][</span><span class="o">-</span><span class="mi">2</span><span class="p">][</span><span class="n">key</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
                    <span class="c1"># It has not.                 </span>
                    
                    <span class="c1"># Make sure something better form this iteration isnt already in there</span>
                    <span class="k">if</span> <span class="n">history</span><span class="p">[</span><span class="s1">&#39;objective&#39;</span><span class="p">][</span><span class="o">-</span><span class="mi">1</span><span class="p">][</span><span class="n">key</span><span class="p">][</span><span class="mi">0</span><span class="p">]:</span>     
                        <span class="c1">#Check if this one did better</span>
                        <span class="k">if</span> <span class="n">PEATSAorder</span><span class="o">.</span><span class="n">max_or_min</span> <span class="o">==</span> <span class="s2">&quot;min&quot;</span> <span class="ow">and</span> <span class="n">history</span><span class="p">[</span><span class="s1">&#39;objective&#39;</span><span class="p">][</span><span class="o">-</span><span class="mi">1</span><span class="p">][</span><span class="n">key</span><span class="p">][</span><span class="mi">1</span><span class="p">]</span> <span class="o">&gt;</span> <span class="n">new_box</span><span class="o">.</span><span class="n">objective_value</span><span class="p">:</span>
                            <span class="c1"># It did. Update the tuple</span>
                            <span class="n">history</span><span class="p">[</span><span class="s1">&#39;objective&#39;</span><span class="p">][</span><span class="o">-</span><span class="mi">1</span><span class="p">][</span><span class="n">key</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="n">new_box</span><span class="o">.</span><span class="n">objective_value</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">)</span>
                        <span class="k">elif</span> <span class="n">PEATSAorder</span><span class="o">.</span><span class="n">max_or_min</span> <span class="o">==</span> <span class="s2">&quot;max&quot;</span> <span class="ow">and</span> <span class="n">history</span><span class="p">[</span><span class="s1">&#39;objective&#39;</span><span class="p">][</span><span class="o">-</span><span class="mi">1</span><span class="p">][</span><span class="n">key</span><span class="p">][</span><span class="mi">1</span><span class="p">]</span> <span class="o">&lt;</span> <span class="n">new_box</span><span class="o">.</span><span class="n">objective_value</span><span class="p">:</span>
                            <span class="c1"># It did. Update the tuple</span>
                            <span class="n">history</span><span class="p">[</span><span class="s1">&#39;objective&#39;</span><span class="p">][</span><span class="o">-</span><span class="mi">1</span><span class="p">][</span><span class="n">key</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="n">new_box</span><span class="o">.</span><span class="n">objective_value</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">)</span>           
                    <span class="k">else</span><span class="p">:</span>
                        <span class="c1"># There is not anything in there, so this is certainly better    </span>
                        <span class="n">history</span><span class="p">[</span><span class="s1">&#39;objective&#39;</span><span class="p">][</span><span class="o">-</span><span class="mi">1</span><span class="p">][</span><span class="n">key</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="n">new_box</span><span class="o">.</span><span class="n">objective_value</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">)</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="c1"># It has been converged before. Check if it has improved</span>
                    <span class="k">if</span> <span class="n">PEATSAorder</span><span class="o">.</span><span class="n">max_or_min</span> <span class="o">==</span> <span class="s2">&quot;min&quot;</span> <span class="ow">and</span> <span class="n">history</span><span class="p">[</span><span class="s1">&#39;objective&#39;</span><span class="p">][</span><span class="o">-</span><span class="mi">2</span><span class="p">][</span><span class="n">key</span><span class="p">][</span><span class="mi">1</span><span class="p">]</span> <span class="o">&gt;</span> <span class="n">new_box</span><span class="o">.</span><span class="n">objective_value</span><span class="p">:</span>
                        <span class="c1"># Make sure something better form this iteration isnt already in there</span>
                        <span class="k">if</span> <span class="n">history</span><span class="p">[</span><span class="s1">&#39;objective&#39;</span><span class="p">][</span><span class="o">-</span><span class="mi">1</span><span class="p">][</span><span class="n">key</span><span class="p">][</span><span class="mi">0</span><span class="p">]:</span>     
                            <span class="k">if</span> <span class="n">history</span><span class="p">[</span><span class="s1">&#39;objective&#39;</span><span class="p">][</span><span class="o">-</span><span class="mi">1</span><span class="p">][</span><span class="n">key</span><span class="p">][</span><span class="mi">1</span><span class="p">]</span> <span class="o">&gt;</span> <span class="n">new_box</span><span class="o">.</span><span class="n">objective_value</span><span class="p">:</span>
                                <span class="c1"># It did. Update the tuple</span>
                                <span class="n">history</span><span class="p">[</span><span class="s1">&#39;objective&#39;</span><span class="p">][</span><span class="o">-</span><span class="mi">1</span><span class="p">][</span><span class="n">key</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="n">new_box</span><span class="o">.</span><span class="n">objective_value</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">1</span><span class="p">)</span>           
                        <span class="k">else</span><span class="p">:</span>
                            <span class="c1"># There is not anything in there, so this is certainly better    </span>
                            <span class="n">history</span><span class="p">[</span><span class="s1">&#39;objective&#39;</span><span class="p">][</span><span class="o">-</span><span class="mi">1</span><span class="p">][</span><span class="n">key</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="n">new_box</span><span class="o">.</span><span class="n">objective_value</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">1</span><span class="p">)</span>
                    <span class="k">elif</span> <span class="n">PEATSAorder</span><span class="o">.</span><span class="n">max_or_min</span> <span class="o">==</span> <span class="s2">&quot;max&quot;</span> <span class="ow">and</span> <span class="n">history</span><span class="p">[</span><span class="s1">&#39;objective&#39;</span><span class="p">][</span><span class="o">-</span><span class="mi">2</span><span class="p">][</span><span class="n">key</span><span class="p">][</span><span class="mi">1</span><span class="p">]</span> <span class="o">&lt;</span> <span class="n">new_box</span><span class="o">.</span><span class="n">objective_value</span><span class="p">:</span>
                        <span class="c1"># Make sure something better form this iteration isnt already in there</span>
                        <span class="k">if</span> <span class="n">history</span><span class="p">[</span><span class="s1">&#39;objective&#39;</span><span class="p">][</span><span class="o">-</span><span class="mi">1</span><span class="p">][</span><span class="n">key</span><span class="p">][</span><span class="mi">0</span><span class="p">]:</span>     
                            <span class="k">if</span> <span class="n">history</span><span class="p">[</span><span class="s1">&#39;objective&#39;</span><span class="p">][</span><span class="o">-</span><span class="mi">1</span><span class="p">][</span><span class="n">key</span><span class="p">][</span><span class="mi">1</span><span class="p">]</span> <span class="o">&lt;</span> <span class="n">new_box</span><span class="o">.</span><span class="n">objective_value</span><span class="p">:</span>
                                <span class="c1"># It did. Update the tuple</span>
                                <span class="n">history</span><span class="p">[</span><span class="s1">&#39;objective&#39;</span><span class="p">][</span><span class="o">-</span><span class="mi">1</span><span class="p">][</span><span class="n">key</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="n">new_box</span><span class="o">.</span><span class="n">objective_value</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">1</span><span class="p">)</span>           
                        <span class="k">else</span><span class="p">:</span>
                            <span class="c1"># There is not anything in there, so this is certainly better    </span>
                            <span class="n">history</span><span class="p">[</span><span class="s1">&#39;objective&#39;</span><span class="p">][</span><span class="o">-</span><span class="mi">1</span><span class="p">][</span><span class="n">key</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="n">new_box</span><span class="o">.</span><span class="n">objective_value</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">1</span><span class="p">)</span>
        
        <span class="k">return</span> <span class="n">history</span></div>


<div class="viewcode-block" id="PEATSAbusboy.parse_fun">
<a class="viewcode-back" href="../PEATSA/PEATSAbusboy.html#PEATSAbusboy.PEATSAbusboy.parse_fun">[docs]</a>
    <span class="k">def</span> <span class="nf">parse_fun</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">PEATSAorder</span><span class="p">,</span><span class="n">emtgoptfile</span><span class="p">,</span><span class="n">results_folder</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Description</span>
<span class="sd">        </span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="kn">import</span> <span class="nn">PEATSAbox</span>
        <span class="kn">import</span> <span class="nn">os</span>
        
        <span class="c1"># Get a listing of all the emtgopt files in this directory.</span>
        <span class="c1">#if PEATSAorder.parse_in_parallel:            </span>
        <span class="c1"># Check if this file is in the directory</span>
        <span class="k">if</span> <span class="n">emtgoptfile</span><span class="o">.</span><span class="n">rstrip</span><span class="p">(</span><span class="s2">&quot;opt&quot;</span><span class="p">)</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">emtg_files</span><span class="p">:</span>
            <span class="c1"># It is! Hurray</span>
            <span class="n">emtgfile</span> <span class="o">=</span> <span class="n">emtgoptfile</span><span class="o">.</span><span class="n">rstrip</span><span class="p">(</span><span class="s2">&quot;opt&quot;</span><span class="p">)</span>
        <span class="k">elif</span> <span class="s2">&quot;FAILURE_&quot;</span> <span class="o">+</span> <span class="n">emtgoptfile</span><span class="o">.</span><span class="n">rstrip</span><span class="p">(</span><span class="s2">&quot;opt&quot;</span><span class="p">)</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">emtg_files</span><span class="p">:</span>
            <span class="c1"># This case didnt converge, but its in here</span>
            <span class="n">emtgfile</span> <span class="o">=</span> <span class="s2">&quot;FAILURE_&quot;</span> <span class="o">+</span> <span class="n">emtgoptfile</span><span class="o">.</span><span class="n">rstrip</span><span class="p">(</span><span class="s2">&quot;opt&quot;</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="c1"># Huh. Weird. Couldnt find the file. Lets just create fake one</span>
            <span class="n">emtgfile</span> <span class="o">=</span> <span class="s2">&quot;FAILURE_fake.emtg&quot;</span>

        <span class="c1"># else:</span>
            <span class="c1"># emtg_files = [file for file in os.listdir(results_folder) if file.endswith(&#39;.emtg&#39;)]</span>
            
            <span class="c1"># # Check if this file is in the directory</span>
            <span class="c1"># if emtgoptfile.rstrip(&quot;opt&quot;) in emtg_files:</span>
                <span class="c1"># # It is! Hurray</span>
                <span class="c1"># emtgfile = emtgoptfile.rstrip(&quot;opt&quot;)</span>
            <span class="c1"># elif &quot;FAILURE_&quot; + emtgoptfile.rstrip(&quot;opt&quot;) in emtg_files:</span>
                <span class="c1"># # This case didnt converge, but its in here</span>
                <span class="c1"># emtgfile = &quot;FAILURE_&quot; + emtgoptfile.rstrip(&quot;opt&quot;)</span>
            <span class="c1"># else:</span>
                <span class="c1"># # Huh. Weird. Couldnt find the file. Lets just create fake one</span>
                <span class="c1"># emtgfile = &quot;FAILURE_fake.emtg&quot;</span>

        <span class="c1"># Initialize a new peatsa box object for this directory</span>
        <span class="n">case</span> <span class="o">=</span> <span class="n">PEATSAbox</span><span class="o">.</span><span class="n">PEATSAbox</span><span class="p">(</span><span class="n">PEATSAorder</span><span class="p">,</span><span class="n">results_folder</span><span class="p">,</span><span class="n">emtgoptfile</span><span class="p">,</span><span class="n">emtgfile</span><span class="p">)</span>

        <span class="c1"># return the box</span>
        <span class="k">return</span> <span class="n">case</span></div>

    
<div class="viewcode-block" id="PEATSAbusboy.parse_fun_read_only">
<a class="viewcode-back" href="../PEATSA/PEATSAbusboy.html#PEATSAbusboy.PEATSAbusboy.parse_fun_read_only">[docs]</a>
    <span class="k">def</span> <span class="nf">parse_fun_read_only</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">PEATSAorder</span><span class="p">,</span><span class="n">emtgoptfile</span><span class="p">,</span><span class="n">results_folder</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Description</span>
<span class="sd">        </span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="kn">import</span> <span class="nn">PEATSAbox</span>
        <span class="kn">import</span> <span class="nn">os</span>
        
        <span class="c1"># Get a listing of all the emtgopt files in this directory.</span>
        <span class="c1">#if PEATSAorder.parse_in_parallel:            </span>
        <span class="c1"># Check if this file is in the directory</span>
        <span class="k">if</span> <span class="n">emtgoptfile</span><span class="o">.</span><span class="n">rstrip</span><span class="p">(</span><span class="s2">&quot;opt&quot;</span><span class="p">)</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">emtg_files</span><span class="p">:</span>
            <span class="c1"># It is! Hurray</span>
            <span class="n">emtgfile</span> <span class="o">=</span> <span class="n">emtgoptfile</span><span class="o">.</span><span class="n">rstrip</span><span class="p">(</span><span class="s2">&quot;opt&quot;</span><span class="p">)</span>
        <span class="k">elif</span> <span class="s2">&quot;FAILURE_&quot;</span> <span class="o">+</span> <span class="n">emtgoptfile</span><span class="o">.</span><span class="n">rstrip</span><span class="p">(</span><span class="s2">&quot;opt&quot;</span><span class="p">)</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">emtg_files</span><span class="p">:</span>
            <span class="c1"># This case didnt converge, but its in here</span>
            <span class="n">emtgfile</span> <span class="o">=</span> <span class="s2">&quot;FAILURE_&quot;</span> <span class="o">+</span> <span class="n">emtgoptfile</span><span class="o">.</span><span class="n">rstrip</span><span class="p">(</span><span class="s2">&quot;opt&quot;</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="c1"># Huh. Weird. Couldnt find the file. Lets just create fake one</span>
            <span class="n">emtgfile</span> <span class="o">=</span> <span class="s2">&quot;FAILURE_fake.emtg&quot;</span>

        <span class="c1"># else:</span>
            <span class="c1"># emtg_files = [file for file in os.listdir(results_folder) if file.endswith(&#39;.emtg&#39;)]</span>
            
            <span class="c1"># # Check if this file is in the directory</span>
            <span class="c1"># if emtgoptfile.rstrip(&quot;opt&quot;) in emtg_files:</span>
                <span class="c1"># # It is! Hurray</span>
                <span class="c1"># emtgfile = emtgoptfile.rstrip(&quot;opt&quot;)</span>
            <span class="c1"># elif &quot;FAILURE_&quot; + emtgoptfile.rstrip(&quot;opt&quot;) in emtg_files:</span>
                <span class="c1"># # This case didnt converge, but its in here</span>
                <span class="c1"># emtgfile = &quot;FAILURE_&quot; + emtgoptfile.rstrip(&quot;opt&quot;)</span>
            <span class="c1"># else:</span>
                <span class="c1"># # Huh. Weird. Couldnt find the file. Lets just create fake one</span>
                <span class="c1"># emtgfile = &quot;FAILURE_fake.emtg&quot;</span>

        <span class="c1"># Initialize a new peatsa box object for this directory</span>
        <span class="c1"># read only, don&#39;t parse!</span>
        <span class="n">case</span> <span class="o">=</span> <span class="n">PEATSAbox</span><span class="o">.</span><span class="n">PEATSAbox</span><span class="p">(</span><span class="n">PEATSAorder</span><span class="p">,</span><span class="n">results_folder</span><span class="p">,</span><span class="n">emtgoptfile</span><span class="p">,</span><span class="n">emtgfile</span><span class="p">,</span><span class="n">initializationType</span> <span class="o">=</span> <span class="mi">1</span><span class="p">)</span>

        <span class="c1"># return the box</span>
        <span class="k">return</span> <span class="n">case</span></div>

    
<div class="viewcode-block" id="PEATSAbusboy.parse_fun_after_reading">
<a class="viewcode-back" href="../PEATSA/PEATSAbusboy.html#PEATSAbusboy.PEATSAbusboy.parse_fun_after_reading">[docs]</a>
    <span class="k">def</span> <span class="nf">parse_fun_after_reading</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">PEATSAorder</span><span class="p">,</span><span class="n">PEATSAbox</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Call this only after parse_fun_read_only() has been called on a given PEATSAbox</span>
<span class="sd">        </span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="kn">import</span> <span class="nn">PEATSAbox</span>
        <span class="kn">import</span> <span class="nn">os</span>
        
        <span class="n">case</span> <span class="o">=</span> <span class="n">PEATSAbox</span><span class="o">.</span><span class="n">initializeAfterReading</span><span class="p">(</span><span class="n">PEATSAorder</span><span class="p">)</span>

        <span class="c1"># return the box</span>
        <span class="k">return</span> <span class="n">case</span></div>


<div class="viewcode-block" id="PEATSAbusboy.sort_and_filter">
<a class="viewcode-back" href="../PEATSA/PEATSAbusboy.html#PEATSAbusboy.PEATSAbusboy.sort_and_filter">[docs]</a>
    <span class="k">def</span> <span class="nf">sort_and_filter</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">PEATSAorder</span><span class="p">,</span><span class="n">PEATSAboxes</span><span class="p">,</span><span class="n">idx</span> <span class="o">=</span> <span class="mi">0</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Description.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        PEATSAorder : TYPE</span>
<span class="sd">            DESCRIPTION.</span>
<span class="sd">        PEATSAboxes : TYPE</span>
<span class="sd">            DESCRIPTION.</span>
<span class="sd">        idx : TYPE, optional</span>
<span class="sd">            DESCRIPTION. The default is 0.</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        temp_cases : TYPE</span>
<span class="sd">            DESCRIPTION.</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="kn">import</span> <span class="nn">sys</span>
        <span class="n">sys</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">PEATSAorder</span><span class="o">.</span><span class="n">emtg_root_directory</span> <span class="o">+</span> <span class="s2">&quot;/PyEMTG&quot;</span><span class="p">)</span>
        <span class="kn">import</span> <span class="nn">MissionOptions</span>
        <span class="kn">import</span> <span class="nn">logging</span>
        <span class="kn">import</span> <span class="nn">PEATSAbox</span>
        <span class="n">logging</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;Sorting Results for Iteration &quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">PEATSAorder</span><span class="o">.</span><span class="n">iteration</span><span class="p">))</span>
        
        <span class="c1"># We want the best case to be first, so when we sort from min to max, we need to multiply</span>
        <span class="c1"># a maximization objective value by negative 1. This is not the objective function as evaluate</span>
        <span class="c1"># in EMTG, we are defining our own. </span>
        <span class="k">if</span> <span class="n">PEATSAorder</span><span class="o">.</span><span class="n">max_or_min</span> <span class="o">==</span> <span class="s2">&quot;max&quot;</span><span class="p">:</span>
            <span class="n">sign</span> <span class="o">=</span> <span class="o">-</span><span class="mi">1</span>
        <span class="k">elif</span> <span class="n">PEATSAorder</span><span class="o">.</span><span class="n">max_or_min</span> <span class="o">==</span> <span class="s2">&quot;min&quot;</span><span class="p">:</span>
            <span class="n">sign</span> <span class="o">=</span> <span class="mi">1</span>
       
        <span class="c1"># Get the seed criteria</span>
        <span class="n">sort_criteria</span> <span class="o">=</span> <span class="n">PEATSAorder</span><span class="o">.</span><span class="n">seed_criteria</span><span class="p">[</span><span class="n">idx</span><span class="p">]</span> 

        <span class="c1"># Sort based on the fingerprint, and the objective value. if even the objective value is the same then put put the older case first (the one with the lesser value of first_iteration)</span>
        <span class="n">PEATSAboxes</span> <span class="o">=</span> <span class="nb">sorted</span><span class="p">(</span><span class="n">PEATSAboxes</span><span class="p">,</span> <span class="n">key</span> <span class="o">=</span> <span class="k">lambda</span> <span class="n">box</span><span class="p">:</span> <span class="n">box</span><span class="o">.</span><span class="n">fingerprint</span><span class="p">[</span><span class="n">sort_criteria</span><span class="p">[</span><span class="mi">0</span><span class="p">]]</span> <span class="o">+</span> <span class="p">(</span><span class="n">sign</span><span class="o">*</span><span class="n">box</span><span class="o">.</span><span class="n">objective_value</span><span class="p">,</span><span class="o">-</span><span class="n">box</span><span class="o">.</span><span class="n">iteration</span><span class="p">))</span>
        
        <span class="n">logging</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;Filtering out sub-optimal cases with the same fingerprint&quot;</span><span class="p">)</span>
        
        <span class="c1"># Initialize the new filtered list</span>
        <span class="n">temp_cases</span> <span class="o">=</span> <span class="p">[</span><span class="n">PEATSAboxes</span><span class="p">[</span><span class="mi">0</span><span class="p">]]</span>

        <span class="c1"># get the last fingerprint to be added to the stack </span>
        <span class="n">last_fingerprint</span> <span class="o">=</span> <span class="n">PEATSAboxes</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">fingerprint</span><span class="p">[</span><span class="n">sort_criteria</span><span class="p">[</span><span class="mi">0</span><span class="p">]]</span>
        
        <span class="c1"># Loop through all the cases</span>
        <span class="kn">import</span> <span class="nn">os</span>
        <span class="k">for</span> <span class="n">box</span> <span class="ow">in</span> <span class="n">PEATSAboxes</span><span class="p">:</span>
            
            <span class="c1"># Get the fingerprint of this case</span>
            <span class="n">current_fingerprint</span> <span class="o">=</span> <span class="n">box</span><span class="o">.</span><span class="n">fingerprint</span><span class="p">[</span><span class="n">sort_criteria</span><span class="p">[</span><span class="mi">0</span><span class="p">]]</span>
            
            <span class="c1"># Check if it is a new fingerprint. If it is new, then</span>
            <span class="c1"># it will be added to the new stack. If it is not new, it</span>
            <span class="c1"># is going to get thrown away      </span>
            <span class="k">if</span> <span class="n">current_fingerprint</span> <span class="o">!=</span> <span class="n">last_fingerprint</span><span class="p">:</span>
                <span class="c1"># It is new!</span>

                <span class="c1"># add this case to the stack</span>
                <span class="n">temp_cases</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">box</span><span class="p">)</span>
                
                <span class="c1"># Update the last fingerprint </span>
                <span class="n">last_fingerprint</span> <span class="o">=</span> <span class="n">current_fingerprint</span>
                
                <span class="c1">#logging.info(&quot;busboy kept &quot; + box.PEATSApath + box.PEATSAcrust_path)</span>
                <span class="c1">#logging.info(&quot;busboy kept &quot; + box.PEATSApath + box.PEATSAdough_path)</span>
            
            <span class="k">if</span> <span class="n">box</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">temp_cases</span><span class="p">:</span>
                <span class="c1">#logging.info(&quot;busboy did not keep &quot; + box.PEATSApath + box.PEATSAcrust_path)</span>
                <span class="c1">#logging.info(&quot;busboy did not keep &quot; + box.PEATSApath + box.PEATSAdough_path)</span>
                
                <span class="k">if</span> <span class="n">PEATSAorder</span><span class="o">.</span><span class="n">keep_only_current_and_previous</span><span class="p">:</span>
                    <span class="c1"># straight-up delete the files of ones that are not kept</span>

                    <span class="c1"># delete the .emtg, .emtgopt, and .emtg_spacecraftopt from results</span>
                    <span class="k">if</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="n">PEATSAorder</span><span class="o">.</span><span class="n">working_directory</span> <span class="o">+</span> <span class="s1">&#39;results/&#39;</span> <span class="o">+</span> <span class="n">box</span><span class="o">.</span><span class="n">PEATSAcrust_path</span><span class="p">):</span>
                        <span class="n">os</span><span class="o">.</span><span class="n">remove</span><span class="p">(</span><span class="n">PEATSAorder</span><span class="o">.</span><span class="n">working_directory</span> <span class="o">+</span> <span class="s1">&#39;results/&#39;</span> <span class="o">+</span> <span class="n">box</span><span class="o">.</span><span class="n">PEATSAcrust_path</span><span class="p">)</span>
                        <span class="c1">#logging.info(&quot;busboy removed &quot; + box.PEATSApath + box.PEATSAcrust_path)</span>
                    <span class="k">if</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="n">PEATSAorder</span><span class="o">.</span><span class="n">working_directory</span> <span class="o">+</span> <span class="s1">&#39;results/&#39;</span> <span class="o">+</span> <span class="n">box</span><span class="o">.</span><span class="n">PEATSAdough_path</span><span class="p">):</span>
                        <span class="n">os</span><span class="o">.</span><span class="n">remove</span><span class="p">(</span><span class="n">PEATSAorder</span><span class="o">.</span><span class="n">working_directory</span> <span class="o">+</span> <span class="s1">&#39;results/&#39;</span> <span class="o">+</span> <span class="n">box</span><span class="o">.</span><span class="n">PEATSAdough_path</span><span class="p">)</span>
                        <span class="c1">#logging.info(&quot;busboy removed &quot; + box.PEATSApath + box.PEATSAdough_path)</span>

                    <span class="c1"># use the emtgopt (dough) path instead of the emtg (crust) path</span>
                    <span class="c1"># because the emtg name might be FAILURE_fake, which is NOT the name of the spacecraft options file</span>
                    <span class="n">spacecraftoptFile</span> <span class="o">=</span> <span class="n">PEATSAorder</span><span class="o">.</span><span class="n">working_directory</span> <span class="o">+</span> <span class="s1">&#39;results/&#39;</span> <span class="o">+</span> <span class="n">box</span><span class="o">.</span><span class="n">PEATSAdough_path</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s1">&#39;.emtgopt&#39;</span><span class="p">,</span> <span class="s1">&#39;.emtg_spacecraftopt&#39;</span><span class="p">)</span>
                    <span class="c1">#logging.info(&quot;want to remove &quot; + spacecraftoptFile)</span>
                    <span class="k">if</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="n">spacecraftoptFile</span><span class="p">):</span>
                        <span class="n">os</span><span class="o">.</span><span class="n">remove</span><span class="p">(</span><span class="n">spacecraftoptFile</span><span class="p">)</span>
                        <span class="c1">#logging.info(&quot;busboy removed &quot; + spacecraftoptFile)</span>
                        
                    <span class="c1"># delete the .emtgopt from cases directory</span>
                    <span class="n">base_cases_dir</span> <span class="o">=</span> <span class="n">PEATSAorder</span><span class="o">.</span><span class="n">working_directory</span> <span class="o">+</span> <span class="s1">&#39;cases/&#39;</span>
                    <span class="k">if</span> <span class="s2">&quot;Previous&quot;</span> <span class="ow">in</span> <span class="n">box</span><span class="o">.</span><span class="n">PEATSApath</span><span class="p">:</span>
                        <span class="n">emtgoptFile</span> <span class="o">=</span> <span class="n">base_cases_dir</span> <span class="o">+</span> <span class="s2">&quot;IterationPrevious/&quot;</span> <span class="o">+</span> <span class="n">box</span><span class="o">.</span><span class="n">PEATSAdough_path</span>
                    <span class="k">else</span><span class="p">:</span>
                        <span class="n">emtgoptFile</span> <span class="o">=</span> <span class="n">base_cases_dir</span> <span class="o">+</span> <span class="s2">&quot;IterationCurrent/&quot;</span> <span class="o">+</span> <span class="n">box</span><span class="o">.</span><span class="n">PEATSAdough_path</span>
                    <span class="c1">#logging.info(&quot;want to remove &quot; + emtgoptFile)</span>
                    <span class="k">if</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="n">emtgoptFile</span><span class="p">):</span>
                        <span class="n">os</span><span class="o">.</span><span class="n">remove</span><span class="p">(</span><span class="n">emtgoptFile</span><span class="p">)</span>
                        <span class="c1">#logging.info(&quot;busboy removed &quot; + emtgoptFile)</span>
                
            
        <span class="c1"># All done, return the result</span>
        <span class="k">return</span> <span class="n">temp_cases</span></div>

        
<div class="viewcode-block" id="PEATSAbusboy.write_to_csv">
<a class="viewcode-back" href="../PEATSA/PEATSAbusboy.html#PEATSAbusboy.PEATSAbusboy.write_to_csv">[docs]</a>
    <span class="k">def</span> <span class="nf">write_to_csv</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">PEATSAorder</span><span class="p">,</span><span class="n">PEATSAboxes</span><span class="p">,</span><span class="n">history</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Writes the .csv summary file for each iteration.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        PEATSAorder : TYPE</span>
<span class="sd">            DESCRIPTION.</span>
<span class="sd">        PEATSAboxes : TYPE</span>
<span class="sd">            DESCRIPTION.</span>
<span class="sd">        history : TYPE, optional</span>
<span class="sd">            DESCRIPTION. The default is None.</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        None.</span>

<span class="sd">        &quot;&quot;&quot;</span>
        
        <span class="kn">import</span> <span class="nn">sys</span>
        <span class="n">sys</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">PEATSAorder</span><span class="o">.</span><span class="n">emtg_root_directory</span> <span class="o">+</span> <span class="s2">&quot;/PyEMTG&quot;</span><span class="p">)</span>
        <span class="kn">import</span> <span class="nn">MissionOptions</span>
        <span class="kn">import</span> <span class="nn">logging</span>
        <span class="kn">import</span> <span class="nn">PEATSAbox</span>
        <span class="n">logging</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;Writing Results for Iteration &quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">PEATSAorder</span><span class="o">.</span><span class="n">iteration</span><span class="p">))</span>
        
        <span class="c1"># Open a handle to the file</span>
        <span class="n">csv_file_handle</span> <span class="o">=</span> <span class="nb">open</span><span class="p">(</span><span class="n">PEATSAorder</span><span class="o">.</span><span class="n">csv_file</span><span class="p">,</span><span class="s1">&#39;w&#39;</span><span class="p">)</span>

        <span class="c1"># Write the constant headers</span>
        <span class="n">csv_file_handle</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s2">&quot;Folder,Filename,Mission Name,Instances Created,Instances Ran,Instances Finished,Instances Converged,First Feasible,Improved,Last Improved Iteration,Seed History,&quot;</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">idx</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">PEATSAorder</span><span class="o">.</span><span class="n">seed_criteria</span><span class="p">)):</span>
            <span class="n">csv_file_handle</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s2">&quot;SeedCriteria &quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">idx</span><span class="p">)</span> <span class="o">+</span> <span class="s2">&quot;,&quot;</span><span class="p">)</span>
        <span class="n">csv_file_handle</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s2">&quot;Final Mass [kg],Flight Time [years],Feasibility,PEATSA objective,First NLP Solve Feasible,First NLP Solve Objective Function Value,Number of Solution Attempts,Best Solution Attempt,&quot;</span><span class="p">)</span>
        
        <span class="c1"># Loop through the user requested columns and add their headers</span>
        <span class="k">for</span> <span class="n">column</span> <span class="ow">in</span> <span class="n">PEATSAorder</span><span class="o">.</span><span class="n">extra_csv_column_definitions</span><span class="p">:</span>
            <span class="n">csv_file_handle</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">column</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">+</span> <span class="s2">&quot;,&quot;</span><span class="p">)</span>
        
        <span class="k">for</span> <span class="n">box</span> <span class="ow">in</span> <span class="n">PEATSAboxes</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">box</span><span class="o">.</span><span class="n">converged</span><span class="p">:</span>        
                <span class="c1"># Always print the fingerprint last</span>
                <span class="k">for</span> <span class="n">idx</span><span class="p">,</span><span class="n">seed_criteria</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">PEATSAorder</span><span class="o">.</span><span class="n">seed_criteria</span><span class="p">):</span>
                    <span class="k">for</span> <span class="n">jdx</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">box</span><span class="o">.</span><span class="n">fingerprint</span><span class="p">[</span><span class="n">seed_criteria</span><span class="p">[</span><span class="mi">0</span><span class="p">]])):</span>
                        <span class="n">csv_file_handle</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s2">&quot;S&quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">idx</span><span class="p">)</span> <span class="o">+</span> <span class="s2">&quot;F&quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">jdx</span><span class="p">)</span> <span class="o">+</span> <span class="s2">&quot;,&quot;</span><span class="p">)</span>
                <span class="k">break</span>
            
        <span class="c1"># End the header line</span>
        <span class="n">csv_file_handle</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>

        <span class="c1"># Loop through all the cases</span>
        <span class="k">for</span> <span class="n">box</span> <span class="ow">in</span> <span class="n">PEATSAboxes</span><span class="p">:</span>
            <span class="c1"># Write the constant data</span>
            <span class="n">csv_file_handle</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">box</span><span class="o">.</span><span class="n">PEATSApath</span> <span class="o">+</span> <span class="s2">&quot;,&quot;</span><span class="p">)</span>
            <span class="n">csv_file_handle</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">box</span><span class="o">.</span><span class="n">PEATSAcrust_path</span> <span class="o">+</span> <span class="s2">&quot;,&quot;</span><span class="p">)</span>
            <span class="n">csv_file_handle</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">box</span><span class="o">.</span><span class="n">mission_name</span> <span class="o">+</span> <span class="s2">&quot;,&quot;</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">history</span><span class="o">==</span><span class="kc">None</span><span class="p">:</span>
                <span class="n">csv_file_handle</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s2">&quot;N/A,N/A,N/A,N/A,N/A,N/A,N/A,N/A,&quot;</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">key</span> <span class="o">=</span> <span class="n">box</span><span class="o">.</span><span class="n">mission_name</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;_seeded_by&quot;</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;_v&quot;</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>
                <span class="k">if</span> <span class="n">key</span> <span class="ow">in</span> <span class="n">history</span><span class="p">[</span><span class="s2">&quot;seed&quot;</span><span class="p">][</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
                    <span class="n">csv_file_handle</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">history</span><span class="p">[</span><span class="s1">&#39;seed&#39;</span><span class="p">][</span><span class="o">-</span><span class="mi">1</span><span class="p">][</span><span class="n">key</span><span class="p">]))</span> <span class="o">+</span> <span class="s2">&quot;,&quot;</span><span class="p">)</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">csv_file_handle</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s2">&quot;N/A,&quot;</span><span class="p">)</span>
                <span class="k">if</span> <span class="n">key</span> <span class="ow">in</span> <span class="n">history</span><span class="p">[</span><span class="s2">&quot;run&quot;</span><span class="p">][</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
                    <span class="n">csv_file_handle</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">history</span><span class="p">[</span><span class="s1">&#39;run&#39;</span><span class="p">][</span><span class="o">-</span><span class="mi">1</span><span class="p">][</span><span class="n">key</span><span class="p">]))</span> <span class="o">+</span> <span class="s2">&quot;,&quot;</span><span class="p">)</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">csv_file_handle</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s2">&quot;N/A,&quot;</span><span class="p">)</span>
                <span class="n">numFinished</span> <span class="o">=</span> <span class="mi">0</span>
                <span class="n">numConverged</span> <span class="o">=</span> <span class="mi">0</span>
                <span class="k">if</span> <span class="n">key</span> <span class="ow">in</span> <span class="n">history</span><span class="p">[</span><span class="s2">&quot;run&quot;</span><span class="p">][</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
                    <span class="k">for</span> <span class="n">instance</span> <span class="ow">in</span> <span class="n">history</span><span class="p">[</span><span class="s1">&#39;run&#39;</span><span class="p">][</span><span class="n">PEATSAorder</span><span class="o">.</span><span class="n">iteration</span><span class="p">][</span><span class="n">key</span><span class="p">]:</span>
                        <span class="k">if</span> <span class="n">instance</span><span class="p">[</span><span class="mi">0</span><span class="p">]:</span>
                            <span class="n">numFinished</span> <span class="o">+=</span> <span class="mi">1</span>
                        <span class="k">if</span> <span class="n">instance</span><span class="p">[</span><span class="mi">1</span><span class="p">]:</span>
                            <span class="n">numConverged</span> <span class="o">+=</span> <span class="mi">1</span>
                <span class="n">csv_file_handle</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">numFinished</span><span class="p">)</span> <span class="o">+</span> <span class="s2">&quot;,&quot;</span><span class="p">)</span>
                <span class="n">csv_file_handle</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">numConverged</span><span class="p">)</span> <span class="o">+</span> <span class="s2">&quot;,&quot;</span><span class="p">)</span>
                <span class="n">csv_file_handle</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">history</span><span class="p">[</span><span class="s1">&#39;objective&#39;</span><span class="p">][</span><span class="o">-</span><span class="mi">1</span><span class="p">][</span><span class="n">key</span><span class="p">][</span><span class="mi">2</span><span class="p">])</span> <span class="o">+</span> <span class="s2">&quot;,&quot;</span><span class="p">)</span>
                <span class="n">csv_file_handle</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">history</span><span class="p">[</span><span class="s1">&#39;objective&#39;</span><span class="p">][</span><span class="o">-</span><span class="mi">1</span><span class="p">][</span><span class="n">key</span><span class="p">][</span><span class="mi">3</span><span class="p">])</span> <span class="o">+</span> <span class="s2">&quot;,&quot;</span><span class="p">)</span>
                <span class="n">csv_file_handle</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">box</span><span class="o">.</span><span class="n">iteration</span><span class="p">)</span> <span class="o">+</span> <span class="s2">&quot;,&quot;</span><span class="p">)</span>
                
                <span class="n">seed_code</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span>
                <span class="k">if</span> <span class="n">key</span> <span class="ow">in</span> <span class="n">history</span><span class="p">[</span><span class="s2">&quot;seed&quot;</span><span class="p">][</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
                    <span class="k">for</span> <span class="n">entry</span> <span class="ow">in</span> <span class="n">history</span><span class="p">[</span><span class="s2">&quot;seed&quot;</span><span class="p">][</span><span class="o">-</span><span class="mi">1</span><span class="p">][</span><span class="n">key</span><span class="p">]:</span>
                        <span class="k">if</span> <span class="n">entry</span> <span class="o">==</span> <span class="kc">None</span><span class="p">:</span>
                            <span class="n">seed_code</span> <span class="o">+=</span> <span class="s2">&quot;0&quot;</span>
                        <span class="k">else</span><span class="p">:</span>
                            <span class="n">times_using_seed</span> <span class="o">=</span> <span class="mi">1</span>
                            <span class="k">if</span> <span class="n">PEATSAorder</span><span class="o">.</span><span class="n">iteration</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
                                <span class="k">for</span> <span class="n">iter_idx</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span><span class="n">PEATSAorder</span><span class="o">.</span><span class="n">iteration</span><span class="o">+</span><span class="mi">1</span><span class="p">):</span>
                                    <span class="k">if</span> <span class="n">key</span> <span class="ow">in</span> <span class="n">history</span><span class="p">[</span><span class="s2">&quot;seed&quot;</span><span class="p">][</span><span class="o">-</span><span class="n">iter_idx</span><span class="p">]</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
                                        <span class="k">if</span> <span class="n">entry</span> <span class="ow">in</span> <span class="n">history</span><span class="p">[</span><span class="s2">&quot;seed&quot;</span><span class="p">][</span><span class="o">-</span><span class="n">iter_idx</span><span class="p">][</span><span class="n">key</span><span class="p">]:</span>
                                            <span class="n">times_using_seed</span> <span class="o">+=</span> <span class="mi">1</span>
                            <span class="n">seed_code</span> <span class="o">+=</span> <span class="nb">str</span><span class="p">(</span><span class="n">times_using_seed</span><span class="p">)</span>
                <span class="n">csv_file_handle</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">seed_code</span> <span class="o">+</span> <span class="s2">&quot;,&quot;</span><span class="p">)</span>                     
                                
            <span class="k">for</span> <span class="n">seed_criteria</span> <span class="ow">in</span> <span class="n">PEATSAorder</span><span class="o">.</span><span class="n">seed_criteria</span><span class="p">:</span>
                <span class="n">csv_file_handle</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">box</span><span class="o">.</span><span class="n">seed_criteria</span><span class="p">[</span><span class="n">seed_criteria</span><span class="p">[</span><span class="mi">0</span><span class="p">]])</span> <span class="o">+</span> <span class="s2">&quot;,&quot;</span><span class="p">)</span>
            <span class="n">csv_file_handle</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">box</span><span class="o">.</span><span class="n">final_mass</span><span class="p">)</span> <span class="o">+</span> <span class="s2">&quot;,&quot;</span><span class="p">)</span>  
            <span class="n">csv_file_handle</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">box</span><span class="o">.</span><span class="n">time_of_flight</span><span class="p">)</span> <span class="o">+</span> <span class="s2">&quot;,&quot;</span><span class="p">)</span>  
            <span class="n">csv_file_handle</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">box</span><span class="o">.</span><span class="n">feasibility</span><span class="p">)</span> <span class="o">+</span> <span class="s2">&quot;,&quot;</span><span class="p">)</span>
            <span class="n">csv_file_handle</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">box</span><span class="o">.</span><span class="n">objective_value</span><span class="p">)</span> <span class="o">+</span> <span class="s2">&quot;,&quot;</span><span class="p">)</span>
            <span class="n">csv_file_handle</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">box</span><span class="o">.</span><span class="n">first_nlp_solve_feasible</span><span class="p">)</span> <span class="o">+</span> <span class="s2">&quot;,&quot;</span><span class="p">)</span>
            <span class="n">csv_file_handle</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">box</span><span class="o">.</span><span class="n">objective_value_first_nlp_solve</span><span class="p">)</span> <span class="o">+</span> <span class="s2">&quot;,&quot;</span><span class="p">)</span>
            <span class="n">csv_file_handle</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">box</span><span class="o">.</span><span class="n">number_of_solution_attempts</span><span class="p">)</span> <span class="o">+</span> <span class="s2">&quot;,&quot;</span><span class="p">)</span>
            <span class="n">csv_file_handle</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">box</span><span class="o">.</span><span class="n">solution_attempt_index_that_produced_best_feasible_solution</span><span class="p">)</span> <span class="o">+</span> <span class="s2">&quot;,&quot;</span><span class="p">)</span>
                
            <span class="c1"># Print the data for each extra column</span>
            <span class="k">for</span> <span class="n">idx</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">PEATSAorder</span><span class="o">.</span><span class="n">extra_csv_column_definitions</span><span class="p">)):</span>
                <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">box</span><span class="o">.</span><span class="n">extra_csv_column_data</span><span class="p">)</span> <span class="o">&gt;</span> <span class="n">idx</span><span class="p">:</span>
                    <span class="n">csv_file_handle</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">box</span><span class="o">.</span><span class="n">extra_csv_column_data</span><span class="p">[</span><span class="n">idx</span><span class="p">])</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s2">&quot;,&quot;</span><span class="p">,</span> <span class="s2">&quot;|&quot;</span><span class="p">))</span>
                <span class="n">csv_file_handle</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s2">&quot;,&quot;</span><span class="p">)</span>
                
            <span class="c1"># Write the fingerprint. </span>
            <span class="k">for</span> <span class="n">seed_criteria</span> <span class="ow">in</span> <span class="n">PEATSAorder</span><span class="o">.</span><span class="n">seed_criteria</span><span class="p">:</span>
                <span class="k">for</span> <span class="n">val</span> <span class="ow">in</span> <span class="n">box</span><span class="o">.</span><span class="n">fingerprint</span><span class="p">[</span><span class="n">seed_criteria</span><span class="p">[</span><span class="mi">0</span><span class="p">]][:</span><span class="o">-</span><span class="mi">1</span><span class="p">]:</span>
                    <span class="n">csv_file_handle</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">val</span><span class="p">)</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s2">&quot;,&quot;</span><span class="p">,</span> <span class="s2">&quot;|&quot;</span><span class="p">)</span> <span class="o">+</span> <span class="s2">&quot;,&quot;</span><span class="p">)</span>
            
            <span class="c1"># End the line</span>
            <span class="n">csv_file_handle</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>
            
        <span class="c1"># Close the file    </span>
        <span class="n">csv_file_handle</span><span class="o">.</span><span class="n">close</span><span class="p">()</span></div>

    
<div class="viewcode-block" id="PEATSAbusboy.copy_results">
<a class="viewcode-back" href="../PEATSA/PEATSAbusboy.html#PEATSAbusboy.PEATSAbusboy.copy_results">[docs]</a>
    <span class="k">def</span> <span class="nf">copy_results</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">PEATSAorder</span><span class="p">,</span><span class="n">boxes</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Description.</span>
<span class="sd">        </span>
<span class="sd">        &quot;&quot;&quot;</span>
        
        <span class="kn">import</span> <span class="nn">shutil</span>
                
        <span class="c1"># Loop through all of the boxes</span>
        <span class="k">for</span> <span class="n">box</span> <span class="ow">in</span> <span class="n">boxes</span><span class="p">:</span>
            
            <span class="c1"># copy the options file</span>
            <span class="n">shutil</span><span class="o">.</span><span class="n">copyfile</span><span class="p">(</span><span class="n">box</span><span class="o">.</span><span class="n">PEATSApath</span> <span class="o">+</span> <span class="s2">&quot;/&quot;</span> <span class="o">+</span> <span class="n">box</span><span class="o">.</span><span class="n">PEATSAdough_path</span><span class="p">,</span><span class="n">PEATSAorder</span><span class="o">.</span><span class="n">results_directory</span> <span class="o">+</span> <span class="n">box</span><span class="o">.</span><span class="n">PEATSAdough_path</span><span class="p">)</span>
            
            <span class="c1"># If the box has a mission object, copy the file</span>
            <span class="k">if</span> <span class="n">box</span><span class="o">.</span><span class="n">PEATSAcrust_path</span> <span class="o">!=</span> <span class="kc">None</span> <span class="ow">and</span> <span class="n">box</span><span class="o">.</span><span class="n">PEATSAcrust_path</span> <span class="o">!=</span> <span class="s2">&quot;FAILURE_fake.emtg&quot;</span><span class="p">:</span>
                <span class="n">shutil</span><span class="o">.</span><span class="n">copyfile</span><span class="p">(</span><span class="n">box</span><span class="o">.</span><span class="n">PEATSApath</span> <span class="o">+</span> <span class="s2">&quot;/&quot;</span> <span class="o">+</span> <span class="n">box</span><span class="o">.</span><span class="n">PEATSAcrust_path</span><span class="p">,</span><span class="n">PEATSAorder</span><span class="o">.</span><span class="n">results_directory</span> <span class="o">+</span> <span class="n">box</span><span class="o">.</span><span class="n">PEATSAcrust_path</span><span class="p">)</span>
                
            <span class="c1"># Update the locaton of the files    </span>
            <span class="n">box</span><span class="o">.</span><span class="n">PEATSApath</span> <span class="o">=</span> <span class="n">PEATSAorder</span><span class="o">.</span><span class="n">results_directory</span>
            
        <span class="c1"># Send the results back    </span>
        <span class="k">return</span> <span class="n">boxes</span></div>

            
<div class="viewcode-block" id="PEATSAbusboy.write_history_file">
<a class="viewcode-back" href="../PEATSA/PEATSAbusboy.html#PEATSAbusboy.PEATSAbusboy.write_history_file">[docs]</a>
    <span class="k">def</span> <span class="nf">write_history_file</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">PEATSAorder</span><span class="p">,</span><span class="n">history</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Writes/appends to the PEATSAhistory.csv file.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        PEATSAorder : TYPE</span>
<span class="sd">            DESCRIPTION.</span>
<span class="sd">        history : TYPE</span>
<span class="sd">            DESCRIPTION.</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        PEATSAorder : TYPE</span>
<span class="sd">            DESCRIPTION.</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="kn">import</span> <span class="nn">logging</span>
            
        <span class="k">if</span> <span class="n">PEATSAorder</span><span class="o">.</span><span class="n">iteration</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
            
            <span class="n">handle</span> <span class="o">=</span> <span class="nb">open</span><span class="p">(</span><span class="n">PEATSAorder</span><span class="o">.</span><span class="n">csv_file</span><span class="o">.</span><span class="n">rstrip</span><span class="p">(</span><span class="s2">&quot;Iteration1234567890.csv&quot;</span><span class="p">)</span> <span class="o">+</span> <span class="s2">&quot;PEATSAhistory.csv&quot;</span><span class="p">,</span><span class="s2">&quot;w&quot;</span><span class="p">)</span>
        
            <span class="n">handle</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s2">&quot;Iteration,</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>
            <span class="n">handle</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s2">&quot;Cases Created,</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>
            <span class="n">handle</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s2">&quot;Cases Run,</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>
            <span class="n">handle</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s2">&quot;Ran Unseeded,</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>
            <span class="n">handle</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s2">&quot;Cases Finished,</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>
            <span class="n">handle</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s2">&quot;Iteration Cases Converged,</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>
            <span class="n">handle</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s2">&quot;PEATSA Cases Converged,</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>
            <span class="n">handle</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s2">&quot;First Convergence this Iteration,</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>
            <span class="n">handle</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s2">&quot;Improvement this Iteration,</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>
            <span class="n">handle</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s2">&quot;Number of PEATSA Cases That Converged on First NLP Solve This Iteration,</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>
            <span class="n">handle</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s2">&quot;Average Number of Solution Attempts for All Cases This Iteration,</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>
            <span class="n">handle</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s2">&quot;Average Solution Attempt Number of Best Feasible Solution Among all Feasible Cases This Iteration,</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>
            <span class="n">handle</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s2">&quot;Times Using Seed Before Improvement,&quot;</span><span class="p">)</span>
            
            <span class="n">handle</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>            
            
            <span class="n">PEATSAorder</span><span class="o">.</span><span class="n">improvement_tracker</span> <span class="o">=</span> <span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">*</span> <span class="nb">len</span><span class="p">(</span><span class="n">PEATSAorder</span><span class="o">.</span><span class="n">constraint_walking</span><span class="p">)</span>
            
        <span class="n">handle</span> <span class="o">=</span> <span class="nb">open</span><span class="p">(</span><span class="n">PEATSAorder</span><span class="o">.</span><span class="n">csv_file</span><span class="o">.</span><span class="n">rstrip</span><span class="p">(</span><span class="s2">&quot;Iteration1234567890.csv&quot;</span><span class="p">)</span> <span class="o">+</span> <span class="s2">&quot;PEATSAhistory.csv&quot;</span><span class="p">,</span><span class="s2">&quot;r&quot;</span><span class="p">)</span>
    
        <span class="n">current_lines</span> <span class="o">=</span> <span class="n">handle</span><span class="o">.</span><span class="n">readlines</span><span class="p">()</span>
    
        <span class="n">handle</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>       

        <span class="n">old_lines</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="n">improvement_count</span> <span class="o">=</span> <span class="p">[]</span>
    
        <span class="k">for</span> <span class="n">line</span> <span class="ow">in</span> <span class="n">current_lines</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">line</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s2">&quot;Times Using Seed&quot;</span><span class="p">):</span>
                <span class="n">linesplit</span> <span class="o">=</span> <span class="n">line</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;,&quot;</span><span class="p">)</span>
                <span class="k">for</span> <span class="n">entry</span> <span class="ow">in</span> <span class="n">linesplit</span><span class="p">[:</span><span class="o">-</span><span class="mi">1</span><span class="p">]:</span>
                    <span class="k">if</span> <span class="s2">&quot;Times&quot;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">entry</span><span class="p">:</span>
                        <span class="n">improvement_count</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="nb">int</span><span class="p">(</span><span class="n">entry</span><span class="p">))</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">old_lines</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">line</span><span class="o">.</span><span class="n">rstrip</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">))</span>
                
        
        <span class="n">improvement_count</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
        
        <span class="n">case_sum</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="n">unseeded_sum</span> <span class="o">=</span> <span class="mi">0</span>
                
        <span class="k">for</span> <span class="n">key</span> <span class="ow">in</span> <span class="n">history</span><span class="p">[</span><span class="s1">&#39;seed&#39;</span><span class="p">][</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
            <span class="n">case_sum</span> <span class="o">+=</span> <span class="nb">len</span><span class="p">(</span><span class="n">history</span><span class="p">[</span><span class="s1">&#39;seed&#39;</span><span class="p">][</span><span class="o">-</span><span class="mi">1</span><span class="p">][</span><span class="n">key</span><span class="p">])</span>
            <span class="n">unseeded_sum</span> <span class="o">+=</span> <span class="nb">len</span><span class="p">([</span><span class="n">entry</span> <span class="k">for</span> <span class="n">entry</span> <span class="ow">in</span> <span class="n">history</span><span class="p">[</span><span class="s1">&#39;seed&#39;</span><span class="p">][</span><span class="o">-</span><span class="mi">1</span><span class="p">][</span><span class="n">key</span><span class="p">]</span> <span class="k">if</span> <span class="n">entry</span> <span class="o">==</span> <span class="kc">None</span><span class="p">])</span>
            
        <span class="n">run_sum</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="n">finished_sum</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="n">iteration_converged_sum</span> <span class="o">=</span> <span class="mi">0</span>
        
        <span class="k">for</span> <span class="n">key</span> <span class="ow">in</span> <span class="n">history</span><span class="p">[</span><span class="s1">&#39;run&#39;</span><span class="p">][</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
            <span class="n">run_sum</span> <span class="o">+=</span> <span class="nb">len</span><span class="p">(</span><span class="n">history</span><span class="p">[</span><span class="s1">&#39;run&#39;</span><span class="p">][</span><span class="o">-</span><span class="mi">1</span><span class="p">][</span><span class="n">key</span><span class="p">])</span>
            <span class="n">finished_sum</span> <span class="o">+=</span> <span class="nb">len</span><span class="p">([</span><span class="n">entry</span> <span class="k">for</span> <span class="n">entry</span> <span class="ow">in</span> <span class="n">history</span><span class="p">[</span><span class="s1">&#39;run&#39;</span><span class="p">][</span><span class="o">-</span><span class="mi">1</span><span class="p">][</span><span class="n">key</span><span class="p">]</span> <span class="k">if</span> <span class="n">entry</span><span class="p">[</span><span class="mi">0</span><span class="p">]])</span>
            <span class="n">iteration_converged_sum</span> <span class="o">+=</span> <span class="nb">len</span><span class="p">([</span><span class="n">entry</span> <span class="k">for</span> <span class="n">entry</span> <span class="ow">in</span> <span class="n">history</span><span class="p">[</span><span class="s1">&#39;run&#39;</span><span class="p">][</span><span class="o">-</span><span class="mi">1</span><span class="p">][</span><span class="n">key</span><span class="p">]</span> <span class="k">if</span> <span class="n">entry</span><span class="p">[</span><span class="mi">1</span><span class="p">]])</span>
            
            <span class="k">for</span> <span class="n">entry</span> <span class="ow">in</span> <span class="n">history</span><span class="p">[</span><span class="s2">&quot;run&quot;</span><span class="p">][</span><span class="o">-</span><span class="mi">1</span><span class="p">][</span><span class="n">key</span><span class="p">]:</span>
                <span class="k">if</span> <span class="n">entry</span><span class="p">[</span><span class="mi">2</span><span class="p">]:</span>
                    <span class="k">if</span> <span class="n">entry</span><span class="p">[</span><span class="mi">3</span><span class="p">]</span> <span class="o">==</span> <span class="kc">None</span><span class="p">:</span>
                        <span class="n">improvement_count</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">+=</span> <span class="mi">1</span>
                    <span class="k">else</span><span class="p">:</span>
                        <span class="n">times_using_seed</span> <span class="o">=</span> <span class="mi">1</span>
                        <span class="c1"># Check if this is the first iteration or not</span>
                        <span class="k">if</span> <span class="n">PEATSAorder</span><span class="o">.</span><span class="n">iteration</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
                            <span class="c1"># It is not. Loop through the iterations</span>
                            <span class="k">for</span> <span class="n">iter_idx</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span><span class="n">PEATSAorder</span><span class="o">.</span><span class="n">iteration</span><span class="o">+</span><span class="mi">1</span><span class="p">):</span>
                                <span class="c1"># Keep a flag if we need to break out of this loop</span>
                                <span class="n">break_out</span> <span class="o">=</span> <span class="kc">False</span>
                                <span class="c1"># Check if this case was run in the previous iteration</span>
                                <span class="k">if</span> <span class="n">key</span> <span class="ow">in</span> <span class="n">history</span><span class="p">[</span><span class="s2">&quot;seed&quot;</span><span class="p">][</span><span class="o">-</span><span class="n">iter_idx</span><span class="p">]</span><span class="o">.</span><span class="n">keys</span><span class="p">()</span> <span class="ow">and</span> <span class="n">key</span> <span class="ow">in</span> <span class="n">history</span><span class="p">[</span><span class="s2">&quot;run&quot;</span><span class="p">][</span><span class="o">-</span><span class="n">iter_idx</span><span class="p">]</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
                                    <span class="c1"># It was. Check if the seed was used in the previous iteration</span>
                                    <span class="k">if</span> <span class="n">entry</span><span class="p">[</span><span class="mi">3</span><span class="p">]</span> <span class="ow">in</span> <span class="n">history</span><span class="p">[</span><span class="s2">&quot;seed&quot;</span><span class="p">][</span><span class="o">-</span><span class="n">iter_idx</span><span class="p">][</span><span class="n">key</span><span class="p">]:</span>
                                        <span class="c1"># It was. Loop through the run history from that iteration</span>
                                        <span class="k">for</span> <span class="n">prev_entry</span> <span class="ow">in</span> <span class="n">history</span><span class="p">[</span><span class="s2">&quot;run&quot;</span><span class="p">][</span><span class="o">-</span><span class="n">iter_idx</span><span class="p">][</span><span class="n">key</span><span class="p">]:</span>
                                            <span class="c1"># Check if this run is the one with the relevant seed</span>
                                            <span class="k">if</span> <span class="n">prev_entry</span><span class="p">[</span><span class="mi">3</span><span class="p">]</span> <span class="o">==</span> <span class="n">entry</span><span class="p">[</span><span class="mi">3</span><span class="p">]:</span>
                                                <span class="c1"># It is. Check if the run from the previous generation usign this seed improved</span>
                                                <span class="k">if</span> <span class="n">prev_entry</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
                                                    <span class="c1"># It didnt improve but it also didnt finish, so dont increment the counter, but dont stop searching backwards</span>
                                                    <span class="k">pass</span>
                                                <span class="k">elif</span> <span class="n">prev_entry</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
                                                    <span class="c1"># IT did not. Increment the counter</span>
                                                    <span class="n">times_using_seed</span> <span class="o">+=</span> <span class="mi">1</span>
                                                <span class="k">else</span><span class="p">:</span>
                                                    <span class="c1"># It did. Stop searching</span>
                                                    <span class="n">break_out</span> <span class="o">=</span> <span class="kc">True</span>                                                    
                                                <span class="k">break</span>
                                <span class="k">if</span> <span class="n">break_out</span><span class="p">:</span>
                                    <span class="k">break</span>
                        <span class="n">improvement_count</span><span class="p">[</span><span class="n">times_using_seed</span><span class="p">]</span> <span class="o">+=</span> <span class="mi">1</span>
                
        <span class="n">peatsa_converged_sum</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="n">first_converged_sum</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="n">improvement_sum</span> <span class="o">=</span> <span class="mi">0</span>
                
        <span class="k">for</span> <span class="n">key</span> <span class="ow">in</span> <span class="n">history</span><span class="p">[</span><span class="s1">&#39;objective&#39;</span><span class="p">][</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
            <span class="n">peatsa_converged_sum</span> <span class="o">+=</span> <span class="n">history</span><span class="p">[</span><span class="s1">&#39;objective&#39;</span><span class="p">][</span><span class="o">-</span><span class="mi">1</span><span class="p">][</span><span class="n">key</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span>
            <span class="n">first_converged_sum</span> <span class="o">+=</span> <span class="n">history</span><span class="p">[</span><span class="s1">&#39;objective&#39;</span><span class="p">][</span><span class="o">-</span><span class="mi">1</span><span class="p">][</span><span class="n">key</span><span class="p">][</span><span class="mi">2</span><span class="p">]</span>
            <span class="n">improvement_sum</span> <span class="o">+=</span> <span class="n">history</span><span class="p">[</span><span class="s1">&#39;objective&#39;</span><span class="p">][</span><span class="o">-</span><span class="mi">1</span><span class="p">][</span><span class="n">key</span><span class="p">][</span><span class="mi">3</span><span class="p">]</span> 
            

        <span class="c1"># number of cases that found a feasible solution on the first solution attempt</span>
        <span class="n">firstSolveFeasibleSum</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="k">for</span> <span class="n">key</span> <span class="ow">in</span> <span class="n">history</span><span class="p">[</span><span class="s1">&#39;firstSolveFeasible&#39;</span><span class="p">][</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
            <span class="n">firstSolveFeasibleSum</span> <span class="o">+=</span> <span class="n">history</span><span class="p">[</span><span class="s1">&#39;firstSolveFeasible&#39;</span><span class="p">][</span><span class="o">-</span><span class="mi">1</span><span class="p">][</span><span class="n">key</span><span class="p">]</span> <span class="c1"># doesn&#39;t have [0] at the end because only one element in &quot;tuple&quot;</span>
            
        <span class="c1"># total number of solution attempts for all cases (converged or not)</span>
        <span class="n">numSolutionAttemptsSum</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="k">for</span> <span class="n">key</span> <span class="ow">in</span> <span class="n">history</span><span class="p">[</span><span class="s1">&#39;solutionAttempts&#39;</span><span class="p">][</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
            <span class="n">numSolutionAttemptsSum</span> <span class="o">+=</span> <span class="n">history</span><span class="p">[</span><span class="s1">&#39;solutionAttempts&#39;</span><span class="p">][</span><span class="o">-</span><span class="mi">1</span><span class="p">][</span><span class="n">key</span><span class="p">]</span> <span class="c1"># doesn&#39;t have [0] at the end because only one element in &quot;tuple&quot;</span>
        <span class="n">numSolutionAttemptsAvg</span> <span class="o">=</span> <span class="n">numSolutionAttemptsSum</span> <span class="o">/</span> <span class="n">run_sum</span>
        
        <span class="c1"># average index of best solution attempt amongst runs that converged</span>
        <span class="n">bestSolutionIndexSum</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="k">for</span> <span class="n">key</span> <span class="ow">in</span> <span class="n">history</span><span class="p">[</span><span class="s1">&#39;bestSolutionIndex&#39;</span><span class="p">][</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
            <span class="n">bestSolutionIndexSum</span> <span class="o">+=</span> <span class="n">history</span><span class="p">[</span><span class="s1">&#39;bestSolutionIndex&#39;</span><span class="p">][</span><span class="o">-</span><span class="mi">1</span><span class="p">][</span><span class="n">key</span><span class="p">]</span> <span class="c1"># doesn&#39;t have [0] at the end because only one element in &quot;tuple&quot;</span>
        
        <span class="c1"># prevent divide-by-zero</span>
        <span class="k">if</span> <span class="n">iteration_converged_sum</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
            <span class="n">solutionIndexAvg</span> <span class="o">=</span> <span class="n">bestSolutionIndexSum</span> <span class="o">/</span> <span class="n">iteration_converged_sum</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">solutionIndexAvg</span> <span class="o">=</span> <span class="o">-</span><span class="mi">1</span>
        
                        
        <span class="n">new_lines</span> <span class="o">=</span> <span class="p">[]</span>        
        
        <span class="k">for</span> <span class="n">line</span> <span class="ow">in</span> <span class="n">old_lines</span><span class="p">:</span> 
            <span class="k">if</span> <span class="n">line</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s2">&quot;Iteration,&quot;</span><span class="p">):</span>   
                <span class="n">new_lines</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">line</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">PEATSAorder</span><span class="o">.</span><span class="n">iteration</span><span class="p">)</span> <span class="o">+</span> <span class="s2">&quot;,</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">line</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s2">&quot;Cases Created&quot;</span><span class="p">):</span>   
                <span class="n">new_lines</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">line</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">case_sum</span><span class="p">)</span> <span class="o">+</span> <span class="s2">&quot;,</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">line</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s2">&quot;Cases Run&quot;</span><span class="p">):</span>   
                <span class="n">new_lines</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">line</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">run_sum</span><span class="p">)</span> <span class="o">+</span> <span class="s2">&quot;,</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">line</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s2">&quot;Ran Unseeded&quot;</span><span class="p">):</span>   
                <span class="n">new_lines</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">line</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">unseeded_sum</span><span class="p">)</span> <span class="o">+</span> <span class="s2">&quot;,</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">line</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s2">&quot;Cases Finished&quot;</span><span class="p">):</span>   
                <span class="n">new_lines</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">line</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">finished_sum</span><span class="p">)</span> <span class="o">+</span> <span class="s2">&quot;,</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span> 
            <span class="k">if</span> <span class="n">line</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s2">&quot;Iteration Cases Converged&quot;</span><span class="p">):</span>   
                <span class="n">new_lines</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">line</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">iteration_converged_sum</span><span class="p">)</span> <span class="o">+</span> <span class="s2">&quot;,</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">line</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s2">&quot;PEATSA Cases Converged&quot;</span><span class="p">):</span>   
                <span class="n">new_lines</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">line</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">peatsa_converged_sum</span><span class="p">)</span> <span class="o">+</span> <span class="s2">&quot;,</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span> 
            <span class="k">if</span> <span class="n">line</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s2">&quot;First Convergence this Iteration&quot;</span><span class="p">):</span>   
                <span class="n">new_lines</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">line</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">first_converged_sum</span><span class="p">)</span> <span class="o">+</span> <span class="s2">&quot;,</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span> 
            <span class="k">if</span> <span class="n">line</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s2">&quot;Improvement this Iteration&quot;</span><span class="p">):</span>   
                <span class="n">new_lines</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">line</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">improvement_sum</span><span class="p">)</span> <span class="o">+</span> <span class="s2">&quot;,</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">line</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s2">&quot;Number of PEATSA Cases That Converged on First NLP Solve&quot;</span><span class="p">):</span>
                <span class="n">new_lines</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">line</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">firstSolveFeasibleSum</span><span class="p">)</span> <span class="o">+</span> <span class="s2">&quot;,</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">line</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s2">&quot;Average Number of Solution Attempts&quot;</span><span class="p">):</span>
                <span class="n">new_lines</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">line</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="nb">round</span><span class="p">(</span><span class="n">numSolutionAttemptsAvg</span><span class="p">,</span> <span class="mi">2</span><span class="p">))</span> <span class="o">+</span> <span class="s2">&quot;,</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">line</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s2">&quot;Average Solution Attempt Number&quot;</span><span class="p">):</span>
                <span class="n">new_lines</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">line</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="nb">round</span><span class="p">(</span><span class="n">solutionIndexAvg</span><span class="p">,</span> <span class="mi">2</span><span class="p">))</span> <span class="o">+</span> <span class="s2">&quot;,</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>
        
        <span class="k">for</span> <span class="n">idx</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">PEATSAorder</span><span class="o">.</span><span class="n">constraint_walking</span><span class="p">)):</span>
            <span class="k">if</span> <span class="n">improvement_sum</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
                <span class="n">PEATSAorder</span><span class="o">.</span><span class="n">improvement_tracker</span><span class="p">[</span><span class="n">idx</span><span class="p">]</span> <span class="o">=</span> <span class="mi">0</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">PEATSAorder</span><span class="o">.</span><span class="n">improvement_tracker</span><span class="p">[</span><span class="n">idx</span><span class="p">]</span> <span class="o">==</span> <span class="n">PEATSAorder</span><span class="o">.</span><span class="n">constraint_walking</span><span class="p">[</span><span class="n">idx</span><span class="p">][</span><span class="mi">1</span><span class="p">]:</span>
                    <span class="n">PEATSAorder</span><span class="o">.</span><span class="n">improvement_tracker</span><span class="p">[</span><span class="n">idx</span><span class="p">]</span> <span class="o">=</span> <span class="mi">1</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">PEATSAorder</span><span class="o">.</span><span class="n">improvement_tracker</span><span class="p">[</span><span class="n">idx</span><span class="p">]</span> <span class="o">+=</span> <span class="mi">1</span>                
        
        <span class="n">new_lines</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s2">&quot;Times Using Seed Before Improvement,&quot;</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">entry</span> <span class="ow">in</span> <span class="n">improvement_count</span><span class="p">:</span>
            <span class="n">new_lines</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">+=</span> <span class="nb">str</span><span class="p">(</span><span class="n">entry</span><span class="p">)</span> <span class="o">+</span> <span class="s2">&quot;,&quot;</span>

        <span class="n">handle</span> <span class="o">=</span> <span class="nb">open</span><span class="p">(</span><span class="n">PEATSAorder</span><span class="o">.</span><span class="n">csv_file</span><span class="o">.</span><span class="n">rstrip</span><span class="p">(</span><span class="s2">&quot;Iteration1234567890.csv&quot;</span><span class="p">)</span> <span class="o">+</span> <span class="s2">&quot;PEATSAhistory.csv&quot;</span><span class="p">,</span><span class="s2">&quot;w&quot;</span><span class="p">)</span>
        
        <span class="k">for</span> <span class="n">line</span> <span class="ow">in</span> <span class="n">new_lines</span><span class="p">:</span>
            <span class="n">handle</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">line</span><span class="p">)</span>
            
        <span class="n">handle</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
            
        <span class="k">return</span> <span class="n">PEATSAorder</span></div>
</div>

</pre></div>

          </div>
          
        </div>
      </div>
      <div class="sphinxsidebar" role="navigation" aria-label="main navigation">
        <div class="sphinxsidebarwrapper">
<h1 class="logo"><a href="../index.html">EMTG python</a></h1>








<h3>Navigation</h3>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../PyEMTG/index.html">PyEMTG documentation</a></li>
<li class="toctree-l1"><a class="reference internal" href="../PEATSA/index.html">PEATSA documentation</a></li>
<li class="toctree-l1"><a class="reference internal" href="../OptionsOverhaul/index.html">OptionsOverhaul documentation</a></li>
</ul>

<div class="relations">
<h3>Related Topics</h3>
<ul>
  <li><a href="../index.html">Documentation overview</a><ul>
  <li><a href="index.html">Module code</a><ul>
  </ul></li>
  </ul></li>
</ul>
</div>
<search id="searchbox" style="display: none" role="search">
  <h3 id="searchlabel">Quick search</h3>
    <div class="searchformwrapper">
    <form class="search" action="../search.html" method="get">
      <input type="text" name="q" aria-labelledby="searchlabel" autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false"/>
      <input type="submit" value="Go" />
    </form>
    </div>
</search>
<script>document.getElementById('searchbox').style.display = "block"</script>








        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="footer">
      &#169;2024, Jacob Englander, Donald Ellison, Jeremy Knittel, Noble Hatten.
      
      |
      Powered by <a href="https://www.sphinx-doc.org/">Sphinx 7.3.7</a>
      &amp; <a href="https://alabaster.readthedocs.io">Alabaster 0.7.16</a>
      
    </div>

    

    
  </body>
</html>